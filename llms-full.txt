# JETNET API -- Complete AI/LLM Reference

This file is auto-generated. Source files concatenated below.


---
# SOURCE: llms.txt
---

# JETNET API (Jetnet Connect) -- AI Agent Reference

> Base URL: https://customer.jetnetconnect.com
> Swagger: https://customer.jetnetconnect.com/swagger/index.html
> This file is optimized for LLM context windows. For the full reference, see llms-full.txt.

## MCP Server (Native AI Agent Integration)

A production-ready MCP server exists at mcp/jetnet_mcp.py. If you are an AI agent
with MCP support (Claude Desktop, Cursor, Copilot), you can connect directly to
JETNET without writing HTTP code. The server handles authentication, token refresh,
pagination, and all JETNET guardrails automatically.

Available tools: jetnet_golden_path, jetnet_lookup_aircraft, jetnet_get_relationships,
jetnet_get_flight_data, jetnet_search_fleet, jetnet_get_history,
jetnet_get_market_trends, jetnet_search_models, jetnet_get_snapshot,
jetnet_get_model_specs, jetnet_health_check.

Setup: pip install mcp httpx pydantic, then configure your MCP client to run
mcp/jetnet_mcp.py with JETNET_EMAIL and JETNET_PASSWORD env vars.

If you do NOT have MCP support, continue with the HTTP API documentation below.

## Common Use Cases

- Aircraft Sales & Brokerage: tail lookup, owner identification, for-sale inventory, comparable sales history
- Fleet Intelligence: fleet composition by model/country/operator, ownership tracking, lifecycle monitoring
- Market Analytics: pricing trends, inventory levels, days-on-market, supply/demand time-series
- CRM Enrichment: ownership contacts, flight activity, base airport, charter/fractional identification
- Data Integration: bulk export with delta sync, automated ownership change alerts, transaction monitoring
- Valuation & Diligence: market benchmarks, transaction history, utilization data, operating costs

See references/vertical-playbooks.md for 9 detailed industry-specific workflows.

## Authentication

POST /api/Admin/APILogin
Body: { "emailAddress": "...", "password": "..." }
Response: { "bearerToken": "...", "apiToken": "..." }

Rules:
- Field is `emailAddress` (capital A). Not `email`, `emailaddress`, or `email_address`.
- `bearerToken` goes in header: `Authorization: Bearer {bearerToken}`
- `apiToken` goes in URL path only: `/api/Aircraft/getRegNumber/N123AB/{apiToken}`
- Never put apiToken in headers or body. Never put bearerToken in the URL.
- Tokens expire after 60 minutes. Proactively refresh at 50 minutes.
- Validate with: GET /api/Admin/getAccountInfo/{apiToken}
- On "INVALID SECURITY TOKEN": re-login once and retry. Never loop.

## Critical Gotchas

1. HTTP 200 does NOT mean success. Always check `responsestatus` for "ERROR".
2. `transtype: ["None"]` not `[]` for all transaction types.
3. `forsale` is string `"true"`/`"false"` in requests, `"Y"`/`"N"` in bulk export responses.
4. Dates must be `MM/DD/YYYY` with leading zeros. Month first, not day.
5. `modlist: []` means no filter (all models), not empty results.
6. `aclist: []` means no filter (all aircraft), not empty results.
7. `maxpages: 0` from bulk export = single page. Use `max(maxpages, 1)`.
8. `companyrelation` (getRegNumber flat) vs `relationtype` (getRelationships nested) -- different endpoints use different field names.
9. `regnbr` (tail number) can change. Use `aircraftid` as your stable database key.
10. Pagination is 1-based (first page = 1, not 0).

## The Golden Path (Tail Lookup)

1. GET /api/Aircraft/getRegNumber/{tailNumber}/{apiToken} -> aircraftresult (includes aircraftid)
2. GET /api/Aircraft/getPictures/{aircraftid}/{apiToken} -> pictures[]
   POST /api/Aircraft/getRelationships/{apiToken} body: {"aclist":[aircraftid],"modlist":[]} -> relationships[]
   POST /api/Aircraft/getFlightDataPaged/{apiToken}/100/1 body: {"aclist":[aircraftid],"modlist":[],...} -> flightdata[]
3. POST /api/Aircraft/getHistoryListPaged/{apiToken}/100/1 body: {"aclist":[aircraftid],"modlist":[],"transtype":["None"],...} -> history[] (lazy)

All POST endpoints require a JSON body with at minimum aclist and modlist. See prompts/ or docs/ for full payload shapes.

## Response Keys by Endpoint

| Endpoint | Response Key | Type |
|----------|-------------|------|
| getAircraft | aircraft | Object (composite with all sub-records) |
| getIdentification | identification | Object |
| getStatus | status | Object |
| getAirframe | airframe | Object (aftt, landings, timesasofdate) |
| getEngine | engine | Object (contains engines[] sub-array) |
| getApu | apu | Object or null |
| getAvionics | avionics | Array + count |
| getFeatures | features | Array + count |
| getAdditionalEquipment | additionalequipment | Array + count |
| getInterior | interior | Object |
| getExterior | exterior | Object |
| getMaintenance | maintenance | Object |
| getLeases | leases | Array or null |
| getCompanyrelationships | companyrelationships | Array + count |
| getFlights | flightsummary | Object/Array |
| getRegNumber | aircraftresult | Object |
| getHexNumber | aircraft | Object |
| getAircraftList | aircraft | Array |
| getRelationships | relationships | Array |
| getAllAircraftObjects | allaircraftobjects | Array |
| getHistoryListPaged | history | Array |
| getFlightDataPaged | flightdata | Array |
| getEventListPaged | events | Array |
| getBulkAircraftExport | aircraft | Array |
| getCondensedOwnerOperators | aircraftowneroperators | Array |
| getPictures | pictures | Array |
| getCompanyListPaged | companylist | Array |
| getContactListPaged | contactlist | Array |
| getModelMarketTrends | modelMarketTrends | Object |
| getAcCompanyFractionalReportPaged | aircraftcompfractionalrefs | Array |

## Enum Values

airframetype: None, FixedWing, Rotary
maketype: None, JetAirliner, BusinessJet, Turboprop, Piston, Turbine
lifecycle: None, InProduction, NewWithManufacturer, InOperation, Retired, InStorage
forsale (request): "true", "false", ""
isnewaircraft / ispreownedtrans / isinternaltrans: Yes, No, Ignore
transtype (request categories): None, FullSale, Lease, InternalSale, Management, Insurance, Repossession, Registration
  NOTE: Response transtype values are different (descriptive strings like "Full Sale - Retail to Retail"). Do not use response values in request payloads.

## ID System

| ID | Type | Purpose | Stable? |
|----|------|---------|---------|
| aircraftid | int | Primary key for aircraft, join key for all sub-records | Yes |
| regnbr | string | Tail number (human-readable) | No -- can change |
| modelid / AMODID | int | Aircraft model, used in modlist arrays | Yes |
| companyid | int | Company/entity ID | Yes |
| contactid | int | Person ID | Yes |
| transid | int | Transaction record ID (for dedup) | Yes |
| serialnbr | string | Manufacturer serial number | Yes |
| baseicao | string | Home airport (4-char ICAO code) | Changes |

## Model IDs (modlist)

872 unique model IDs across 67 makes and 5 make types.
Full machine-readable table: references/model-id-table.json

Common examples:
- Gulfstream G550: modlist [278]
- Gulfstream G650 + G650ER: modlist [663, 1211]
- Citation Latitude: modlist [1167]
- All Citation CJ3 variants: modlist [279, 1194]
- Challenger 350: modlist [1188]
- King Air 350: modlist [142]
- Bell 407: modlist [100]
- modlist: [] = no filter (all models)

## Pagination Pattern

URL: POST .../getHistoryListPaged/{apiToken}/{pagesize}/{page}
Pages are 1-based. Use `maxpages` for loop control.

```python
results, page = [], 1
while True:
    data = api("POST", f"{path}/{pagesize}/{page}", bearer, token, body)
    for key in ["history","flightdata","events","aircraft","aircraftowneroperators","companylist","contactlist","relationships","aircraftcompfractionalrefs"]:
        if key in data and isinstance(data[key], list):
            results.extend(data[key])
            break
    if page >= max(data.get("maxpages", 1), 1):
        break
    page += 1
```

## Schema Differences (Owner/Operator)

| Endpoint | Schema | Relation Field |
|----------|--------|---------------|
| getRegNumber | Flat: companyname, contactfirstname | companyrelation |
| getRelationships / getHistoryList | Nested: company.name, contact.firstname | relationtype |
| getBulkAircraftExport | Prefixed: owrcompanyname, oprcompanyname | prefix (owr*, opr*, chp*) |
| getAcCompanyFractionalReportPaged | Flat: companyname | relation |

## Normalized Response Shapes

AircraftCard: aircraftId, modelId, tailNumber, serialNumber, make, model, yearMfr, yearDelivered, makeType, airframeType, weightClass, categorySize, lifecycle, forSale, owner (CompanyCard), operator (CompanyCard)

CompanyCard: companyId, name, city, state, country, phone, email, contact (ContactCard)

ContactCard: contactId, firstName, lastName, title, email, phone

GoldenPathResult: aircraftId, tailNumber, make, model, yearMfr, yearDelivered, categorySize, weightClass, forSale, askingPrice, owner, operator, chiefPilot, baseIcao, baseAirport, baseCountry, dataSource="JETNET"

## Aircraft Endpoints (docs/aircraft.md)

Three access patterns for aircraft data:

1. Full record: GET /api/Aircraft/getAircraft/{id}/{apiToken} -> `aircraft` (composite with all sub-records)
2. Sub-records (14 GET endpoints, all /api/Aircraft/{endpoint}/{id}/{apiToken}):
   - getIdentification -> identification | getStatus -> status | getAirframe -> airframe (aftt, landings)
   - getEngine -> engine (engines[] sub-array) | getApu -> apu (null if missing) | getAvionics -> avionics[]
   - getFeatures -> features[] | getAdditionalEquipment -> additionalequipment[] | getInterior -> interior
   - getExterior -> exterior | getMaintenance -> maintenance | getLeases -> leases (null if missing)
   - getPictures -> pictures[] | getCompanyrelationships -> companyrelationships[] (isoperator is "Y"/"N" string)
3. Quick lookup: GET /api/Aircraft/getRegNumber/{tail}/{apiToken} -> aircraftresult (flat schema)
   GET /api/Aircraft/getHexNumber/{hex}/{apiToken} -> aircraft

Fleet search: POST /api/Aircraft/getAircraftList/{apiToken} -> aircraft[] (no paged variant -- use filters to limit)
Batch relationships: POST /api/Aircraft/getRelationships/{apiToken} -> relationships[] (nested schema with relationtype)
Bulk detail: POST /api/Aircraft/getAllAircraftObjects/{apiToken}/{pagesize}/{page} -> allaircraftobjects[] (requires aclist)

Gotchas:
- getApu returns null with "SUCCESS: NO RESULTS FOUND [APU]" -- still starts with "SUCCESS"
- getEngine has engine.engines[] sub-array (two levels: model data + per-engine data)
- getCompanyrelationships.isoperator is string "Y"/"N" not boolean
- getAircraftList has NO paged variant; use getBulkAircraftExportPaged for large datasets
- getRegNumber uses flat schema (companyrelation); getRelationships uses nested (relationtype)
- getFlights (flight summary) is at /api/Aircraft/getFlights/{id}/{apiToken} -> flightsummary

## Bulk Export (getBulkAircraftExportPaged)

Two operating modes:
- Snapshot: omit `aircraftchanges` -> full dataset matching filters
- Delta: `aircraftchanges=true` -> aircraft with changes since your last API call (backend tracks this automatically)

Key behaviors:
- Delta uses graph-based change detection: aircraft qualifies if ANY related entity changes (ownership, contacts, events, flights) -- not just the aircraft record.
- Delta returns full records, not field-level diffs. Always upsert entire records.
- `aircraftchanges=true` means "since last call" -- the backend tracks the cursor, not the client.
- `actiondate`/`enddate` are optional date-range filters, not the change cursor. Accepts `MM/DD/YYYY HH:MM:SS`.
- Entity counts scale nonlinearly: each aircraft expands into companies, contacts, phones, events, flight summaries.
- Always scope with `modlist` or `aclist`. Unbounded queries create massive payloads.
- Response uses flat prefixed schema: owr* (owner), opr* (operator), chp* (chief pilot).
- `forsale` is "Y"/"N" (not "true"/"false"). `datepurchased` is YYYYMMDD.
- `maxpages: 0` = single page. Use max(maxpages, 1).

Integration pattern: initial full snapshot -> store locally -> periodic delta pulls with aircraftchanges=true -> upsert entire records.

## History Endpoints (getHistoryListPaged / getCompanyHistoryPaged)

History records are transaction EVENTS, not aircraft state. Each record = a sale, lease, transfer, or relationship change.

POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pagesize}/{page}
POST /api/Company/getCompanyHistoryPaged/{apiToken}/{pagesize}/{page}

Key behaviors:
- Response key: `history` (array). Uses nested relationship schema (company:{}, contact:{} sub-objects).
- `transtype` in request = categories ("FullSale", "Lease", "None"); in response = descriptive strings ("Full Sale - Retail to Retail").
- `isnewaircraft` and `isinternaltrans` are tristate: "Yes", "No", "Ignore".
- `allrelationships: true` returns all parties: Seller, Purchaser, Operator, Seller's Broker, Purchaser's Broker.
- `soldprice`/`askingprice` are often null (confidential deals). `transretail: true` = arm's length retail transaction.
- `transdate` = actual transaction date. `actiondate` = when JETNET last updated the record.
- History records are event pointers — enrich with getRelationships/getAircraftList/getCompany for full context.
- Always provide startdate/enddate + modelid/modlist/companyid to bound queries.

Use cases: ownership timeline (sort by transdate ASC), comparable sales (transtype=FullSale + transretail), leasing intelligence, change detection alerts.

## Snapshot Endpoint (getCondensedSnapshot)

Returns frozen fleet ownership/operator state at a specific historical date. A "time machine" for fleet composition.

POST /api/Aircraft/getCondensedSnapshot/{apiToken}

Key behaviors:
- `snapshotdate` (MM/DD/YYYY) is the required defining parameter.
- Response key: `snapshotowneroperators` (array).
- Non-paged: returns full dataset in one response (can be multi-MB).
- Always filter by modlist, basecountry, maketype, or aclist to keep payloads manageable.
- Snapshot data is historical and immutable — cache aggressively.
- Conceptual model: Snapshot=STATE, History=CHANGE, Current=NOW, FlightData=ACTIVITY.

Use cases: historical fleet composition, "who owned this in year X?", market comparison across years, country fleet growth analysis.

## Model Market Trends (getModelMarketTrends)

POST /api/Model/getModelMarketTrends/{apiToken}

Monthly time-series at model-level granularity. One record per model per month.

Request: modlist (array of model IDs), displayRange (months), startdate (MM/DD/YYYY).
Response key: `modelMarketTrends` (camelCase with capital M).

Key fields per record: trend_year, trend_month, aircraft_for_sale_count, in_operation_count, avg_asking_price, high_asking_price, low_asking_price, avg_daysonmarket, avg_airframe_time, avg_engine_time, domestic_count, international_count, dealer_owned_count, end_user_count.

Derived metrics:
- Supply Pressure = aircraft_for_sale_count / in_operation_count
- Liquidity Score = inverse of avg_daysonmarket slope
- Price Trend Index = MoM change in avg_asking_price

Combine with Snapshots (state), History (transactions), Events (causal), and Flight Data (utilization) for full longitudinal analytics. See docs/trends.md for composite indicators and architecture.

## Events (getEventListPaged)

POST /api/Aircraft/getEventListPaged/{apiToken}/{pagesize}/{page}

Discrete, timestamped aircraft lifecycle changes. The atomic causal layer of the dataset.

Request: evcategory (array), evtype (array), startdate/enddate (MM/DD/YYYY), aclist, modlist.
Response key: `events` (array). Fields: aircraftid, make, model, sernbr, regnbr, yearmfr, date (ISO), subject, description.

Key behaviors:
- evcategory and evtype enum values are STRICT. Unrecognized values return errors inside responsestatus (HTTP 200).
- Use [] for both evcategory and evtype to return all events (safest default).
- Call GET /api/Utility/getEventCategories/{apiToken} and POST /api/Utility/getEventTypes/{apiToken} to discover valid values.
- Known categories: Aircraft Information, Company / Contact, Financial Documents, Market Status, Transaction.
- Example types: Change in Aircraft Base, Change in Airframe Total Time, Ownership Transfer, For Sale / Off Market.
- Priority: Transaction + Market Status = HIGH, Aircraft Information = MEDIUM, Financial Documents + Company/Contact = LOW.
- Events explain WHY snapshots and trends changed (ownership transfers, listings, accidents, lifecycle transitions).
- Use for: lifecycle timelines, market velocity, ownership churn, pre-listing detection, event-driven alerts, signal engines.

Analytics stack: EVENTS (raw) -> SNAPSHOTS (state) -> TRENDS (analytics).

## Flight Data Endpoints

Two endpoints for flight intelligence:

getFlightData (POST, paged) -- Granular per-flight records. Response key: flightdata.
  Required filters: startdate/enddate (MM/DD/YYYY), plus modlist or aclist.
  Fields: flightid, flightdate, origin, destination, flighttime, distance, estfuelburn, estCO2emissions, callsign.
  Ingestion strategy: batch by model + daily/weekly date windows.

getFlights (GET) -- GET /api/Aircraft/getFlights/{aircraftId}/{apiToken}
  Monthly utilization aggregates: flightyear, flightmonth, flights (count), flighthours.
  Response key: flights.
  Use for: utilization trends, CRM scoring, benchmarking.

Use getFlightData for route intelligence and emissions. Use getFlights for monthly trend analysis.

## Contact Endpoints

Contact is a relationship hub connecting companies, aircraft, and listings. Join key: contactid.

getContactList (POST) -- Search contacts by name, company, role. Non-paged.
  Response key: contacts. Fields: contactid, firstname, lastname, title, companyname, companyid.

getContactListPaged (POST, paged) -- Same as getContactList but with pagination.
  Response key: contactlist (NOT contacts -- key changes between variants).

getContact (GET) -- Full contact record by contactid.
  URL: /api/Contact/getContact/{contactId}/{apiToken}
  Response key: contact. Fields: contactid, firstname, lastname, title, suffix, companyname, companyid, address fields.

getIdentification (GET) -- Lightweight identification record.
  URL: /api/Contact/getIdentification/{contactId}/{apiToken}

getPhonenumbers (GET) -- Phone numbers for a contact. Returns null (not []) when empty.
  URL: /api/Contact/getPhonenumbers/{contactId}/{apiToken}

getOtherlistings (GET) -- Alternate company/contact associations.
  URL: /api/Contact/getOtherlistings/{contactId}/{apiToken}

getContAircraftRelationships (GET) -- Aircraft linked to a contact with relationship type.
  URL: /api/Contact/getContAircraftRelationships/{contactId}/{apiToken}

Workflow: search (getContactListPaged) → verify (getIdentification) → full profile (getContact) → aircraft linkage (getContAircraftRelationships) → phones → other listings.

## Company Endpoints

Company is the organizational node linking contacts, aircraft, and certifications. Join key: companyid.

getCompanyList (POST) -- Search companies by name, type, location. Non-paged.
  Response key: companies. Fields: companyid, companyname, city, state, country.

getCompanyListPaged (POST, paged) -- Same as getCompanyList but with pagination.
  Response key: companylist (NOT companies -- key changes between variants).

getCompany (GET) -- Full company record by companyid.
  URL: /api/Company/getCompany/{companyId}/{apiToken}
  Response key: company. Includes nested objects.

getContacts (GET) -- Returns contact ID arrays only (not full objects). N+1 fan-out risk.
  URL: /api/Company/getContacts/{companyId}/{apiToken}

getAircraftrelationships (GET) -- Aircraft tied to company with relationship details.
  isoperator is "Y"/"N" string, not boolean. ownerpercent can be null.

getRelatedcompanies (GET) -- Parent/child/affiliated companies. Returns null (not []) when empty.

getCompanyCertifications (GET) -- Regulatory certifications.

getCompanyHistory / getCompanyHistoryPaged -- Transaction history for a company.

Workflow: search (getCompanyListPaged) → validate (getCompany) → expand (getContacts, getAircraftrelationships) → link.

## Model Reference Endpoints

Four model-level endpoints keyed by modelid (AMODID). Cross-reference: references/model-id-table.json.

getModelMarketTrends (POST) -- See docs/trends.md. Response key: modelMarketTrends (camelCase).

getModelOperationCosts (POST) -- Operating cost projections. Response key: modeloperationcosts (lowercase).
  Key fields: fuel burn rate, cost categories, annualhours, fuelprice projections.
  Request body: ModelPerformanceOptions with modelid.

getModelPerformanceSpecs (POST) -- Airframe specs. Response key: modelperformancespecs (lowercase).
  Key fields: fuselage dimensions, cabin specs, range, speed, ceiling.

getModelIntelligence (POST) -- Model-level intelligence summary.

IMPORTANT: Response key casing is inconsistent -- modelMarketTrends (camelCase) vs modeloperationcosts/modelperformancespecs (lowercase).

## Airport Reference

getAirportList (POST) -- Geographic dimension table. Cache aggressively (low change frequency).
  URL: /api/Utility/getAirportList/{apiToken}
  Request params: name, city, state, statename, country, iata, icao, faaid.
  Response fields: airportid, name, city, state, country, iata, icao, faaid.
  Use ICAO as canonical key. Joins with flight data, events, snapshots for geographic analysis.

## Utility / Reference Endpoints

Cacheable dimension tables forming the metadata backbone. All via /api/Utility/.

getAircraftLifecycleStatus -- Lifecycle enum values. Cache: static (months).
getAircraftMakeList -- Manufacturer taxonomy. Cache: long-lived (weekly).
getAircraftModelList -- Model catalog with modelid, weightclass, categorysize. Cache: long-lived (weekly).
getAirframeJniqSizes -- JNIQ size categories. Cache: static.
getAirframeTypes -- FixedWing, Rotary. Cache: static.
getMakeTypeList -- Make type taxonomy. Cache: long-lived.
getWeightClassTypes -- Weight class categories. Cache: static.
getEventCategories -- 5 event categories. Cache: static.
getEventTypes -- Event type enum per category. Cache: static.
getCompanyBusinessTypes -- Business type taxonomy. Cache: long-lived.
getCountryList / getStateList -- Geographic reference. Cache: static.

Strategy: load all static endpoints once at startup, cache long-lived weekly, refresh session-level daily.

## MCP Server (AI Agent Integration)

The `mcp/` directory contains a Model Context Protocol server that lets AI agents
(Claude Desktop, Cursor, Copilot) query JETNET data natively via tool calls.

Install: pip install mcp httpx pydantic
Run (stdio): JETNET_EMAIL=... JETNET_PASSWORD=... python mcp/jetnet_mcp.py
Run (HTTP): TRANSPORT=http PORT=8000 JETNET_EMAIL=... JETNET_PASSWORD=... python mcp/jetnet_mcp.py

11 tools exposed:
  jetnet_golden_path -- Complete aircraft profile (tail -> specs + owner + pictures) in one call.
  jetnet_lookup_aircraft -- Tail number lookup, returns aircraftid for subsequent calls.
  jetnet_get_relationships -- Owner/operator/manager relationships for an aircraft.
  jetnet_get_flight_data -- Flight activity within a date range.
  jetnet_search_fleet -- Search fleet by model, for-sale status, country.
  jetnet_get_history -- Transaction history (sales, deliveries) by model/aircraft + date range.
  jetnet_get_market_trends -- Market analytics: for-sale count, avg price, days on market.
  jetnet_search_models -- Find AMODID values by name/make/ICAO code.
  jetnet_get_snapshot -- Fleet snapshot at a historical point in time (getCondensedSnapshot).
  jetnet_get_model_specs -- Performance specs: range, speed, cabin, payload (getModelPerformanceSpecs).
  jetnet_health_check -- Verify JETNET connection and credentials.

All tools handle auth, token refresh (50 min), pagination, responsestatus checks, and date validation automatically.

## File Manifest

| File | Purpose | Format |
|------|---------|--------|
| llms.txt | This file -- concise AI agent reference | Markdown |
| llms-full.txt | Complete reference (all docs concatenated) | Markdown |
| references/model-id-table.json | 872 model IDs with make/model/ICAO/fleet counts | JSON array |
| references/model-id-table.csv | Same data for spreadsheets | CSV |
| evals/evals.json | AI eval test cases | JSON |
| src/jetnet/session.py | Python session helper (drop into agent) | Python |
| src/jetnet/session.ts | TypeScript session helper | TypeScript |
| docs/response-shapes.md | Normalized response contracts with factories | Markdown |
| docs/common-mistakes.md | Every known gotcha | Markdown |
| docs/enum-reference.md | Valid enum values | Markdown |
| docs/authentication.md | Auth deep dive | Markdown |
| docs/bulk-export.md | Bulk export: snapshot/delta, graph change detection | Markdown |
| docs/history.md | Transaction history: ownership timeline, sales, leases | Markdown |
| docs/snapshots.md | Historical fleet state at a point in time | Markdown |
| docs/trends.md | Market trends & time-series analytics | Markdown |
| docs/events.md | Aircraft events: lifecycle changes, causal layer | Markdown |
| docs/flight-data.md | Flight endpoints: getFlightData + getFlights | Markdown |
| docs/contacts.md | 7 Contact endpoints: lookup, search, aircraft relationships | Markdown |
| docs/companies.md | 9 Company endpoints: profile, search, aircraft, history | Markdown |
| docs/model-data.md | Model specs, costs, intelligence | Markdown |
| docs/airports.md | Airport reference data, geographic dimension table | Markdown |
| docs/utility-endpoints.md | Cacheable reference/dimension tables | Markdown |
| docs/pagination.md | Pagination patterns | Markdown |
| docs/response-handling.md | Schema differences by endpoint | Markdown |
| docs/id-system.md | ID types and usage | Markdown |
| references/endpoints.md | Full endpoint reference | Markdown |
| examples/responses/ | 16 known-good JSON response examples | JSON |
| prompts/ | 5 AI system prompts (Cursor/Copilot format) | Markdown |
| mcp/jetnet_mcp.py | MCP server: 11 tools for AI agents (Claude, Cursor, Copilot) | Python |
| mcp/README.md | MCP setup, tool reference, example conversations | Markdown |

---
# SOURCE: START_HERE.md
---

# Start Here

New to the JETNET API? Pick your path and get running in minutes.

---

## What You Need

- A JETNET API account (email + password)
- Base URL: `https://customer.jetnetconnect.com`
- Environment variables set: `JETNET_EMAIL`, `JETNET_PASSWORD`

## How Auth Works

1. POST credentials to `/api/Admin/APILogin` (field is `emailAddress` with a capital A)
2. Response gives you two tokens: `bearerToken` and `apiToken`
3. Every call after login: `bearerToken` in the `Authorization` header, `apiToken` in the URL path
4. Tokens expire after 60 minutes
5. Validate your session with `/api/Admin/getAccountInfo/{apiToken}` before long workflows
6. On `INVALID SECURITY TOKEN`: re-login once and retry. Never loop.

## HTTP 200 Does Not Mean Success

JETNET returns HTTP 200 even for errors. Always check `responsestatus` in the JSON body:

```
if responsestatus starts with "ERROR" → it failed, even though HTTP said 200
```

---

## Choose Your Path

> **New to APIs?** Start with the [Junior Dev Guide](docs/junior-dev-guide.md) -- it teaches only the 4 endpoints that matter, with copy-paste examples and the 5 mistakes every new developer hits.

### Path A: "I want a demo UI in 5 minutes"

You want to see a working app, type in a tail number, and get results.

1. Go to [`templates/nextjs-tail-lookup/`](templates/nextjs-tail-lookup/)
2. Copy `.env.example` to `.env.local`, fill in your credentials
3. `npm install && npm run dev`
4. Open `http://localhost:3000`, enter a tail number

That's it. You have a working aircraft lookup app.

**Also available:** [`templates/python-fastapi-golden-path/`](templates/python-fastapi-golden-path/) if you prefer Python.

---

### Path B: "I want bulk/export data"

You want to sync fleet data, export history, or build analytics pipelines.

1. Read the [Pagination Guide](docs/pagination.md) (1-based pages, `maxpages` loop)
2. Look at [`examples/python/07_bulk_export.py`](examples/python/07_bulk_export.py) for the pattern
3. Use [`scripts/paginate.py`](scripts/paginate.py) to handle pagination automatically
4. For a full pipeline prompt, paste [`prompts/04_bulk_export_pipeline.md`](prompts/04_bulk_export_pipeline.md) into your IDE agent

Key gotcha: `getBulkAircraftExportPaged` returns `maxpages: 0` for single-page results. Use `max(maxpages, 1)`.

---

### Path C: "I want CRM enrichment"

You want to enrich contacts, generate leads, or monitor ownership changes.

1. For FBO/airport leads: paste [`prompts/02_fbo_airport_activity_leads.md`](prompts/02_fbo_airport_activity_leads.md) into your IDE agent
2. For fleet watchlist/alerts: paste [`prompts/03_fleet_watchlist_alerts.md`](prompts/03_fleet_watchlist_alerts.md) into your IDE agent
3. Use the [`templates/python-fastapi-golden-path/`](templates/python-fastapi-golden-path/) as your backend starting point
4. See [`snippets/ownership.md`](snippets/ownership.md) for quick copy-paste relationship lookups

---

### Path D: "I'm building an AI agent / code agent"

> **Want zero-code MCP instead?** Skip to [Path E](#path-e-i-want-zero-code-ai-agent-access-mcp) below.

You want to give an AI agent (Cursor, Copilot, custom GPT, LangChain, CrewAI, or your own) the ability to call the JETNET API.

**Quickest path:** Feed [`llms.txt`](llms.txt) into your agent's context window. It contains every rule, gotcha, enum value, and response key in ~150 lines. For agents with large context windows, use [`llms-full.txt`](llms-full.txt) (~3100 lines, all docs).

1. **Feed your agent the rules:** Copy [`src/jetnet/session.py`](src/jetnet/session.py) (Python) or [`src/jetnet/session.ts`](src/jetnet/session.ts) (TypeScript) into your agent's context -- it handles auth, token refresh, and error normalization automatically
2. **Give it the model reference:** Load [`references/model-id-table.json`](references/model-id-table.json) so your agent can resolve aircraft makes/models to the correct `modlist` IDs (872 models across 67 makes)
3. **Use the prompt recipes:** Paste any of the [`prompts/`](prompts/) into your agent as system instructions -- they are self-contained with API call sequences, error rules, and response shapes
4. **Validate with evals:** Use [`evals/evals.json`](evals/evals.json) to test that your agent handles JETNET responses correctly
5. **Normalize responses:** Use the contracts in [`docs/response-shapes.md`](docs/response-shapes.md) to ensure your agent outputs consistent shapes (AircraftCard, CompanyCard, GoldenPathResult)

**Key files for agent context windows:**

| File | Purpose | Size |
|------|---------|------|
| [`llms.txt`](llms.txt) | Single-file AI reference (all rules + gotchas + enums) | ~150 lines |
| [`llms-full.txt`](llms-full.txt) | Complete reference (all docs concatenated) | ~3100 lines |
| [`src/jetnet/session.py`](src/jetnet/session.py) | Auth + session management (drop into agent) | ~240 lines |
| [`references/model-id-table.json`](references/model-id-table.json) | Model ID lookup (agent can resolve "G550" → modlist: [278]) | 872 entries |
| [`docs/response-shapes.md`](docs/response-shapes.md) | Response contracts for structured output | ~440 lines |
| [`docs/common-mistakes.md`](docs/common-mistakes.md) | Guardrails to prevent agent errors | ~170 lines |
| [`evals/evals.json`](evals/evals.json) | Test cases for agent validation | 3 cases |
| [`prompts/`](prompts/) | 4 ready-to-use system prompts | ~200 lines each |

**Quick agent setup pattern:**

```python
context = open("llms.txt").read()
model_ids = json.load(open("references/model-id-table.json"))

system_prompt = open("prompts/01_golden_path_tail_lookup_app.md").read()
```

---

### Path E: "I want zero-code AI agent access (MCP)"

You want to connect Claude Desktop, Cursor, or any MCP-compatible AI directly to JETNET. No integration code needed -- the AI calls JETNET tools natively.

**Start here:** [`mcp/README.md`](mcp/README.md)

**What you'll get in 5 minutes:**
1. Install: `pip install mcp httpx pydantic`
2. Configure your MCP client (Claude Desktop, Cursor, etc.)
3. Ask: "Look up N650GD and show me who owns it"
4. Done. The AI handles auth, token refresh, pagination, and formatting.

**Best for:** Business users who want data without writing code, developers using AI-assisted coding tools, and automation pipelines where LLMs orchestrate workflows.

---

## Session Helpers

We provide production-ready session modules that handle login, token refresh, and validation automatically:

- **Python:** [`src/jetnet/session.py`](src/jetnet/session.py)
- **TypeScript:** [`src/jetnet/session.ts`](src/jetnet/session.ts)

These use `/api/Admin/getAccountInfo` as a lightweight health check to validate your token before long workflows, and auto re-login once if the token has expired.

---

## Where to Go Next

| Resource | When to use it |
|----------|---------------|
| [Authentication Guide](docs/authentication.md) | Deep dive into tokens, refresh, retry |
| [Response Shapes](docs/response-shapes.md) | Normalized objects for your UI (AircraftCard, CompanyCard, etc.) |
| [Common Mistakes](docs/common-mistakes.md) | Save yourself hours of debugging |
| [Prompts](prompts/) | Paste into Cursor/Copilot to generate working apps |
| [Model ID Lookup](references/model-ids.md) | Find the right `modlist` IDs for any aircraft make/model |
| [Evals](evals/evals.json) | Test cases for validating AI agent responses |
| [MCP Server](mcp/README.md) | Zero-code AI agent access to JETNET (Claude, Cursor, Copilot) |
| [Full Endpoint Reference](references/endpoints.md) | Every endpoint with all parameters |

---
# SOURCE: docs/authentication.md
---

# Authentication

## Login Endpoint

All JETNET API calls require authentication via the login endpoint:

```http
POST https://customer.jetnetconnect.com/api/Admin/APILogin
Content-Type: application/json

{
  "emailAddress": "YOUR_EMAIL@example.com",
  "password": "YOUR_PASSWORD"
}
```

> **Important:** The field is `emailAddress` with a capital **A**. This is the single most common auth mistake. It is not `email`, `emailaddress`, or `email_address`.

## Response Tokens

A successful login returns two tokens:

| Token | Purpose |
|-------|---------|
| `bearerToken` | Sent in the `Authorization` header on every request |
| `apiToken` | Inserted into the URL path on every request (also called `securityToken` in some docs — same field) |

## Using Tokens on Subsequent Calls

Every API call after login requires both tokens:

1. **Header:** `Authorization: Bearer {bearerToken}`
2. **URL path:** Replace `{apiToken}` in the endpoint path with your actual `apiToken` value

The `apiToken` goes **in the URL path only** — never in headers or the JSON body.

### Example

```
GET /api/Aircraft/getRegNumber/N123AB/{apiToken}
Authorization: Bearer {bearerToken}
```

## Two-Tier Model

JETNET uses a two-tier model for API usage:

| Tier | Use Case | Characteristics |
|------|----------|----------------|
| **Tier A — Interactive** | Tail lookup, owner/operator, pictures, quick flight summary, CRM enrichment | One aircraft at a time, low volume, user is waiting |
| **Tier B — Bulk / Data Engineering** | Nightly sync, history exports, analytics pipelines, large event windows | Always paged, run async, never drive a live UI off these |

If building an app or a script for a salesperson: **Tier A**.
If a customer asks about bulk export, nightly refresh, or history across thousands of aircraft: **Tier B**.

## Environment Variable Setup

Store your credentials in environment variables — never hard-code them:

```bash
export JETNET_EMAIL="your_email@example.com"
export JETNET_PASSWORD="your_password"
```

## Token Refresh Pattern

Tokens expire after **60 minutes**. For long-running pipelines, proactively re-login before expiry rather than waiting for a failure.

### Python

```python
import time, os, requests

BASE = "https://customer.jetnetconnect.com"
token_issued = 0
TOKEN_TTL = 50 * 60  # refresh after 50 min (tokens last 60 min)

def login(email, password):
    r = requests.post(f"{BASE}/api/Admin/APILogin",
                      json={"emailAddress": email, "password": password})
    r.raise_for_status()
    d = r.json()
    return d["bearerToken"], d["apiToken"]

def get_tokens():
    global bearer, token, token_issued
    if time.time() - token_issued > TOKEN_TTL:
        bearer, token = login(os.environ["JETNET_EMAIL"], os.environ["JETNET_PASSWORD"])
        token_issued = time.time()
    return bearer, token
```

### JavaScript

```javascript
const BASE = "https://customer.jetnetconnect.com";
let bearerToken, apiToken, tokenIssued = 0;
const TOKEN_TTL = 50 * 60 * 1000; // 50 minutes in ms

async function login(email, password) {
  const res = await fetch(`${BASE}/api/Admin/APILogin`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ emailAddress: email, password })
  });
  if (!res.ok) throw new Error(`Login failed: ${res.status}`);
  const data = await res.json();
  return { bearerToken: data.bearerToken, apiToken: data.apiToken };
}

async function getTokens() {
  if (Date.now() - tokenIssued > TOKEN_TTL) {
    const tokens = await login(process.env.JETNET_EMAIL, process.env.JETNET_PASSWORD);
    bearerToken = tokens.bearerToken;
    apiToken = tokens.apiToken;
    tokenIssued = Date.now();
  }
  return { bearerToken, apiToken };
}
```

## Retry on INVALID SECURITY TOKEN

When you receive `"ERROR: INVALID SECURITY TOKEN"` in the `responsestatus` field:

1. Re-login to get fresh tokens
2. Retry the failed request once with the new tokens
3. **Never loop** — if it fails again, surface the error

```python
def api(method, path, bearer, token, body=None):
    url = f"{BASE}{path}".replace("{apiToken}", token)
    headers = {"Authorization": f"Bearer {bearer}", "Content-Type": "application/json"}
    r = requests.request(method, url, headers=headers, json=body)
    r.raise_for_status()
    result = r.json()
    status = result.get("responsestatus", "").upper()
    if "INVALID SECURITY TOKEN" in status:
        bearer, token = login(os.environ["JETNET_EMAIL"], os.environ["JETNET_PASSWORD"])
        r = requests.request(method, url.replace(token, token), headers=headers, json=body)
        r.raise_for_status()
        result = r.json()
    if "ERROR" in result.get("responsestatus", "").upper():
        raise ValueError(f"JETNET error: {result['responsestatus']}")
    return result
```

## Recommended: Session Helpers

For production apps, use the session helpers instead of managing tokens manually. They handle login, proactive refresh, `/getAccountInfo` validation, and auto-retry:

**Python** — [`src/jetnet/session.py`](../src/jetnet/session.py)

```python
from src.jetnet.session import login, ensure_session, jetnet_request

session = login("you@example.com", "password", "https://customer.jetnetconnect.com")
session = ensure_session(session)
result = jetnet_request("GET", "/api/Aircraft/getRegNumber/N1KE/{apiToken}", session)
```

**TypeScript** — [`src/jetnet/session.ts`](../src/jetnet/session.ts)

```typescript
import { login, ensureSession, jetnetRequest } from "../../src/jetnet/session";

let session = await login(email, password, baseUrl);
session = await ensureSession(session);
const result = await jetnetRequest("GET", "/api/Aircraft/getRegNumber/N1KE/{apiToken}", session);
```

## Token Validation with /getAccountInfo

`GET /api/Admin/getAccountInfo/{apiToken}` is a lightweight endpoint that returns your account details. Use it as a health check before long workflows:

- Cheap call — no data payload, fast response
- If it returns a valid response, your token is good
- If it returns `INVALID SECURITY TOKEN`, re-login once and retry
- The session helpers call this automatically via `ensure_session()`

To measure the actual TTL for your tenant:

```bash
python scripts/token_probe.py
```

## Security Best Practices

- Never expose tokens in client-side code (browser or mobile app)
- Always proxy JETNET calls through your own backend
- Store credentials in environment variables or a secrets manager
- Do not log tokens in production

---
# SOURCE: docs/pagination.md
---

# Pagination

## When to Use Paged Endpoints

Use `Paged` endpoint variants for history, flight data, events, bulk export, company lists, and contact lists. Non-paged versions time out on large datasets.

| Endpoint | Paged Variant |
|----------|--------------|
| `getHistoryList` | `getHistoryListPaged` |
| `getFlightData` | `getFlightDataPaged` |
| `getEventList` | `getEventListPaged` |
| `getBulkAircraftExport` | Always paged |
| `getCompanyList` | `getCompanyListPaged` |
| `getContactList` | `getContactListPaged` |
| `getCondensedOwnerOperators` | `getCondensedOwnerOperatorsPaged` |

## URL Pattern

```
POST .../getHistoryListPaged/{apiToken}/{pagesize}/{page}
```

- `{pagesize}` — number of records per page (typically `100`)
- `{page}` — **1-based** (first page = `1`, not `0`)

## Response Fields

| Field | Meaning |
|-------|---------|
| `maxpages` | Total number of pages available |
| `count` | Records on **this page** (not total records) |
| `currentpage` | The page you requested |
| `responsestatus` | Status string like `"SUCCESS: PAGE [ 1 of 428 ]"` |

Use `maxpages` for loop control — do not parse the `responsestatus` string.

## LIST_KEYS

Paged responses contain the data array under one of these keys:

```
history, flightdata, events, aircraft, aircraftowneroperators,
companylist, contactlist, relationships, aircraftcompfractionalrefs
```

## Pagination Loop — Python

```python
LIST_KEYS = {
    "history", "flightdata", "events", "aircraft",
    "aircraftowneroperators", "companylist", "contactlist",
    "relationships", "aircraftcompfractionalrefs"
}

def get_all_pages(bearer, token, paged_path, body, pagesize=100):
    results, page = [], 1
    while True:
        data = api("POST", f"{paged_path}/{pagesize}/{page}", bearer, token, body)
        for key in LIST_KEYS:
            if key in data and isinstance(data[key], list):
                results.extend(data[key])
                break
        if page >= data.get("maxpages", 1):
            break
        page += 1
    return results
```

## Pagination Loop — JavaScript

```javascript
const LIST_KEYS = new Set([
  "history", "flightdata", "events", "aircraft",
  "aircraftowneroperators", "companylist", "contactlist",
  "relationships", "aircraftcompfractionalrefs"
]);

async function getAllPages(bearerToken, apiToken, pagedPath, body, pagesize = 100) {
  const results = [];
  let page = 1;
  while (true) {
    const data = await api("POST", `${pagedPath}/${pagesize}/${page}`, bearerToken, apiToken, body);
    for (const key of LIST_KEYS) {
      if (Array.isArray(data[key])) {
        results.push(...data[key]);
        break;
      }
    }
    if (page >= (data.maxpages || 1)) break;
    page++;
  }
  return results;
}
```

## getBulkAircraftExport — maxpages:0 Quirk

`getBulkAircraftExport` returns `maxpages: 0` and `currentpage: 0` when **all results fit in a single response**. If your loop checks `page >= maxpages` before processing, you will exit immediately and miss all records.

**Fix:** Use `Math.max(maxpages, 1)` (or `max(maxpages, 1)` in Python) in your loop condition:

```python
def get_bulk_export(bearer, token, body, pagesize=100):
    results, page = [], 1
    while True:
        data = api("POST",
                   f"/api/Aircraft/getBulkAircraftExport/{token}/{pagesize}/{page}",
                   bearer, token, body)
        results.extend(data.get("aircraft", []))
        if page >= max(data.get("maxpages", 1), 1):
            break
        page += 1
    return results
```

```javascript
async function getBulkExport(bearerToken, apiToken, body, pagesize = 100) {
  const results = [];
  let page = 1;
  while (true) {
    const data = await api("POST",
      `/api/Aircraft/getBulkAircraftExport/${apiToken}/${pagesize}/${page}`,
      bearerToken, apiToken, body);
    results.push(...(data.aircraft || []));
    if (page >= Math.max(data.maxpages || 1, 1)) break;
    page++;
  }
  return results;
}
```

---
# SOURCE: docs/response-handling.md
---

# Response Handling

## HTTP 200 Does Not Mean Success

JETNET returns HTTP 200 for most responses, including errors. You must always check the `responsestatus` field in the JSON body:

```python
result = r.json()
if "ERROR" in result.get("responsestatus", "").upper():
    raise ValueError(f"JETNET error: {result['responsestatus']}")
```

```javascript
const data = await res.json();
if ((data.responsestatus || "").toUpperCase().includes("ERROR")) {
  throw new Error(`JETNET error: ${data.responsestatus}`);
}
```

## responsestatus Values

| Status Pattern | Meaning |
|---------------|---------|
| `"SUCCESS"` | Request succeeded (non-paged) |
| `"SUCCESS: PAGE [ 1 of 428 ]"` | Paged request succeeded |
| `"ERROR: INVALID SECURITY TOKEN"` | Token expired — re-login and retry once |
| `"ERROR: ..."` | Any other error — do not retry, surface the message |

## companyrelationships Schema Differences

The `companyrelationships` structure **differs by endpoint**. This is the single biggest source of bugs when working across multiple JETNET endpoints.

| Endpoint | Schema | Relation Field | Relation Values |
|----------|--------|---------------|----------------|
| `getRegNumber` | **Flat** — prefixed fields (`companyname`, `contactfirstname`) | `companyrelation` | `"Owner"`, `"Operator"`, `"Chief Pilot"` |
| `getAircraftList` | Not present | — | — |
| `getHistoryList` / `getRelationships` | **Nested** — `company: {}`, `contact: {}` sub-objects | `relationtype` | `"Owner"`, `"Operator"`, `"Seller"`, `"Purchaser"`, `"Seller's Broker"` |
| `getBulkAircraftExport` | **Flat prefixed by role** — `owr*`, `opr*`, `chp*`, `excbrk1*`, `addl1*` | Field prefix | Owner=`owr*`, Operator=`opr*`, Chief Pilot=`chp*` |
| `getAcCompanyFractionalReportPaged` | **Flat** — top-level `comp*` and `contact*` fields | `relation` | `"Owner"`, `"Flight Department"`, `"Certificate Holder"` |

### getRegNumber (Flat Schema)

Fields are prefixed at the top level of each relationship object:

```json
{
  "companyrelation": "Owner",
  "companyname": "Acme Aviation LLC",
  "companyid": 4425,
  "contactfirstname": "John",
  "contactlastname": "Doe",
  "contacttitle": "Director of Aviation"
}
```

### getHistoryList / getRelationships (Nested Schema)

Each relationship contains nested `company` and `contact` objects:

```json
{
  "relationtype": "Owner",
  "relationseqno": 1,
  "company": {
    "companyid": 4425,
    "name": "Acme Aviation LLC",
    "address": "123 Main St"
  },
  "contact": {
    "contactid": 747133,
    "firstname": "John",
    "lastname": "Doe"
  }
}
```

### getBulkAircraftExport (Flat Prefixed by Role)

Each role uses a different field prefix:

```json
{
  "owrcompanyname": "Acme Aviation LLC",
  "owrcompanyid": 4425,
  "oprcompanyname": "Flight Ops Inc",
  "oprcompanyid": 5678,
  "chpfirstname": "Mike",
  "chplastname": "Smith"
}
```

| Prefix | Role |
|--------|------|
| `owr*` | Owner |
| `opr*` | Operator |
| `chp*` | Chief Pilot |
| `excbrk1*` / `excbrk2*` | Exclusive Brokers |
| `addl1*` / `addl2*` / `addl3*` | Additional relationships |

### getAcCompanyFractionalReportPaged (Flat)

```json
{
  "relation": "Fractional Owner",
  "companyname": "NetJets Sales Inc",
  "companyid": 12345,
  "fractionPercentOwned": "100.00"
}
```

- `fractionPercentOwned: "100.00"` = actual owner
- `fractionPercentOwned: "0.00"` = operator/manager on same aircraft

## Key Response Keys by Endpoint

| Endpoint | Response Key | Type |
|----------|-------------|------|
| `getRegNumber` | `aircraftresult` | Object |
| `getAircraftList` | `aircraft` | Array |
| `getHistoryListPaged` | `history` | Array |
| `getFlightDataPaged` | `flightdata` | Array |
| `getEventListPaged` | `events` | Array |
| `getRelationships` | `relationships` | Array |
| `getBulkAircraftExport` | `aircraft` | Array |
| `getCondensedOwnerOperators` | `aircraftowneroperators` | Array |
| `getPictures` | `pictures` | Array |

---
# SOURCE: docs/response-shapes.md
---

# JETNET Response Shapes -- Normalized Contracts

This document defines three canonical data shapes that normalize JETNET's five raw
response schemas into a consistent interface for UI and pipeline code.

Use these shapes as your application's internal data model. Transform raw JETNET
responses into these shapes at the API boundary -- never spread raw field names
(`owrfname`, `companyrelation`, `contactfirstname`) through your UI components.

---

## Why Normalize?

JETNET returns company/contact data in five different schemas depending on the
endpoint. See the Schema Mapping Quick Reference below for the comparison table.
Normalizing at ingestion means your UI components, CRM mappers, and export jobs
only deal with one shape.

---

## 1. AircraftCard

Canonical aircraft summary. Produced by tail-lookup, aircraft list, and bulk export.

```typescript
interface AircraftCard {
  // Identity
  aircraftId: number
  modelId: number
  tailNumber: string       // regnbr
  serialNumber: string     // sernbr / serialnbr
  make: string             // e.g. "GULFSTREAM"
  model: string            // e.g. "G550"
  yearMfr: number
  yearDelivered: number

  // Classification
  makeType: string         // "BusinessJet" | "Turboprop" | "Piston" | ...
  airframeType: string     // "FixedWing" | "Rotorcraft"
  weightClass: string      // "Light" | "Midsize" | "Heavy" | ...
  categorySize: string     // "Light Jet" | "Large Long-Range Jet" | ...

  // Status
  lifecycle: string        // "InOperation" | "Written Off" | ...
  usage: string            // "Business" | "Charter" | ...
  ownership: string        // "Wholly Owned" | "Fractional" | ...
  forSale: boolean
  askingPrice: string | null  // "Inquire" or dollar string or null
  marketStatus: string | null

  // Home base
  baseIcao: string | null
  baseAirport: string | null
  baseCountry: string | null
  baseContinent: string | null

  // Airframe metrics
  estimatedAFTT: number | null
  estimatedCycles: number | null
  estimatedFlightHours: number | null

  // Relationships (normalized -- see CompanyCard below)
  owner: CompanyCard | null
  operator: CompanyCard | null
  chiefPilot: ContactCard | null
  exclusiveBrokers: CompanyCard[]
  additionalRelations: RelationCard[]
}
```

### Python factory (from getRegNumber / tail lookup)

```python
def aircraft_card_from_regnbr(raw: dict) -> dict:
    ac = raw.get("aircraftresult", raw)
    rels = ac.get("companyrelationships", [])
    owner = next((r for r in rels if r["companyrelation"] == "Owner"), None)
    operator = next((r for r in rels if r["companyrelation"] == "Operator"), None)
    return {
        "aircraftId": ac.get("aircraftid"),
        "modelId": ac.get("modelid"),
        "tailNumber": ac.get("regnbr"),
        "serialNumber": ac.get("serialnbr") or ac.get("sernbr"),
        "make": ac.get("make"),
        "model": ac.get("model"),
        "yearMfr": ac.get("yearmfr"),
        "yearDelivered": ac.get("yeardlv"),
        "makeType": ac.get("maketype"),
        "airframeType": ac.get("airframetype"),
        "weightClass": ac.get("weightclass"),
        "categorySize": ac.get("categorysize"),
        "lifecycle": ac.get("lifecycle"),
        "usage": ac.get("usage"),
        "ownership": ac.get("ownership"),
        "forSale": bool(ac.get("forsale")),
        "askingPrice": None,
        "marketStatus": None,
        "baseIcao": ac.get("baseicao"),
        "baseAirport": ac.get("baseairport"),
        "baseCountry": ac.get("basecountry"),
        "baseContinent": ac.get("basecontinent"),
        "estimatedAFTT": ac.get("estaftt"),
        "estimatedCycles": ac.get("estcycles"),
        "estimatedFlightHours": None,
        "owner": company_card_from_flat(owner) if owner else None,
        "operator": company_card_from_flat(operator) if operator else None,
        "chiefPilot": None,
        "exclusiveBrokers": [],
        "additionalRelations": [],
    }
```

### Python factory (from getBulkAircraftExportPaged -- flat owr*/opr*/chp* schema)

```python
def aircraft_card_from_bulk(raw: dict) -> dict:
    for_sale_raw = raw.get("forsale", "N")
    for_sale = for_sale_raw == "Y" if isinstance(for_sale_raw, str) else bool(for_sale_raw)

    owner = None
    if raw.get("owrcompid"):
        owner = {
            "companyId": raw["owrcompid"],
            "name": raw.get("owrcompanyname"),
            "city": raw.get("owrcity"),
            "state": raw.get("owrstate"),
            "country": raw.get("owrcountry"),
            "phone": raw.get("owrphone1"),
            "email": raw.get("owremail"),
            "contact": {
                "contactId": raw.get("owrcontactid"),
                "firstName": raw.get("owrfname"),
                "lastName": raw.get("owrlname"),
                "title": raw.get("owrtitle"),
                "email": raw.get("owremail"),
                "phone": raw.get("owrphone1"),
            },
        }
    return {
        "aircraftId": raw.get("aircraftid"),
        "modelId": raw.get("modelid"),
        "tailNumber": raw.get("regnbr"),
        "serialNumber": raw.get("sernbr"),
        "make": raw.get("make"),
        "model": raw.get("model"),
        "yearMfr": raw.get("yearmfr"),
        "yearDelivered": raw.get("yeardelivered"),
        "makeType": raw.get("maketype"),
        "airframeType": raw.get("airframetype"),
        "lifecycle": raw.get("lifecycle"),
        "forSale": for_sale,
        "askingPrice": raw.get("asking"),
        "marketStatus": raw.get("status"),
        "estimatedAFTT": raw.get("estaftt"),
        "estimatedCycles": raw.get("estcycles"),
        "estimatedFlightHours": raw.get("estflighthrs"),
        "owner": owner,
        "operator": None,   # map opr* similarly if needed
        "chiefPilot": None, # map chp* if needed
        "exclusiveBrokers": [],
        "additionalRelations": [],
    }
```

---

## 2. CompanyCard

Canonical company + primary contact. Used as a nested shape inside AircraftCard
and as a standalone for CRM upsert operations.

```typescript
interface ContactCard {
  contactId: number | null
  firstName: string | null
  lastName: string | null
  fullName: string          // computed: firstName + ' ' + lastName
  title: string | null
  email: string | null
  phone: string | null      // best available phone
  officePhone: string | null
  mobilePhone: string | null
}

interface CompanyCard {
  companyId: number
  name: string
  address1: string | null
  city: string | null
  state: string | null
  country: string | null
  postCode: string | null
  email: string | null
  phone: string | null      // office phone
  businessType: string | null
  agencyType: string | null
  contact: ContactCard | null
}
```

### Python factory (from getRegNumber flat companyrelationships)

```python
def company_card_from_flat(rel: dict) -> dict:
    """
    Normalize a flat getRegNumber companyrelationships entry.
    Field prefix: company* for company, contact* for contact.
    """
    first = rel.get("contactfirstname") or ""
    last  = rel.get("contactlastname") or ""
    return {
        "companyId":   rel.get("companyid"),
        "name":        rel.get("companyname"),
        "address1":    rel.get("companyaddress1"),
        "city":        rel.get("companycity"),
        "state":       rel.get("companystate") or rel.get("companystateabbr"),
        "country":     rel.get("companycountry"),
        "postCode":    rel.get("companypostcode"),
        "email":       rel.get("companyemail"),
        "phone":       rel.get("companyofficephone"),
        "businessType": rel.get("companybusinesstype"),
        "agencyType":  rel.get("companyagencytype"),
        "contact": {
            "contactId":   rel.get("contactid"),
            "firstName":   first,
            "lastName":    last,
            "fullName":    f"{first} {last}".strip(),
            "title":       rel.get("contacttitle"),
            "email":       rel.get("contactemail"),
            "phone":       rel.get("contactbestphone"),
            "officePhone": rel.get("contactofficephone"),
            "mobilePhone": rel.get("contactmobilephone"),
        },
    }
```

### Python factory (from getRelationships / getHistoryList nested schema)

```python
def company_card_from_nested(rel: dict) -> dict:
    """
    Normalize a nested getRelationships / getHistoryList companyrelationships entry.
    Has sub-objects: rel['company'] and rel['contact'].
    """
    co = rel.get("company") or {}
    ct = rel.get("contact") or {}
    first = ct.get("firstname") or ""
    last  = ct.get("lastname") or ""
    return {
        "companyId":    co.get("companyid") or rel.get("companyid"),
        "name":         co.get("name") or rel.get("name"),
        "address1":     co.get("address1"),
        "city":         co.get("city"),
        "state":        co.get("state"),
        "country":      co.get("country"),
        "postCode":     co.get("postcode"),
        "email":        co.get("email"),
        "phone":        co.get("office"),
        "businessType": rel.get("businesstype"),
        "agencyType":   None,
        "contact": {
            "contactId":   ct.get("contactid") or rel.get("contactid"),
            "firstName":   first,
            "lastName":    last,
            "fullName":    f"{first} {last}".strip(),
            "title":       ct.get("title"),
            "email":       ct.get("email"),
            "phone":       ct.get("office") or ct.get("mobile"),
            "officePhone": ct.get("office"),
            "mobilePhone": ct.get("mobile"),
        },
    }
```

---

## 3. GoldenPathResult

The "golden path" shape: everything a front-end component or CRM trigger needs in
one flat dict. Produced by combining AircraftCard + ownership history + market data.
Designed for the Next.js tail-lookup template and CRM enrichment pipelines.

```typescript
interface GoldenPathResult {
  // Aircraft identity (from AircraftCard)
  aircraftId: number
  tailNumber: string
  make: string
  model: string
  yearMfr: number
  yearDelivered: number
  categorySize: string
  weightClass: string

  // Market status
  forSale: boolean
  askingPrice: string | null
  marketStatus: string | null

  // Current owner + operator (from AircraftCard)
  owner: CompanyCard | null
  operator: CompanyCard | null
  chiefPilot: ContactCard | null

  // Home base
  baseIcao: string | null
  baseAirport: string | null
  baseCountry: string | null

  // Enrichment metadata
  jetnetPageUrl: string | null    // link to JETNET Evolution detail page
  lastUpdated: string | null      // ISO datetime of last JETNET update
  dataSource: string              // always "JETNET"
}
```

### Python factory

```python
def golden_path_result(
    aircraft_card: dict,
    jetnet_page_url: str | None = None,
    last_updated: str | None = None,
) -> dict:
    """
    Produce a GoldenPathResult from a normalized AircraftCard.
    """
    return {
        "aircraftId":    aircraft_card["aircraftId"],
        "tailNumber":    aircraft_card["tailNumber"],
        "make":          aircraft_card["make"],
        "model":         aircraft_card["model"],
        "yearMfr":       aircraft_card["yearMfr"],
        "yearDelivered": aircraft_card["yearDelivered"],
        "categorySize":  aircraft_card.get("categorySize"),
        "weightClass":   aircraft_card.get("weightClass"),
        "forSale":       aircraft_card.get("forSale", False),
        "askingPrice":   aircraft_card.get("askingPrice"),
        "marketStatus":  aircraft_card.get("marketStatus"),
        "owner":         aircraft_card.get("owner"),
        "operator":      aircraft_card.get("operator"),
        "chiefPilot":    aircraft_card.get("chiefPilot"),
        "baseIcao":      aircraft_card.get("baseIcao"),
        "baseAirport":   aircraft_card.get("baseAirport"),
        "baseCountry":   aircraft_card.get("baseCountry"),
        "jetnetPageUrl": jetnet_page_url,
        "lastUpdated":   last_updated,
        "dataSource":    "JETNET",
    }
```

---

## Schema Mapping Quick Reference

| Field in GoldenPathResult | getRegNumber (flat) | getBulkExport (prefixed) | getRelationships (nested) |
|---|---|---|---|
| owner.companyId | `companyid` | `owrcompid` | `company.companyid` |
| owner.name | `companyname` | `owrcompanyname` | `company.name` |
| owner.contact.firstName | `contactfirstname` | `owrfname` | `contact.firstname` |
| owner.contact.lastName | `contactlastname` | `owrlname` | `contact.lastname` |
| owner.contact.title | `contacttitle` | `owrtitle` | `contact.title` |
| owner.contact.email | `contactemail` | `owremail` | `contact.email` |
| owner.contact.phone | `contactbestphone` | `owrphone1` | `contact.office` |
| relation field | `companyrelation` | prefix (`owr*`) | `relationtype` |

---

## TypeScript Utility (Next.js)

```typescript
// lib/normalize.ts

export function companyCardFromFlat(rel: Record<string, unknown>): CompanyCard {
  const first = String(rel['contactfirstname'] ?? '')
  const last = String(rel['contactlastname'] ?? '')
  return {
    companyId: Number(rel['companyid']),
    name: String(rel['companyname'] ?? ''),
    address1: (rel['companyaddress1'] as string) ?? null,
    city: (rel['companycity'] as string) ?? null,
    state: (rel['companystateabbr'] as string) ?? null,
    country: (rel['companycountry'] as string) ?? null,
    postCode: (rel['companypostcode'] as string) ?? null,
    email: (rel['companyemail'] as string) || null,
    phone: (rel['companyofficephone'] as string) ?? null,
    businessType: (rel['companybusinesstype'] as string) ?? null,
    agencyType: (rel['companyagencytype'] as string) ?? null,
    contact: {
      contactId: rel['contactid'] ? Number(rel['contactid']) : null,
      firstName: first || null,
      lastName: last || null,
      fullName: [first, last].filter(Boolean).join(' '),
      title: (rel['contacttitle'] as string) ?? null,
      email: (rel['contactemail'] as string) ?? null,
      phone: (rel['contactbestphone'] as string) ?? null,
      officePhone: (rel['contactofficephone'] as string) ?? null,
      mobilePhone: (rel['contactmobilephone'] as string) ?? null,
    },
  }
}

export function aircraftCardFromRegNbr(raw: Record<string, unknown>): AircraftCard {
  const ac = (raw['aircraftresult'] as Record<string, unknown>) ?? raw
  const rels = (ac['companyrelationships'] as Record<string, unknown>[]) ?? []
  const ownerRel = rels.find(r => r['companyrelation'] === 'Owner') ?? null
  const opRel = rels.find(r => r['companyrelation'] === 'Operator') ?? null
  return {
    aircraftId: Number(ac['aircraftid']),
    modelId: Number(ac['modelid']),
    tailNumber: String(ac['regnbr'] ?? ''),
    serialNumber: String(ac['serialnbr'] ?? ac['sernbr'] ?? ''),
    make: String(ac['make'] ?? ''),
    model: String(ac['model'] ?? ''),
    yearMfr: Number(ac['yearmfr']),
    yearDelivered: Number(ac['yeardlv'] ?? ac['yeardelivered']),
    makeType: String(ac['maketype'] ?? ''),
    airframeType: String(ac['airframetype'] ?? ''),
    weightClass: String(ac['weightclass'] ?? ''),
    categorySize: String(ac['categorysize'] ?? ''),
    lifecycle: String(ac['lifecycle'] ?? ''),
    usage: String(ac['usage'] ?? ''),
    ownership: String(ac['ownership'] ?? ''),
    forSale: Boolean(ac['forsale']),
    askingPrice: null,
    marketStatus: null,
    baseIcao: (ac['baseicao'] as string) ?? null,
    baseAirport: (ac['baseairport'] as string) ?? null,
    baseCountry: (ac['basecountry'] as string) ?? null,
    baseContinent: (ac['basecontinent'] as string) ?? null,
    estimatedAFTT: ac['estaftt'] != null ? Number(ac['estaftt']) : null,
    estimatedCycles: ac['estcycles'] != null ? Number(ac['estcycles']) : null,
    estimatedFlightHours: null,
    owner: ownerRel ? companyCardFromFlat(ownerRel) : null,
    operator: opRel ? companyCardFromFlat(opRel) : null,
    chiefPilot: null,
    exclusiveBrokers: [],
    additionalRelations: [],
  }
}
```

---
# SOURCE: docs/id-system.md
---

# JETNET ID System

## The Core Principle

JETNET uses several distinct ID systems. None of them are the same thing. The most common mistake is confusing `regnbr` (the tail number humans use) with `aircraftid` (the integer the API uses). Once you have `aircraftid`, almost everything else follows from it.

## Quick Reference

| Goal | ID to Use |
|------|-----------|
| Look up an aircraft by tail number | `regnbr` (input to `getRegNumber`) |
| Call any aircraft sub-record endpoint | `aircraftid` |
| Filter a list by aircraft type | `modelid` (in `modlist`) |
| Filter a list to specific aircraft | `aircraftid` (in `aclist`) |
| Pull a company's full record or contacts | `companyid` |
| Cross-reference with manufacturer records | `serialnbr` |
| Deduplicate history sync records | `transid` |
| Geographic analysis and territory maps | `baseicao` |
| Store as permanent external key in your database | `aircraftid` (not `regnbr`) |

## Aircraft Identifiers

### `aircraftid` (integer)

JETNET's internal primary key for an aircraft. Every aircraft in the database has a unique `aircraftid` that never changes even if the registration number changes.

**Where you get it:** From `getRegNumber`, `getAircraftList`, `getBulkAircraftExport`, or any history/event record.

**When to use it:** As the join key for all sub-record calls — pictures, relationships, flight data, history. This is the ID to store if you are building a database or CRM integration.

**Example:** `144322`

### `regnbr` (string)

The registration number (tail number) — the human-readable identifier printed on the aircraft. In the US this is typically `N` followed by numbers and letters (e.g., `N131SF`). International registrations follow country-specific formats.

**Where you get it:** User input, or any aircraft record.

**When to use it:** As input to `getRegNumber` for a tail lookup. Do not use `regnbr` as a database primary key — it can change when an aircraft is re-registered. `aircraftid` is stable; `regnbr` is not.

**Example:** `"N131SF"`, `"G-XBEK"`, `"VH-NSX"`

### `serialnbr` (string)

The manufacturer's serial number (MSN). This is the number stamped on the airframe at the factory and never changes.

**Where you get it:** Any aircraft record — `getRegNumber`, `getAircraft`, `getAircraftList`.

**When to use it:** Cross-referencing with manufacturer records, logbooks, or export certificates. If you need a permanent external identifier that predates JETNET, this is it.

**Example:** `"UC-131"`, `"2192"`, `"20564"`

### `modelid` (integer)

JETNET's internal ID for a specific aircraft model (make + model combination). The Gulfstream G550 has one `modelid`; the Gulfstream G600 has a different one.

**Where you get it:** From any aircraft record, or from `getAircraftModelList` which returns a full list of models with their IDs for a given make.

**When to use it:** As input to `modlist` in any list, history, or flight endpoint when you want to filter by aircraft type.

**Example:** `145` (G550), `634` (G600), `1188` (Challenger 350)

### `icaotype` (string)

The four-character ICAO aircraft type designator. Used in flight planning systems and ATC.

**Where you get it:** Aircraft records — `getRegNumber`, `getAircraft`.

**When to use it:** Cross-referencing with flight tracking systems, ADS-B data, or ICAO databases. Not used as a JETNET filter parameter.

**Example:** `"GLF5"` (Gulfstream V/G550), `"A319"` (Airbus A319/ACJ319)

## Company Identifiers

### `companyid` (integer)

JETNET's internal primary key for a company (legal entity). Owners, operators, manufacturers, and fractional providers all have `companyid` values.

**Where you get it:** From any relationship record — `getRelationships`, `getHistoryList`, `getRegNumber` companyrelationships, `getCompanyList`.

**When to use it:** As input to company sub-record endpoints: `getCompany/{companyid}`, `getContacts/{companyid}`, `getRelatedcompanies/{companyid}`, `getAircraftrelationships/{companyid}`.

**Example:** `4425`, `350427`

### `parentcompanyid` (integer)

The `companyid` of the parent company if the company is a subsidiary. Zero (`0`) means no parent — the company is a standalone entity.

**Where you get it:** Company records and nested `company` objects in relationship arrays.

**When to use it:** Building corporate hierarchy trees, identifying subsidiaries for fleet analysis, or understanding if an "operator" is actually a wholly owned subsidiary of the named owner.

## Contact Identifiers

### `contactid` (integer)

JETNET's internal primary key for an individual person.

**Where you get it:** From relationship records in `getRelationships`, `getHistoryList`, and `getRegNumber` companyrelationships.

**When to use it:** As input to `getContact/{contactid}/{apiToken}` to pull the full contact record. Also used to de-duplicate contacts across multiple aircraft or company records.

**Example:** `747133`, `524808`

## Airport and Geography Identifiers

### `baseicao` / `icao` (string)

The four-character ICAO airport code for the aircraft's home base. More precise than IATA codes and the preferred identifier for aviation data systems.

**Where you get it:** Aircraft records (`baseicao`), flight records (`origin`, `destination`).

**When to use it:** For geographic analysis, territory mapping, and filtering. Use `getAirportList` to get a full airport list with ICAO codes and coordinates.

**Example:** `"KOMA"` (Omaha Eppley), `"KTEB"` (Teterboro), `"LLBG"` (Tel Aviv Ben Gurion)

### `baseiata` / `iata` (string)

The three-character IATA airport code. More familiar to non-aviation audiences but less precise than ICAO (some airports have ICAO but no IATA).

**Where you get it:** Aircraft records and flight records.

**When to use it:** When displaying to end users who expect airline-style codes. Prefer ICAO for data joins.

**Example:** `"OMA"`, `"TEB"`, `"TLV"`

## Transaction and Event Identifiers

### `transid` (integer)

The unique ID for a specific history transaction record. Every ownership change, sale, or update event has a `transid`.

**Where you get it:** From `getHistoryList` records.

**When to use it:** For deduplication when building incremental sync pipelines. The JETNET transaction detail URL also uses `transid`:

```
http://www.jetnetevolution.com/DisplayAircraftDetail.aspx?acid={aircraftid}&jid={transid}
```

---
# SOURCE: docs/data-model.md
---

# JETNET Data Model: Aircraft, Companies, and Contacts

How aircraft, companies, and contacts connect through relationships -- and how to traverse the graph to build complete intelligence profiles.

---

## Core Entities

JETNET's relational model revolves around four primary identifiers:

| Entity | Primary Key | Description |
|--------|-------------|-------------|
| Aircraft | `aircraftid` | Unique aircraft identifier (stable, never changes) |
| Company | `companyid` | Unique company identifier |
| Contact | `contactid` | Unique individual/person identifier |
| Relationship | Derived / Join | Defines how Aircraft ↔ Company ↔ Contact connect |

These IDs are stable and should always be stored in downstream systems. See [ID System](id-system.md) for details.

---

## The Entity Graph

Relationships are graph-based, not linear:

```
Aircraft (aircraftid)
       ↕
Company (companyid)
       ↕
Contact (contactid)
```

Each link has a **relationship type** attached to it. One aircraft can have multiple companies. One company can have multiple aircraft. One company can have many contacts. This is a graph, not a table.

---

## Aircraft ↔ Company (`aircraftid` → `companyid`)

This defines ownership and operational structure.

### Common Relationship Types

| Relationship Type | Meaning |
|-------------------|---------|
| Owner | Legal registered owner |
| Operator | Company operating the aircraft |
| Manager | Management company |
| Lessee | Leasing entity |
| Fractional Owner | Shared ownership participant |
| Parent Company | Corporate hierarchy link |

### How to Retrieve

1. Look up aircraft by registration → get `aircraftid`
2. Call `getRelationships` with the `aircraftid`
3. Extract: `companyid`, relationship type, `isoperator` flag

```
GET /api/Aircraft/getRegNumber/{regnbr}/{apiToken}     → aircraftid
POST /api/Aircraft/getRelationships/{apiToken}          → companyrelationships[]
GET /api/Company/getCompany/{companyid}/{apiToken}      → company profile
```

**Response key:** `companyrelationships` — an array where each entry has `companyid`, `companyname`, `relationtype`, and `isoperator` ("Y"/"N" as a string).

> **Gotcha:** `isoperator` is a string `"Y"` or `"N"`, not a boolean. See [Common Mistakes](common-mistakes.md).

---

## Company ↔ Contact (`companyid` → `contactid`)

This defines who works at or represents a company.

### Common Contact Roles

| Role | Meaning |
|------|---------|
| Executive | C-level leadership |
| Chief Pilot | Operational authority |
| Director of Maintenance | Maintenance authority |
| Aviation Manager | Aircraft oversight |
| Broker | Sales contact |
| Fleet Manager | Asset oversight |

### How to Retrieve

1. Get company via `companyid`
2. Call company-contact relationship endpoint
3. Extract: `contactid`, title, department

Then call the contact endpoint with `contactid` for the full profile.

```
POST /api/Contact/getContactListPaged/{apiToken}/{pagesize}/{pagenumber}
     → contactlist[]
GET /api/Contact/getContact/{contactid}/{apiToken}
     → full contact profile
```

**Response keys:** `contactlist` (from getContactListPaged), `contactIdentification` (from getIdentification).

> **Gotcha:** Contact search uses `getContactListPaged` → response key `contactlist`. Company search uses `getCompanyListPaged` → response key `companylist`. These are different from `getContactList` → `contacts` and `getCompanyList` → `companies`. See [Pagination](pagination.md).

---

## Aircraft ↔ Contact (Indirect Link)

There is no direct Aircraft → Contact join. The path is always:

```
Aircraft → Company → Contact
```

Example: Aircraft `aircraftid` 123 → Operator `companyid` 456 → Chief Pilot `contactid` 789. That Chief Pilot is operationally responsible for the aircraft.

For direct aircraft-contact relationships, use `getContAircraftRelationships` (see [Contacts](contacts.md)).

---

## Full Golden Path: Building the Complete Picture

### Step 1: Start with Aircraft

Input: `regnbr` (tail number) or `serialnbr`

```
GET /api/Aircraft/getRegNumber/{regnbr}/{apiToken}
```

Output: `aircraftid`, make, model, serial number, year manufactured, lifecycle status.

### Step 2: Get All Aircraft Relationships

```
POST /api/Aircraft/getRelationships/{apiToken}
Body: { "aclist": [aircraftid] }
```

Output: Array of company relationships with types.

Store as:
```json
[
  { "companyid": 456, "relationtype": "Owner" },
  { "companyid": 789, "relationtype": "Operator" }
]
```

### Step 3: Hydrate Company Records

For each `companyid`:

```
GET /api/Company/getCompany/{companyid}/{apiToken}
```

Output: Company name, location, segment, fleet size.

### Step 4: Get Contacts Per Company

For each `companyid`:

```
POST /api/Contact/getContactListPaged/{apiToken}/{pagesize}/{pagenumber}
Body: { "companyid": companyid }
```

Output: Contacts associated with that company, with titles and roles.

### Step 5: Build the Network Object

```json
{
  "aircraft": {
    "aircraftid": 123,
    "regnbr": "N650GD",
    "make": "Gulfstream",
    "model": "G650"
  },
  "companies": [
    {
      "companyid": 456,
      "companyname": "XYZ Holdings",
      "relationtype": "Owner",
      "contacts": [
        {
          "contactid": 789,
          "name": "John Smith",
          "title": "CEO"
        }
      ]
    }
  ]
}
```

This object represents the full ecosystem around that aircraft.

---

## Hierarchical Considerations

Companies may have parent-child relationships:

```
Holding Company (companyid: 100)
    ↓
Operating Entity (companyid: 200)
    ↓
Aircraft (aircraftid: 300)
```

To build accurate intelligence:

- Always check parent company via `getRelatedcompanies`
- Store both child `companyid` and parent `companyid`
- Do not assume operator = ultimate owner

---

## Time Sensitivity

Relationships can be current, historical, or pending.

Important fields:

- `startdate`
- `enddate`
- `iscurrent`

**For CRM use cases:** Filter to current relationships only.

**For transaction intelligence:** Include historical relationships to track ownership changes over time. See [History](history.md).

---

## Best Practices

### Always Store IDs

Never store names as foreign keys. Use `aircraftid`, `companyid`, and `contactid`.

Registration numbers change (re-registration). Company names change (mergers). IDs are permanent.

### Normalize Relationship Types

Create an internal enum map:

```
OWNER
OPERATOR
MANAGER
LESSEE
FRACTIONAL_OWNER
```

Avoid relying on raw string comparisons.

### Expect Many-to-Many

- One aircraft can have multiple companies (owner ≠ operator ≠ manager)
- One company can have multiple aircraft (fleet)
- One company can have many contacts (staff)

---

## Advanced Use Cases

### Lead Targeting

Find all aircraft operated by a company → find all decision-makers at that company → map contacts to fleet.

### Watchlist Monitoring

Monitor aircraft relationship changes, new operator assignments, and contact additions at operator companies using `getBulkAircraftExportPaged` with `aircraftchanges=true`. See [Bulk Export](bulk-export.md).

### M&A Intelligence

Detect aircraft moving between related `companyid` values, parent company restructuring, and contact changes at holding companies using [History](history.md) endpoints.

---

## Common Mistakes

| Mistake | Why It's Wrong | Fix |
|---------|---------------|-----|
| Assuming registration number is permanent | Aircraft get re-registered | Always use `aircraftid` |
| Assuming owner = operator | Often different entities | Check `relationtype` and `isoperator` |
| Not filtering historical relationships | Leads to outdated CRM data | Filter by `iscurrent` |
| Storing company names as keys | Names change | Use `companyid` |
| Treating contacts as standalone | Contacts are always tied to companies | Always join `contactid` → `companyid` |

---

## Related Docs

- [ID System](id-system.md) — Primary keys and how they connect
- [Aircraft](aircraft.md) — Full aircraft endpoint reference including `getRelationships`
- [Companies](companies.md) — Company lookup, search, and relationship endpoints
- [Contacts](contacts.md) — Contact lookup, search, and aircraft relationship endpoints
- [Common Mistakes](common-mistakes.md) — Every known gotcha

---
# SOURCE: docs/jetnet-lite.md
---

# JETNET Lite: Tail Number Research Portal

A reference architecture for building a lightweight JETNET lookup tool. Enter a tail number, get a complete dashboard: aircraft profile, owner/operator, company details, contacts, flight activity, and transaction history.

This is not a demo -- it's a blueprint for an internal research console that mirrors the core pages of JETNET Connect in a streamlined, single-input interface.

---

## What It Does

One input (tail number) triggers a 7-step API call sequence that produces a complete intelligence profile:

```
User enters: N650GD
                ↓
┌─────────────────────────────────────────────┐
│  Aircraft Profile                           │
│  Make | Model | Serial | Year | Lifecycle   │
├─────────────────────────────────────────────┤
│  Owner & Operator                           │
│  Company Name | Relationship | Location     │
├─────────────────────────────────────────────┤
│  Company Profile                            │
│  Address | Website | Business Type | Fleet  │
├─────────────────────────────────────────────┤
│  Decision-Maker Contacts                    │
│  Name | Title | Email | Phone               │
├─────────────────────────────────────────────┤
│  Flight Activity (Last 12 Months)           │
│  Date | Origin | Destination                │
├─────────────────────────────────────────────┤
│  Transaction History                        │
│  Date | Type | Buyer | Seller               │
└─────────────────────────────────────────────┘
```

---

## Application Structure

```
jetnet-lite/
├── app.py                     # Flask/FastAPI entry point
├── jetnet_client.py           # Auth, token refresh, request wrapper
├── services/
│   ├── aircraft_service.py    # Tail resolve + aircraft profile
│   ├── relationship_service.py
│   ├── flight_service.py
│   ├── history_service.py
│   ├── contact_service.py
│   └── company_service.py
├── templates/
│   ├── login.html
│   ├── dashboard.html
│   └── partials/
│       ├── aircraft_card.html
│       ├── relationships.html
│       ├── flights.html
│       ├── transactions.html
│       ├── contacts.html
│       └── company.html
└── requirements.txt
```

The service layer pattern keeps each API domain isolated. The client handles auth, token refresh, and error normalization (see [session helpers](../src/jetnet/session.py)).

---

## API Call Sequence

All 7 steps in order. Steps 3-7 can be parallelized after Step 1 resolves the `aircraftid`.

### Step 1: Resolve Tail Number → `aircraftid`

```
GET /api/Aircraft/getRegNumber/{regnbr}/{apiToken}
```

Returns the `aircraftid` -- the master join key for all subsequent calls.

**Response key:** `aircraftresult` (single object, not an array). This uses a **flat schema** with `companyrelation` (not `relationtype`).

> **Why not `getAircraftList`?** `getRegNumber` is a simple GET that returns one aircraft by exact registration. `getAircraftList` is a POST with filters -- heavier and unnecessary for a single tail lookup. See [Aircraft](aircraft.md).

### Step 2: Aircraft Profile

```
GET /api/Aircraft/getAircraft/{aircraftid}/{apiToken}
```

Returns the full aircraft record: make, model, serial number, year manufactured, lifecycle status, specifications.

**Response key:** `aircraft` -- a composite object with nested sub-records (identification, airframe, engine, avionics, etc.).

### Step 3: Owner/Operator Relationships

```
POST /api/Aircraft/getRelationships/{apiToken}
Body: { "aclist": [aircraftid] }
```

Returns company relationships: owner, operator, manager, trustee, fractional owner.

**Response key:** `relationships` -- array of objects with `companyid`, `companyname`, `relationtype`, `isoperator` ("Y"/"N" string).

Store the `companyid` values -- you need them for Steps 6 and 7.

### Step 4: Flight Activity

```
POST /api/Aircraft/getFlightDataPaged/{apiToken}/{pagesize}/{pagenumber}
Body: {
  "aircraftid": aircraftid,
  "startdate": "03/01/2025",
  "enddate": "02/28/2026"
}
```

Returns per-flight records: departure/arrival airports, dates, duration.

**Response key:** `flightdata`

> **Date format:** Must be `MM/DD/YYYY` with leading zeros. `3/1/2025` will fail. See [Common Mistakes](common-mistakes.md).

### Step 5: Transaction History

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pagesize}/{pagenumber}
Body: {
  "aircraftid": aircraftid,
  "transtype": ["None"],
  "startdate": "01/01/2015",
  "enddate": "02/28/2026"
}
```

Returns ownership transactions: sales, deliveries, registrations, leases.

**Response key:** `history`

> **Critical:** `transtype` must be `["None"]` to get all transaction types. An empty array `[]` may return nothing. See [Common Mistakes](common-mistakes.md).

> **Use `getHistoryListPaged`**, not `getHistoryList`. The non-paged version can timeout on aircraft with long histories. See [History](history.md).

### Step 6: Contacts

```
POST /api/Contact/getContactList/{apiToken}
Body: { "companyid": companyid }
```

Call this for each `companyid` from Step 3 to get decision-maker contacts.

**Response key:** `contacts`

> **Gotcha:** `getContactList` → response key `contacts`. `getContactListPaged` → response key `contactlist`. Different endpoints, different keys. See [Contacts](contacts.md).

### Step 7: Company Profile

```
POST /api/Company/getCompanyList/{apiToken}
Body: { "complist": [companyid] }
```

Returns company details: name, address, website, business type, fleet size, operator flag.

**Response key:** `companies`

> **Gotcha:** `getCompanyList` → response key `companies`. `getCompanyListPaged` → response key `companylist`. See [Companies](companies.md).

---

## Error Handling

Every call must check for these conditions:

| Condition | How to Detect | Action |
|-----------|--------------|--------|
| HTTP 200 but API error | `responsestatus` starts with `"ERROR"` or `"INVALID"` | Show error, don't parse data |
| Expired token | `responsestatus` contains `"INVALID SECURITY TOKEN"` | Re-authenticate, retry once |
| No aircraft found | Empty response from `getRegNumber` | Show "tail not found" message |
| Missing `companyid` | `companyrelationships` is empty | Skip Steps 6 and 7 gracefully |
| Date format rejected | API returns error | Validate `MM/DD/YYYY` with leading zeros before sending |

The session helpers (`src/jetnet/session.py` / `session.ts`) handle token refresh and error normalization automatically. See [Authentication](authentication.md) and [Response Handling](response-handling.md).

---

## Performance

Total API calls per lookup: 6-7 (depending on number of related companies).

### Parallelization

After Step 1 resolves the `aircraftid`, Steps 2-5 can run in parallel:

```python
import asyncio

aircraft, relationships, flights, history = await asyncio.gather(
    get_aircraft(aircraftid),
    get_relationships(aircraftid),
    get_flights(aircraftid, start, end),
    get_history(aircraftid, start, end),
)
```

Steps 6 and 7 depend on `companyid` from Step 3, so they run after relationships resolve.

### Caching

These responses change infrequently and are safe to cache:

| Data | Cache Duration | Why |
|------|---------------|-----|
| Aircraft profile | 24 hours | Specs rarely change |
| Company profile | 24 hours | Address/fleet size updates are infrequent |
| Transaction history | 1 hour | New transactions are low-frequency |
| Flight activity | 15 minutes | Flights update more frequently |
| Relationships | 1 hour | Ownership changes are event-driven |

---

## Deployment

```bash
pip install flask requests
export JETNET_EMAIL="your_email@example.com"
export JETNET_PASSWORD="your_password"
python app.py
```

Use HTTPS only. Never expose `apiToken` to the browser -- keep it server-side.

---

## What This Becomes

At its core, this is an internal JETNET research console:

- **Aircraft page** -- specs, lifecycle, status
- **Company page** -- owner/operator profile, fleet size
- **Contact page** -- decision-makers with titles and contact info
- **Flight activity** -- where the aircraft has been
- **Market history** -- every transaction on record

All from a single tail number input.

### Extensions

Once the base is working, you can add:

- Market trends tab (`getModelMarketTrends`)
- Model comparison (`getModelPerformanceSpecs`)
- Export to CSV/PDF
- CRM push (Salesforce, HubSpot)
- AI summary panel (feed the dashboard data to an LLM)
- Activity heatmap (aggregate flight data by airport)

---

## Related Docs

- [Data Model](data-model.md) -- How Aircraft, Company, and Contact entities connect
- [Authentication](authentication.md) -- Login flow, token refresh, dual-token pattern
- [Common Mistakes](common-mistakes.md) -- Every known gotcha
- [Response Shapes](response-shapes.md) -- Normalized UI contracts (AircraftCard, CompanyCard)
- [Aircraft](aircraft.md) -- Full aircraft endpoint reference
- [Companies](companies.md) -- Company endpoint reference
- [Contacts](contacts.md) -- Contact endpoint reference
- [Flight Data](flight-data.md) -- Flight activity endpoints
- [History](history.md) -- Transaction history endpoints
- [Pagination](pagination.md) -- Paging patterns for large datasets

---
# SOURCE: docs/junior-dev-guide.md
---

# Junior Developer Guide

Everything a new developer needs to start building with the JETNET API. This guide cuts through the 40+ endpoints and shows you only what matters for your first integration.

---

## The 4 Endpoints That Matter First

You don't need to learn 40 endpoints. Start with these 4:

| # | Endpoint | What It Does |
|---|----------|-------------|
| 1 | `POST /api/Admin/APILogin` | Get your tokens |
| 2 | `GET /api/Aircraft/getRegNumber/{reg}/{apiToken}` | Look up a tail number |
| 3 | `GET /api/Aircraft/getAircraft/{id}/{apiToken}` | Get full aircraft record |
| 4 | `POST /api/Aircraft/getRelationships/{apiToken}` | Get owner/operator |

That's it. Everything else is optional until you need it.

---

## Step 1: Authenticate (2 minutes)

```python
import requests

BASE = "https://customer.jetnetconnect.com"

resp = requests.post(f"{BASE}/api/Admin/APILogin", json={
    "emailAddress": "your_email@example.com",
    "password": "your_password"
})

data = resp.json()
bearer = data["bearerToken"]
api_token = data["apiToken"]
```

**Three things to remember:**
- `emailAddress` has a capital **A** -- `emailaddress` fails silently
- You get two tokens: `bearerToken` goes in the `Authorization` header, `apiToken` goes in the URL path
- Tokens expire after 60 minutes -- refresh at 50 minutes

```javascript
const BASE = "https://customer.jetnetconnect.com";

const resp = await fetch(`${BASE}/api/Admin/APILogin`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    emailAddress: "your_email@example.com",
    password: "your_password"
  })
});

const { bearerToken, apiToken } = await resp.json();
```

> **Don't build your own auth logic.** Copy [`src/jetnet/session.py`](../src/jetnet/session.py) (Python) or [`src/jetnet/session.ts`](../src/jetnet/session.ts) (TypeScript) into your project. They handle login, token refresh, retry on expired tokens, and error normalization automatically.

---

## Step 2: Look Up a Tail Number

```python
headers = { "Authorization": f"Bearer {bearer}" }

resp = requests.get(
    f"{BASE}/api/Aircraft/getRegNumber/N650GD/{api_token}",
    headers=headers
)

data = resp.json()

# IMPORTANT: Always check responsestatus first
if not data.get("responsestatus", "").startswith("SUCCESS"):
    print(f"Error: {data.get('responsestatus')}")
else:
    aircraft = data["aircraftresult"]
    aircraft_id = aircraft["aircraftid"]
    print(f"Found: {aircraft['make']} {aircraft['model']} (ID: {aircraft_id})")
```

```javascript
const resp = await fetch(
  `${BASE}/api/Aircraft/getRegNumber/N650GD/${apiToken}`,
  { headers: { Authorization: `Bearer ${bearerToken}` } }
);

const data = await resp.json();

if (!data.responsestatus?.startsWith("SUCCESS")) {
  console.error("Error:", data.responsestatus);
} else {
  const aircraft = data.aircraftresult;
  console.log(`Found: ${aircraft.make} ${aircraft.model} (ID: ${aircraft.aircraftid})`);
}
```

---

## Step 3: Get the Full Aircraft Record

```python
resp = requests.get(
    f"{BASE}/api/Aircraft/getAircraft/{aircraft_id}/{api_token}",
    headers=headers
)
data = resp.json()
if not data.get("responsestatus", "").startswith("SUCCESS"):
    print(f"Error: {data.get('responsestatus')}")
else:
    full = data["aircraft"]
    print(f"{full['make']} {full['model']} — SN: {full['sernbr']}, Year: {full['yearmfr']}")
```

---

## Step 4: Get Owner/Operator

```python
resp = requests.post(
    f"{BASE}/api/Aircraft/getRelationships/{api_token}",
    headers=headers,
    json={ "aclist": [aircraft_id] }
)
data = resp.json()
if not data.get("responsestatus", "").startswith("SUCCESS"):
    print(f"Error: {data.get('responsestatus')}")
else:
    for rel in data["relationships"]:
        print(f"{rel['companyname']} — {rel['relationtype']}")
```

---

## You're Done

Those 4 calls give you: aircraft identity, full specs, and owner/operator relationships. Everything else in the API builds on this foundation.

**Next steps when you're ready:**
- Flight activity → [Flight Data](flight-data.md)
- Transaction history → [History](history.md)
- Contacts at the owner company → [Contacts](contacts.md)
- Search for aircraft by model → [Aircraft](aircraft.md) (`getAircraftList`)
- Build a full lookup tool → [JETNET Lite](jetnet-lite.md)

---

## The 5 Things That Will Bite You

These are the errors every new developer hits. Memorize them now and save hours of debugging.

### 1. HTTP 200 Does Not Mean Success

The JETNET API always returns HTTP 200, even on errors. You must check `responsestatus`:

```python
data = resp.json()
if data.get("responsestatus", "").startswith("ERROR"):
    raise Exception(f"API error: {data['responsestatus']}")
```

### 2. Dates Must Be `MM/DD/YYYY` with Leading Zeros

```
✅ "01/01/2024"
❌ "1/1/2024"
❌ "2024-01-01"
```

```python
from datetime import date

def format_date(d):
    return d.strftime("%m/%d/%Y")
```

```javascript
function formatDate(d) {
  const mm = String(d.getMonth() + 1).padStart(2, "0");
  const dd = String(d.getDate()).padStart(2, "0");
  return `${mm}/${dd}/${d.getFullYear()}`;
}
```

### 3. `transtype` Must Be `["None"]`, Not `[]`

When querying transaction history and you want all types:

```
✅ "transtype": ["None"]
❌ "transtype": []
```

An empty array may return nothing.

### 4. `forsale` Is a String, Not a Boolean

```
✅ "forsale": "true"
❌ "forsale": true
```

### 5. Token Refresh — Don't Wait for Failure

Tokens expire after 60 minutes. Don't wait for `INVALID SECURITY TOKEN` -- refresh proactively at 50 minutes:

```python
import time

login_time = time.time()

def ensure_valid():
    if time.time() - login_time > 3000:  # 50 minutes
        login()  # Re-authenticate
```

Or just use the session helpers -- they do this automatically.

---

## Error Decoder

When something goes wrong, find your error here:

| `responsestatus` Value | Meaning | Fix |
|----------------------|---------|-----|
| `ERROR: INVALID SECURITY TOKEN` | Token expired | Re-authenticate and retry |
| `ERROR: INVALID CATEGORY` | Enum value wrong | Check exact casing in [Enum Reference](enum-reference.md) |
| `ERROR: VALIDATION` | Bad field format | Check date format, field types |
| `SUCCESS - NO RECORDS FOUND` | Query is valid but no results | Broaden your filters |
| *(empty or missing)* | Field name wrong | Check `emailAddress` casing, field names |

---

## Minimal Request Bodies

The API has many optional fields. Here's the minimum you need for the most common calls:

### getFlightDataPaged — Minimum

```json
{
  "aircraftid": 12345,
  "startdate": "01/01/2025",
  "enddate": "02/28/2026"
}
```

### getHistoryListPaged — Minimum

```json
{
  "aircraftid": 12345,
  "transtype": ["None"],
  "startdate": "01/01/2024",
  "enddate": "12/31/2024"
}
```

### getAircraftList — Minimum (G650s for sale)

```json
{
  "modlist": [278],
  "forsale": "true",
  "lifecycle": "InOperation"
}
```

### getRelationships — Minimum

```json
{
  "aclist": [12345]
}
```

### getContactList — Minimum

```json
{
  "companyid": 67890
}
```

### getCompanyList — Minimum

```json
{
  "complist": [67890]
}
```

Everything else in these request bodies is optional. Add filters only when you need to narrow results.

---

## How Endpoints Connect

```
Tail Number (e.g., N650GD)
        │
        ▼
   getRegNumber ──────► aircraftid (the master join key)
        │
        ├──► getAircraft ────────► specs, lifecycle, serial
        │
        ├──► getRelationships ──► companyid + relationship type
        │         │
        │         ├──► getCompanyList ──► company profile
        │         │
        │         └──► getContactList ──► decision-makers
        │
        ├──► getFlightDataPaged ► flight activity
        │
        └──► getHistoryListPaged ► transaction history
```

Everything starts with `aircraftid`. Get that first, then branch out to whatever data you need.

For the full entity model, see [Data Model](data-model.md).

---

## Session Helpers — Use Them

Don't build your own auth/retry logic. The repo includes production-ready session helpers:

| File | Language | What It Handles |
|------|----------|----------------|
| [`src/jetnet/session.py`](../src/jetnet/session.py) | Python | Login, token refresh at 50 min, auto-retry on expired token, `responsestatus` checking, error normalization |
| [`src/jetnet/session.ts`](../src/jetnet/session.ts) | TypeScript | Same features, async/await pattern |

Copy one into your project. Call `ensure_session()` before every request and it handles everything.

---

## Related Docs

- [START_HERE.md](../START_HERE.md) — Pick your path (demo, bulk data, CRM, AI agent, MCP)
- [Common Mistakes](common-mistakes.md) — Full list of every known gotcha (30+ entries)
- [Authentication](authentication.md) — Deep dive on the dual-token pattern
- [Enum Reference](enum-reference.md) — Valid values for every enum field
- [Data Model](data-model.md) — How Aircraft, Company, and Contact entities connect
- [JETNET Lite](jetnet-lite.md) — Full reference architecture for a lookup tool
- [Aircraft](aircraft.md) — All 21 aircraft endpoints

---
# SOURCE: docs/common-mistakes.md
---

# Common Mistakes

## Authentication

### `emailAddress` has a capital A

The login field is `emailAddress` — not `email`, `emailaddress`, or `email_address`. This is the single most common auth mistake.

```json
// Wrong
{ "email": "user@example.com", "password": "..." }
{ "emailaddress": "user@example.com", "password": "..." }

// Correct
{ "emailAddress": "user@example.com", "password": "..." }
```

### `apiToken` goes in the URL path only

The `apiToken` is placed in the URL path — never in headers or the JSON body.

```
// Wrong
Authorization: Bearer {bearerToken} {apiToken}
{ "apiToken": "abc123", ... }

// Correct
GET /api/Aircraft/getRegNumber/N123AB/{apiToken}
Authorization: Bearer {bearerToken}
```

## Response Handling

### HTTP 200 does not mean success

JETNET returns HTTP 200 for most responses, including errors. Always check `responsestatus`:

```python
result = r.json()
if "ERROR" in result.get("responsestatus", "").upper():
    raise ValueError(f"JETNET error: {result['responsestatus']}")
```

### `companyrelation` vs `relationtype`

Different endpoints use different field names for the relationship type. Using the wrong field returns nothing:

| Endpoint | Field Name |
|----------|-----------|
| `getRegNumber` | `companyrelation` |
| `getHistoryList` / `getRelationships` | `relationtype` |
| `getBulkAircraftExport` | Field prefix (`owr*`, `opr*`, `chp*`) |
| `getAcCompanyFractionalReportPaged` | `relation` |

See [Response Handling](response-handling.md) for the full schema comparison.

### `"SUCCESS: NO RESULTS FOUND"` is a normal response

Several endpoints return `responsestatus` values like `"SUCCESS: NO RESULTS FOUND [PHONE NUMBERS]"` when a query matches zero records. This is **not an error** — it is a valid business state. Use a prefix check, not strict equality:

```python
# Wrong — breaks on "SUCCESS: NO RESULTS FOUND [...]"
if result["responsestatus"] != "SUCCESS":
    raise ValueError("Request failed")

# Correct — treats any SUCCESS prefix as OK
if not result.get("responsestatus", "").upper().startswith("SUCCESS"):
    raise ValueError(f"JETNET error: {result['responsestatus']}")
```

```javascript
// Wrong
if (data.responsestatus !== "SUCCESS") throw new Error("Failed");

// Correct
if (!(data.responsestatus || "").toUpperCase().startsWith("SUCCESS")) {
  throw new Error(`JETNET error: ${data.responsestatus}`);
}
```

### Null arrays — guard before iterating

Fields like `phonenumbers`, `relatedcompanies`, and `companycertifications` return `null` (not `[]`) when empty. Any code calling `.map()` or `.forEach()` without a guard will crash:

```python
# Wrong — TypeError if phonenumbers is None
for p in result["phonenumbers"]:
    print(p)

# Correct
for p in result.get("phonenumbers") or []:
    print(p)
```

```javascript
// Wrong — Cannot read properties of null
data.phonenumbers.map(p => p.number);

// Correct
(data.phonenumbers ?? []).map(p => p.number);
```

### `isoperator` is a `"Y"` / `"N"` string

In relationship data, `isoperator` is a string, not a boolean:

```python
# Wrong — always truthy because "N" is a non-empty string
if record["isoperator"]:

# Correct
if record["isoperator"] == "Y":
```

## URL Shape Variations

### Mixed URL patterns across endpoints

JETNET endpoints use three different URL patterns. Trying to build all paths with a single template will break:

```
# Pattern 1: POST body + token only
POST /api/Contact/getContactList/{apiToken}

# Pattern 2: Resource ID + token
GET /api/Contact/getContact/{contactId}/{apiToken}

# Pattern 3: Token + pagination in path
POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pageSize}/{page}
```

Build your URL helper to accept optional `id`, `pageSize`, and `page` parameters rather than assuming one shape fits all.

## Response key changes between paged and non-paged variants

The non-paged and paged versions of the same search endpoint use **different response keys**:

| Endpoint (non-paged) | Response key | Endpoint (paged) | Response key |
|----------------------|-------------|------------------|-------------|
| `getContactList` | `contacts` | `getContactListPaged` | `contactlist` |
| `getCompanyList` | `companies` | `getCompanyListPaged` | `companylist` |

Non-paged endpoints also return `currentpage: 0` and `maxpages: 0` — do **not** interpret these as paging metadata.

```python
# Wrong — assumes same key for both variants
data = response.json()
records = data["contacts"]  # works for non-paged, breaks for paged

# Correct — use the right key per variant
if is_paged:
    records = data["contactlist"]
else:
    records = data["contacts"]
```

## N+1 and Fan-Out Risks

### Company → Contacts returns ID arrays, not full objects

`getContacts` (`/api/Company/getContacts/{companyId}/{apiToken}`) returns contact IDs as a plain array — not hydrated contact objects:

```json
{ "contacts": [523097, 282591, 198443] }
```

To get full contact data, you must call `getContact` or `getIdentification` for **each** ID. This creates an N+1 fan-out problem. Mitigate with concurrency limits:

```python
import asyncio

sem = asyncio.Semaphore(5)

async def fetch_contact(session, contact_id):
    async with sem:
        return await session.get(f".../getContact/{contact_id}/{token}")

tasks = [fetch_contact(session, cid) for cid in contact_ids]
contacts = await asyncio.gather(*tasks)
```

```javascript
// Limit concurrency to 5 at a time
const pLimit = (await import("p-limit")).default;
const limit = pLimit(5);

const contacts = await Promise.all(
  contactIds.map(id => limit(() => fetchContact(id)))
);
```

### `ownerpercent` can be null even when relationship exists

Do not assume `ownerpercent` or `fractionexpiresdate` are always populated on ownership/fractional relationships. Always provide a fallback:

```python
pct = record.get("ownerpercent") or "0.00"
```

## Filters and Payloads

### Empty `aclist: []` means no filter, not empty results

Sending `"aclist": []` does not return zero results — it removes the aircraft filter entirely, returning all matching records. Be intentional:

```json
// Returns ALL aircraft (no filter)
{ "aclist": [], "modlist": [] }

// Returns only these specific aircraft
{ "aclist": [128228, 242781], "modlist": [] }
```

### `transtype: ["None"]` not `[]` for all history types

To get all transaction types in history queries, send `["None"]` — not an empty array:

```json
// Wrong — may not return all types
{ "transtype": [] }

// Correct — returns all transaction types
{ "transtype": ["None"] }
```

## Date Formatting

### Use `MM/DD/YYYY` with leading zeros

JETNET requires `MM/DD/YYYY` format with leading zeros:

```json
// Wrong
{ "startdate": "1/1/2024" }

// Correct
{ "startdate": "01/01/2024" }
```

### `getBulkAircraftExport` accepts datetime strings

The `actiondate` and `enddate` fields accept full datetime strings for hourly polling windows:

```json
{ "actiondate": "02/26/2026 10:00:00", "enddate": "02/26/2026 11:00:00" }
```

## String Booleans

### `forsale` in responses is a string

In most endpoints, `forsale` is `"true"` or `"false"` (strings), not JSON booleans:

```python
# Wrong
if record["forsale"]:  # Always truthy because it's a non-empty string

# Correct
if record["forsale"] == "true":
```

### `getBulkAircraftExport` uses `"Y"` / `"N"` for forsale

The bulk export endpoint uses a different convention:

```python
# In getBulkAircraftExport
if record["forsale"] == "Y":
```

### `datepurchased` format differs in bulk export

In `getBulkAircraftExport`, `datepurchased` is `YYYYMMDD` format (not `MM/DD/YYYY`).

## Endpoint-Specific Issues

### `getAircraftList` has no paged variant

Unlike most list endpoints, `getAircraftList` does not have a paged version. Use filters (`modlist`, geographic params, `forsale`) to control result size.

### `getEventList` enum values are strict

Sending unrecognized enum values to `getEventList` produces an `ERROR` in `responsestatus` despite HTTP 200. Use `getEventTypes` and `getEventCategories` to get valid values first.

### `getBulkAircraftExport` returns `maxpages: 0` for single-page results

When all results fit in one call, the response has `maxpages: 0` and `currentpage: 0`. Use `max(maxpages, 1)` in your loop or you will exit immediately and miss all records:

```python
if page >= max(data.get("maxpages", 1), 1):
    break
```

### `getAcCompanyFractionalReportPaged` response key

The response key is `aircraftcompfractionalrefs`. Each row is one relationship per aircraft:

- `fractionPercentOwned: "100.00"` = actual owner
- `fractionPercentOwned: "0.00"` = operator/manager on same aircraft
- The `relationship` filter is an array: `["Fractional Owner"]`

## Field Name Gotchas

### `getRegNumber` flat companyrelationships

The flat schema uses `companyrelation` and prefixed fields (`companyname`, `contactfirstname`). For FBO ramp contact lookup, filter on `contacttitle` for Chief Pilot, Director of Aviation, Scheduler, or Dispatcher.

### `getBulkAircraftExport` flat prefixed schema

Role-prefixed fields: `owr*` = owner, `opr*` = operator, `chp*` = chief pilot, `excbrk1*`/`excbrk2*` = brokers, `addl1-3*` = additional. This is not the same schema as `getRegNumber` or `getRelationships`.

---
# SOURCE: docs/enum-reference.md
---

# Enum Reference

## airframetype

Filters by aircraft airframe category.

| Value | Description |
|-------|-------------|
| `None` | No filter (all airframe types) |
| `FixedWing` | Fixed-wing aircraft |
| `Rotary` | Rotorcraft (helicopters) |

## maketype

Filters by aircraft propulsion/category.

| Value | Description |
|-------|-------------|
| `None` | No filter (all make types) |
| `JetAirliner` | Commercial jet airliners |
| `BusinessJet` | Business jets |
| `Turboprop` | Turboprop aircraft |
| `Piston` | Piston-engine aircraft |
| `Turbine` | Turbine-powered (helicopters) |

## lifecycle

Filters by aircraft operational status.

| Value | Description |
|-------|-------------|
| `None` | No filter (all lifecycle stages) |
| `InProduction` | Currently being manufactured |
| `NewWithManufacturer` | Completed but not yet delivered |
| `InOperation` | Active and in service |
| `Retired` | Permanently out of service |
| `InStorage` | Temporarily inactive / stored |

## forsale (Request)

Filters by for-sale status in request payloads. These are **string values**, not booleans.

| Value | Description |
|-------|-------------|
| `"true"` | Only aircraft listed for sale |
| `"false"` | Only aircraft not listed for sale |
| `""` | No filter (all aircraft) |

> **Note:** In `getBulkAircraftExport` responses, `forsale` uses `"Y"` / `"N"` instead.

## isnewaircraft / ispreownedtrans / isinternaltrans

Three-state filters used in history and transaction queries.

| Value | Description |
|-------|-------------|
| `"Yes"` | Include only matching records |
| `"No"` | Exclude matching records |
| `"Ignore"` | No filter on this field |

## transtype (Request)

Transaction type categories used in history list request payloads. These are **category labels**, not the full descriptive strings returned in responses.

| Value | Description |
|-------|-------------|
| `"None"` | All transaction types (no filter) |
| `"FullSale"` | Full sale transactions |
| `"Lease"` | Lease transactions |
| `"InternalSale"` | Internal/corporate transfers |
| `"Management"` | Management changes |
| `"Insurance"` | Insurance-related transactions |
| `"Repossession"` | Repossession events |
| `"Registration"` | Registration changes |

> **Important:** Use `["None"]` (not `[]`) to retrieve all transaction types.

## transtype (Response)

In **response** records, `transtype` is a full descriptive string. These are different from the request category values.

Examples of response values:
- `"Full Sale - Retail to Retail"`
- `"Full Sale - Retail to Wholesale"`
- `"Lease - Operating Lease"`
- `"Internal Sale - Corporate Restructure"`

Do not use response `transtype` values in request payloads — they will not match.

## Make Names

Make names in the API are **all-caps strings**:

| Value | Manufacturer |
|-------|-------------|
| `"GULFSTREAM"` | Gulfstream Aerospace |
| `"BOMBARDIER"` | Bombardier Aviation |
| `"DASSAULT"` | Dassault Aviation |
| `"CESSNA"` | Cessna / Textron Aviation |
| `"EMBRAER"` | Embraer |
| `"BEECHCRAFT"` | Beechcraft / Textron Aviation |
| `"PILATUS"` | Pilatus Aircraft |
| `"AIRBUS"` | Airbus |
| `"BOEING"` | Boeing |

Use `getAircraftMakeList` to get the complete list of valid make names.

---
# SOURCE: docs/aircraft.md
---

# JETNET Aircraft Endpoints

## Conceptual Model

Aircraft endpoints cover the full lifecycle of a single aircraft record. JETNET models an aircraft as a **composite document** -- a root record (`getAircraft`) composed of independent sub-records that can be fetched individually or bundled together.

```
                    ┌──────────────┐
                    │  getAircraft │  (full composite)
                    └──────┬───────┘
                           │
    ┌──────────┬───────────┼───────────┬──────────┐
    │          │           │           │          │
┌───┴───┐ ┌───┴───┐ ┌─────┴─────┐ ┌──┴───┐ ┌───┴────┐
│ Ident │ │Engine │ │ Avionics  │ │ Pics │ │Company │
│       │ │       │ │ Features  │ │      │ │  Rels  │
│Status │ │  APU  │ │ AddlEquip │ │Lease │ │        │
│Airfrm │ │       │ │ Int / Ext │ │      │ │        │
│ Maint │ │       │ │           │ │      │ │        │
└───────┘ └───────┘ └───────────┘ └──────┘ └────────┘
```

You have three access patterns:

| Pattern | When to Use | Endpoint |
|---------|-------------|----------|
| Full record | Need everything for one aircraft | `getAircraft` |
| Sub-record | Need one section (e.g., engines only) | `getEngine`, `getAirframe`, etc. |
| Quick lookup | Start from tail number or hex code | `getRegNumber`, `getHexNumber` |

---

## Endpoints

| # | Endpoint | Method | Path | Response Key |
|---|----------|--------|------|-------------|
| 1 | getAircraft | GET | `/api/Aircraft/getAircraft/{id}/{apiToken}` | `aircraft` |
| 2 | getIdentification | GET | `/api/Aircraft/getIdentification/{id}/{apiToken}` | `identification` |
| 3 | getStatus | GET | `/api/Aircraft/getStatus/{id}/{apiToken}` | `status` |
| 4 | getAirframe | GET | `/api/Aircraft/getAirframe/{id}/{apiToken}` | `airframe` |
| 5 | getEngine | GET | `/api/Aircraft/getEngine/{id}/{apiToken}` | `engine` |
| 6 | getApu | GET | `/api/Aircraft/getApu/{id}/{apiToken}` | `apu` |
| 7 | getAvionics | GET | `/api/Aircraft/getAvionics/{id}/{apiToken}` | `avionics` |
| 8 | getFeatures | GET | `/api/Aircraft/getFeatures/{id}/{apiToken}` | `features` |
| 9 | getAdditionalEquipment | GET | `/api/Aircraft/getAdditionalEquipment/{id}/{apiToken}` | `additionalequipment` |
| 10 | getInterior | GET | `/api/Aircraft/getInterior/{id}/{apiToken}` | `interior` |
| 11 | getExterior | GET | `/api/Aircraft/getExterior/{id}/{apiToken}` | `exterior` |
| 12 | getMaintenance | GET | `/api/Aircraft/getMaintenance/{id}/{apiToken}` | `maintenance` |
| 13 | getLeases | GET | `/api/Aircraft/getLeases/{id}/{apiToken}` | `leases` |
| 14 | getPictures | GET | `/api/Aircraft/getPictures/{id}/{apiToken}` | `pictures` |
| 15 | getCompanyrelationships | GET | `/api/Aircraft/getCompanyrelationships/{id}/{apiToken}` | `companyrelationships` |
| 16 | getFlights | GET | `/api/Aircraft/getFlights/{id}/{apiToken}` | `flightsummary` |
| 17 | getRegNumber | GET | `/api/Aircraft/getRegNumber/{reg}/{apiToken}` | `aircraftresult` |
| 18 | getHexNumber | GET | `/api/Aircraft/getHexNumber/{hex}/{apiToken}` | `aircraft` |
| 19 | getAircraftList | POST | `/api/Aircraft/getAircraftList/{apiToken}` | `aircraft` |
| 20 | getRelationships | POST | `/api/Aircraft/getRelationships/{apiToken}` | `relationships` |
| 21 | getAllAircraftObjects | POST | `/api/Aircraft/getAllAircraftObjects/{apiToken}/{pagesize}/{page}` | `allaircraftobjects` |

Endpoints with dedicated docs (not duplicated here):

| Endpoint | See |
|----------|-----|
| getHistoryListPaged | [docs/history.md](history.md) |
| getEventListPaged | [docs/events.md](events.md) |
| getFlightDataPaged / getFlights | [docs/flight-data.md](flight-data.md) |
| getBulkAircraftExportPaged | [docs/bulk-export.md](bulk-export.md) |
| getCondensedOwnerOperatorsPaged | [docs/trends.md](trends.md) |
| getCondensedSnapshot | [docs/snapshots.md](snapshots.md) |
| getAcCompanyFractionalReportPaged | [docs/response-handling.md](response-handling.md) |
| getAcSellerPurchaserReportPaged | [references/endpoints.md](../references/endpoints.md) |

---

## 1. getAircraft (Full Record)

```
GET /api/Aircraft/getAircraft/{id}/{apiToken}
```

Returns the complete aircraft record for a single `aircraftid`. This is the bundled composite -- it includes identification, status, airframe, engines, avionics, features, interior, exterior, maintenance, leases, pictures, and company relationships as nested objects.

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "aircraft": {
    "identification": {
      "aircraftid": 12345,
      "modelid": 278,
      "make": "Gulfstream Aerospace",
      "model": "G550",
      "sernbr": "5432",
      "regnbr": "N550GD",
      "yearmfr": 2014,
      "yeardlv": 2015,
      "actiondate": "2025-01-15T00:00:00",
      "pageurl": "..."
    },
    "airframe": { ... },
    "engine": { ... },
    "apu": { ... },
    "avionics": [ ... ],
    "features": [ ... ],
    "additionalequipment": [ ... ],
    "interior": { ... },
    "exterior": { ... },
    "maintenance": { ... },
    "leases": [ ... ],
    "pictures": [ ... ],
    "companyrelationships": [ ... ],
    "status": { ... }
  }
}
```

### When to Use

Use `getAircraft` when you need the full profile for a single aircraft. For targeted data (e.g., just engines or just maintenance), use the individual sub-record endpoints instead -- they return faster and consume less bandwidth.

---

## 2. getIdentification

```
GET /api/Aircraft/getIdentification/{id}/{apiToken}
```

Returns the identification header for an aircraft: make, model, registration, serial number, year manufactured, year delivered, and metadata.

### Response Key

`identification`

### Key Fields

| Field | Type | Description |
|-------|------|-------------|
| `aircraftid` | integer | Primary key |
| `modelid` | integer | Model ID (AMODID) for `modlist` filters |
| `make` | string | Manufacturer name |
| `model` | string | Model designation |
| `sernbr` | string | Manufacturer serial number |
| `regnbr` | string | Registration / tail number |
| `yearmfr` | integer | Year manufactured |
| `yeardlv` | integer | Year delivered |
| `actiondate` | string (ISO) | Last data update |
| `pageurl` | string | JETNET web page URL |

---

## 3. getStatus

```
GET /api/Aircraft/getStatus/{id}/{apiToken}
```

Returns lifecycle and market status indicators: whether the aircraft is in operation, for sale, in storage, retired, etc.

### Response Key

`status`

---

## 4. getAirframe

```
GET /api/Aircraft/getAirframe/{id}/{apiToken}
```

Returns airframe time and landing metrics.

### Response Key

`airframe`

### Key Fields

| Field | Type | Description |
|-------|------|-------------|
| `aftt` | number | Airframe total time (hours) |
| `landings` | number | Total landings |
| `timesasofdate` | string (ISO) | Date when times were last reported |
| `estaftt` | number | Estimated airframe total time |

---

## 5. getEngine

```
GET /api/Aircraft/getEngine/{id}/{apiToken}
```

Returns engine details including maintenance program enrollment and per-engine times.

### Response Key

`engine`

### Response Structure

The `engine` object contains top-level fields plus an `engines` array for per-engine data:

```json
{
  "responsestatus": "SUCCESS",
  "engine": {
    "maintenanceprogram": "MSP Gold",
    "model": "BR725",
    "enginenoiserating": "Stage 4",
    "engines": [
      {
        "sequencenumber": 1,
        "serialnumber": "E-12345",
        "timesincenew": 4500,
        "tbo": 8000
      },
      {
        "sequencenumber": 2,
        "serialnumber": "E-12346",
        "timesincenew": 4500,
        "tbo": 8000
      }
    ]
  }
}
```

### Gotcha

The response has two levels: the outer `engine` object (model-level data) and the inner `engines` array (per-engine data). Don't confuse `data["engine"]` with `data["engine"]["engines"]`.

---

## 6. getApu

```
GET /api/Aircraft/getApu/{id}/{apiToken}
```

Returns APU (Auxiliary Power Unit) details when available.

### Response Key

`apu` (object or `null`)

### Null Handling

Many aircraft have no APU data. When no APU exists:

```json
{
  "responsestatus": "SUCCESS: NO RESULTS FOUND [APU]",
  "apu": null
}
```

Always check for `null` before accessing APU fields. Also note that `responsestatus` starts with `"SUCCESS"` even when no data is found -- use `.startsWith("SUCCESS")`, not strict equality.

---

## 7. getAvionics

```
GET /api/Aircraft/getAvionics/{id}/{apiToken}
```

Returns installed avionics packages.

### Response Key

`avionics` (array) + `count`

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "count": 3,
  "avionics": [
    { "name": "Collins Pro Line 21", "description": "Integrated avionics suite" },
    { "name": "HUD/EVS", "description": "Head-up display with enhanced vision" }
  ]
}
```

---

## 8. getFeatures

```
GET /api/Aircraft/getFeatures/{id}/{apiToken}
```

Returns aircraft feature list (cabin options, systems, modifications).

### Response Key

`features` (array) + `count`

---

## 9. getAdditionalEquipment

```
GET /api/Aircraft/getAdditionalEquipment/{id}/{apiToken}
```

Returns additional installed equipment, often free-text descriptions.

### Response Key

`additionalequipment` (array) + `count`

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "count": 2,
  "additionalequipment": [
    { "name": "WiFi", "description": "Gogo AVANCE L5 broadband with global coverage" },
    { "name": "Satcom", "description": "Honeywell JetWave Ka-band satellite" }
  ]
}
```

---

## 10. getInterior

```
GET /api/Aircraft/getInterior/{id}/{apiToken}
```

Returns interior configuration, cabin layout, and refurbishment notes.

### Response Key

`interior`

---

## 11. getExterior

```
GET /api/Aircraft/getExterior/{id}/{apiToken}
```

Returns paint scheme, exterior configuration, and repaint history.

### Response Key

`exterior`

---

## 12. getMaintenance

```
GET /api/Aircraft/getMaintenance/{id}/{apiToken}
```

Returns maintenance status, program enrollment, and coverage notes.

### Response Key

`maintenance`

---

## 13. getLeases

```
GET /api/Aircraft/getLeases/{id}/{apiToken}
```

Returns lease information when available.

### Response Key

`leases` (array or `null`)

When no lease data exists, `leases` is `null` (not an empty array).

---

## 14. getPictures

```
GET /api/Aircraft/getPictures/{id}/{apiToken}
```

Returns image metadata and URLs for aircraft photos.

### Response Key

`pictures` (array) + `count`

---

## 15. getCompanyrelationships

```
GET /api/Aircraft/getCompanyrelationships/{id}/{apiToken}
```

Returns company relationship rows tied to a specific aircraft: owner, operator, manager, trustee, etc.

### Response Key

`companyrelationships` (array) + `count`

### Key Fields

| Field | Type | Description |
|-------|------|-------------|
| `companyid` | integer | Company ID |
| `name` | string | Company name |
| `relationtype` | string | Relationship type (Owner, Operator, Manager, Trustee, etc.) |
| `relationseqno` | integer | Sequence number for ordering |
| `contactid` | integer | Associated contact ID |
| `ownerpercent` | number | Ownership percentage (for fractional) |
| `fractionexpiresdate` | string | Fractional share expiration |
| `isoperator` | string | `"Y"` or `"N"` -- **string, not boolean** |

### Gotcha: `isoperator` Is a String

```python
# WRONG
if rel["isoperator"]:  # always truthy -- "N" is truthy in Python

# CORRECT
if rel["isoperator"] == "Y":
```

### Difference from `getRelationships`

`getCompanyrelationships` is a **GET** endpoint for a single aircraft by ID. `getRelationships` is a **POST** endpoint for batch queries across multiple aircraft. They return different response structures:

| Endpoint | Method | Response Key | Use Case |
|----------|--------|-------------|----------|
| `getCompanyrelationships` | GET | `companyrelationships` | Single aircraft, flat records |
| `getRelationships` | POST | `relationships` | Batch query, nested company/contact objects |

---

## 16. getFlights (Flight Summary)

```
GET /api/Aircraft/getFlights/{id}/{apiToken}
```

Returns aggregated monthly flight utilization for an aircraft. For per-flight detail records, use `getFlightDataPaged` instead.

### Response Key

`flightsummary`

See [docs/flight-data.md](flight-data.md) for full documentation including the distinction between `getFlights` (summary) and `getFlightDataPaged` (detail).

---

## 17. getRegNumber (Tail Lookup)

```
GET /api/Aircraft/getRegNumber/{reg}/{apiToken}
```

Quick lookup by registration / tail number. This is the **entry point** for the Golden Path workflow.

### Response Key

`aircraftresult` (object)

### Response Structure

Returns a flat object with essential aircraft fields plus inline company relationships:

```json
{
  "responsestatus": "SUCCESS",
  "aircraftresult": {
    "aircraftid": 12345,
    "make": "Gulfstream Aerospace",
    "model": "G550",
    "modelid": 278,
    "sernbr": "5432",
    "regnbr": "N550GD",
    "yearmfr": 2014,
    "yeardlv": 2015,
    "forsale": "N",
    "marketstatus": "",
    "asking": 0,
    "companyrelationships": [
      {
        "companyid": 4425,
        "companyname": "Acme Aviation LLC",
        "companyrelation": "Owner",
        "contactid": 343,
        "contactfirstname": "William",
        "contactlastname": "Butler"
      }
    ]
  }
}
```

### Schema Note

`getRegNumber` uses a **flat schema** with `companyrelation` (not `relationtype`). This differs from `getRelationships` which uses a **nested schema** with `relationtype`. See [docs/response-handling.md](response-handling.md) for the full schema comparison.

---

## 18. getHexNumber (Hex Code Lookup)

```
GET /api/Aircraft/getHexNumber/{hex}/{apiToken}
```

Quick lookup by Mode S / ICAO hex code (e.g., `A12345`).

### Response Key

`aircraft` (object with essential fields)

---

## 19. getAircraftList (Fleet Search)

```
POST /api/Aircraft/getAircraftList/{apiToken}
```

Returns aircraft matching filters: model, lifecycle, for-sale status, geography, etc.

### Request Body (`AcListOptions`)

| Field | Type | Description |
|-------|------|-------------|
| `modlist` | array of int | Model IDs to filter |
| `forsale` | string | `"true"`, `"false"`, or `""` (all) |
| `lifecycle` | string | `InOperation`, `Retired`, `InStorage`, etc. |
| `basecountry` | string | Country filter |
| `basecountrylist` | array | Multiple countries |
| `basestate` | array | US state abbreviations |
| `make` | string | Make filter |
| `makelist` | array | Multiple makes |
| `aclist` | array of int | Specific aircraft IDs |
| `companyid` | integer | Filter by company |
| `actiondate` | string | Changed-since date (MM/DD/YYYY) |
| `enddate` | string | Changed-before date (MM/DD/YYYY) |
| `aircraftchanges` | string | `"true"` for delta mode |
| `sernbr` | string | Serial number filter |
| `regnbr` | string | Registration filter |
| `regnbrlist` | array | Multiple registration numbers |
| `exactMatchReg` | boolean | Exact match on registration |
| `showHistoricalAcRefs` | boolean | Include historical relationships |

### Response Key

`aircraft` (array) + `count`

### Response Fields

Each aircraft object includes: `aircraftid`, `make`, `model`, `modelid`, `icao`, `sernbr`, `regnbr`, `yearmfr`, `yeardlv`, `forsale`, `marketstatus`, `asking`, `pageurl`.

### Gotcha: No Paged Variant

Unlike most list endpoints, `getAircraftList` does **not** have a paged version. Use filters (`modlist`, geographic params, `forsale`) to control result size. For large datasets, use `getBulkAircraftExportPaged` instead.

### Example

```python
body = {
    "modlist": [278],
    "forsale": "true",
    "lifecycle": "InOperation",
    "basecountrylist": ["United States"],
    "aclist": [],
    "airframetype": "None",
    "maketype": "None"
}
resp = session.post(f"{BASE}/api/Aircraft/getAircraftList/{token}", json=body)
aircraft = resp.json().get("aircraft", [])
```

```javascript
const body = {
  modlist: [278],
  forsale: "true",
  lifecycle: "InOperation",
  basecountrylist: ["United States"],
  aclist: [],
  airframetype: "None",
  maketype: "None"
};
const resp = await fetch(`${BASE}/api/Aircraft/getAircraftList/${TOKEN}`, {
  method: "POST",
  headers: { "Content-Type": "application/json", Authorization: `Bearer ${BEARER}` },
  body: JSON.stringify(body)
});
const { aircraft } = await resp.json();
```

---

## 20. getRelationships (Batch)

```
POST /api/Aircraft/getRelationships/{apiToken}
```

Returns relationship records (owner, operator, manager, trustee, etc.) for aircraft matching filter criteria. Used for batch queries across multiple aircraft.

### Request Body

| Field | Type | Description |
|-------|------|-------------|
| `aircraftid` | integer | Single aircraft ID |
| `aclist` | array of int | List of aircraft IDs |
| `modlist` | array of int | Model IDs |
| `actiondate` | string | Changed-since date (MM/DD/YYYY) |
| `showHistoricalAcRefs` | boolean | Include historical relationships |

### Response Key

`relationships` (array) + `count`

### Nested Schema

Each relationship record uses the nested schema with `company: {}` and `contact: {}` sub-objects:

```json
{
  "relationships": [
    {
      "aircraftid": 12345,
      "relationtype": "Owner",
      "company": {
        "companyid": 4425,
        "name": "Acme Aviation LLC",
        "city": "Dallas",
        "state": "Texas",
        "country": "United States"
      },
      "contact": {
        "contactid": 343,
        "firstname": "William",
        "lastname": "Butler",
        "title": "President"
      }
    }
  ]
}
```

### Best Practice

Always include `aclist` with the aircraft IDs you want, even if you also set `aircraftid`:

```python
body = {
    "aircraftid": 12345,
    "aclist": [12345],
    "modlist": [],
    "actiondate": "",
    "showHistoricalAcRefs": False
}
```

---

## 21. getAllAircraftObjects (Bulk Detail)

```
POST /api/Aircraft/getAllAircraftObjects/{apiToken}/{pagesize}/{page}
```

Paged retrieval of full aircraft object records. Requires an aircraft ID list -- sending an empty list returns an error.

### Request Body

| Field | Type | Description |
|-------|------|-------------|
| `aclist` | array of int | **Required** -- aircraft IDs to retrieve |
| `airframetype` | string | Airframe type filter |
| `maketype` | string | Make type filter |
| `sernbr` | string | Serial number filter |
| `regnbr` | string | Registration filter |
| `regnbrlist` | array | Registration number list |
| `modelid` | integer | Model ID filter |
| `make` | string | Make filter |

### Response Key

`allaircraftobjects` (array)

### Error: Missing ID List

```json
{
  "responsestatus": "ERROR: Aircraft ID List cannot be null or empty."
}
```

---

## Common Patterns

### Sub-Record Fan-Out

When you need specific sections for an aircraft, call the individual sub-record endpoints instead of `getAircraft`. This is especially useful when you only need one or two sections:

```python
aircraft_id = 12345

engine_data = session.get(f"{BASE}/api/Aircraft/getEngine/{aircraft_id}/{token}").json()
airframe_data = session.get(f"{BASE}/api/Aircraft/getAirframe/{aircraft_id}/{token}").json()

engines = engine_data.get("engine", {})
airframe = airframe_data.get("airframe", {})

print(f"AFTT: {airframe.get('aftt')} hours")
print(f"Engine program: {engines.get('maintenanceprogram')}")
```

```javascript
const [engineResp, airframeResp] = await Promise.all([
  fetch(`${BASE}/api/Aircraft/getEngine/${aircraftId}/${TOKEN}`),
  fetch(`${BASE}/api/Aircraft/getAirframe/${aircraftId}/${TOKEN}`)
]);

const { engine } = await engineResp.json();
const { airframe } = await airframeResp.json();

console.log(`AFTT: ${airframe?.aftt} hours`);
console.log(`Engine program: ${engine?.maintenanceprogram}`);
```

### Tail-to-Profile (Golden Path)

The most common workflow starts with a tail number and builds a complete profile:

```
1. getRegNumber/{tail}/{apiToken}         → aircraftid, basic info
2. getRelationships/{apiToken}            → owner, operator, manager
   getPictures/{aircraftid}/{apiToken}    → photos (parallel with step 2)
3. getHistoryListPaged/{apiToken}/100/1   → transaction history (lazy)
```

See the [Golden Path](../START_HERE.md) documentation for the full walkthrough.

### Null Array Handling

Several sub-record endpoints return `null` instead of `[]` when no data exists. Always use defensive access:

```python
avionics = resp.get("avionics") or []
leases = resp.get("leases") or []
pictures = resp.get("pictures") or []
```

```javascript
const avionics = data.avionics ?? [];
const leases = data.leases ?? [];
const pictures = data.pictures ?? [];
```

---

## Response Key Quick Reference

| Endpoint | Response Key | Type | Notes |
|----------|-------------|------|-------|
| getAircraft | `aircraft` | Object | Composite with nested sub-records |
| getIdentification | `identification` | Object | |
| getStatus | `status` | Object | |
| getAirframe | `airframe` | Object | `aftt`, `landings`, `timesasofdate` |
| getEngine | `engine` | Object | Contains `engines[]` sub-array |
| getApu | `apu` | Object or null | Check responsestatus for "NO RESULTS FOUND" |
| getAvionics | `avionics` | Array | + `count` |
| getFeatures | `features` | Array | + `count` |
| getAdditionalEquipment | `additionalequipment` | Array | + `count` |
| getInterior | `interior` | Object | |
| getExterior | `exterior` | Object | |
| getMaintenance | `maintenance` | Object | |
| getLeases | `leases` | Array or null | null when no leases |
| getPictures | `pictures` | Array | + `count` |
| getCompanyrelationships | `companyrelationships` | Array | + `count`; `isoperator` is string |
| getFlights | `flightsummary` | Object/Array | See flight-data.md |
| getRegNumber | `aircraftresult` | Object | Flat schema with `companyrelation` |
| getHexNumber | `aircraft` | Object | Essential fields |
| getAircraftList | `aircraft` | Array | No paged variant |
| getRelationships | `relationships` | Array | Nested schema with `relationtype` |
| getAllAircraftObjects | `allaircraftobjects` | Array | Requires aclist |

---
# SOURCE: docs/flight-data.md
---

# JETNET Flight Data Integration

## Endpoints Covered

* `getFlightData` / `getFlightDataPaged` -- granular per-flight records
* `getFlights` (Aircraft Flight Summary) -- aggregated monthly utilization

---

## Two Endpoints, Two Roles

| Endpoint | Role | Data Level |
|----------|------|------------|
| **getFlightData** | Detailed, per-flight operational records | Transactional telemetry |
| **getFlights** | Aggregated monthly utilization statistics | Pre-aggregated cache |

```
getFlightData  → detailed events
        ↓ aggregation
getFlights     → monthly summaries
```

| Question | Correct Endpoint |
|----------|-----------------|
| Where did aircraft fly? | getFlightData |
| How active is aircraft monthly? | getFlights |
| Build utilization trend? | getFlights |
| Detect new travel patterns? | getFlightData |
| Estimate emissions? | getFlightData |

---

## 1. getFlightData (Detail)

### `POST /api/Aircraft/getFlightDataPaged/{apiToken}/{pagesize}/{page}`

Returns granular flight-level records for aircraft matching filters. This is the primary activity dataset and should be treated as the authoritative operational feed.

### Request Body

```json
{
  "aircraftid": 0,
  "airframetype": "None",
  "sernbr": "",
  "regnbr": "",
  "maketype": "None",
  "modelid": 0,
  "make": "",
  "origin": "",
  "destination": "",
  "startdate": "02/19/2026",
  "enddate": "02/20/2026",
  "aclist": [],
  "modlist": [1194],
  "exactMatchReg": true
}
```

### Key Filters

| Field | Behavior |
|-------|----------|
| `startdate / enddate` | **Required** for scalable queries. Use `MM/DD/YYYY` with leading zeros. |
| `modlist` | Most efficient filter (model-based retrieval). Use AMODID values from `references/model-id-table.json`. |
| `aclist` | Target specific aircraft IDs. Empty `[]` = no filter. |
| `origin / destination` | Airport filtering (ICAO codes). |
| `regnbr` | Tail-specific lookup. |
| `exactMatchReg` | Set `true` to prevent fuzzy matching. |

### Response Fields

| Field | Meaning |
|-------|---------|
| `flightid` | Unique flight record ID |
| `flightdate` | Flight occurrence date |
| `origin_time` | Departure timing |
| `flighttime` | Minutes flown |
| `distance` | Flight distance |
| `estfuelburn` | Estimated fuel usage |
| `fuelburnrate` | Consumption rate |
| `estCO2emissions` | Environmental impact metric |
| `callsign` | Operational identifier |
| `origin` / `destination` | Route endpoints (ICAO codes) |

The response key is `flightdata` (array).

### Engineering Notes

- Model filtering (`modlist`) dramatically reduces payload size.
- Date range must be constrained -- large queries without filters may exceed backend limits.
- Response includes aircraft metadata + operational context (no extra joins required).
- Flight data already includes sustainability metrics (fuel burn, CO2) -- no external calculation needed.

---

## 2. getFlights (Monthly Summary)

### `GET /api/Aircraft/getFlights/{aircraftId}/{apiToken}`

Returns aggregated monthly utilization totals for a single aircraft. This is **not** flight-level detail -- it is summarized analytics per month.

### Response Example

```json
{
  "flights": [
    {
      "flightyear": 2025,
      "flightmonth": 2,
      "flights": 103,
      "flighthours": 240
    }
  ]
}
```

### Response Fields

| Field | Meaning |
|-------|---------|
| `flightyear` | Calendar year |
| `flightmonth` | Month (1-12) |
| `flights` | Number of flights in month |
| `flighthours` | Total hours flown in month |

This endpoint functions as a pre-aggregated utilization cache. It avoids needing to compute totals from raw flight records.

---

## 3. Ingestion Strategy

### Recommended Approach

```
FOR each model (modlist)
   FOR each day/week (date window)
      call getFlightDataPaged
```

- Batch by model, not fleet-wide pulls.
- Partition by date window (daily or weekly ingestion).
- Use `getFlights` periodically to snapshot monthly totals without re-processing raw records.

### Data Model

```
Aircraft
 └── AircraftFlight
        ├── flight_id
        ├── date
        ├── origin
        ├── destination
        ├── duration
        ├── distance
        ├── fuel_burn
        └── co2_estimate

AircraftMonthlyUsage (from getFlights)
        ├── year
        ├── month
        ├── flight_count
        └── hours_flown
```

---

## 4. CRM & Analytics Signals

### Derived Signals from Flight Data

| Signal | Derived From |
|--------|-------------|
| Aircraft becoming active | Flight count increase (getFlights trend) |
| Charter behavior | High route diversity (getFlightData origins/destinations) |
| Ownership transition risk | Activity drop (getFlights trend) |
| Sustainability scoring | CO2 + fuel burn (getFlightData estCO2emissions) |
| FBO lead generation | Origin/destination patterns (getFlightData) |
| Utilization benchmarking | Monthly hours vs fleet average (getFlights) |

### Architecture

1. **Discovery Layer** -- Use aircraft endpoints to identify target fleet
2. **Activity Intelligence** -- Pull `getFlightData` in date-windowed batches, store normalized flight records
3. **Utilization Snapshot** -- Periodically call `getFlights`, store as `AircraftMonthlyUsage` for CRM scoring
4. **Derived Signals** -- Compute trends, detect behavioral changes, score leads

---

## 5. Key Takeaways

1. `getFlightData` is the core intelligence endpoint -- detailed, per-flight, includes route + emissions.
2. `getFlights` is an aggregation accelerator -- monthly totals without processing raw records.
3. Always use `modlist` or `aclist` filters. Never pull unfiltered fleet-wide data.
4. Always constrain date ranges. Daily or weekly windows are recommended.
5. These endpoints together enable behavioral aviation analytics: activity scoring, travel pattern detection, sustainability tracking, and CRM automation.

---
# SOURCE: docs/bulk-export.md
---

# JETNET Bulk Export Integration

## Endpoint

`POST /api/Aircraft/getBulkAircraftExportPaged/{apiToken}/{pagesize}/{page}`

The bulk export endpoint is not a simple aircraft query -- it is a **data graph engine**. Each execution builds a relational dataset including aircraft, companies, contacts, phones, events, and flight summaries. Entity counts scale nonlinearly with aircraft count because joins are automatically expanded.

---

## Two Operating Modes

### Snapshot Mode

Omit `aircraftchanges` or leave it blank. Returns a full dataset snapshot matching your filters.

```json
{
  "modlist": [278, 288],
  "maketype": "None",
  "airframetype": "None",
  "forsale": "",
  "actiondate": "",
  "enddate": "",
  "aclist": []
}
```

Use snapshot mode for:
- Initial full data ingestion
- Periodic full refreshes
- One-time exports

### Delta Mode

Set `aircraftchanges` to `true`. Returns aircraft with qualifying changes **since your last API call**. The JETNET backend tracks when you last pulled data and returns only records that changed after that point.

Use `actiondate` / `enddate` as additional date-range filters on the result set, but `aircraftchanges=true` itself means "since last call" -- not "since `actiondate`."

```json
{
  "modlist": [278, 288],
  "maketype": "None",
  "airframetype": "None",
  "forsale": "",
  "actiondate": "02/26/2026 10:00:00",
  "enddate": "02/27/2026 10:00:00",
  "aircraftchanges": true,
  "aclist": []
}
```

Delta mode still returns **full records**, not field-level diffs. When an aircraft qualifies, you get the entire relational graph for that aircraft -- not just the fields that changed.

---

## Graph-Based Change Detection

An aircraft qualifies for inclusion in a delta pull if **any related entity** changes -- not just the aircraft record itself.

Changes that trigger inclusion:

| Entity | Example |
|--------|---------|
| Aircraft record | Tail number change, lifecycle update |
| Ownership | New owner, operator change |
| Company relationships | Company name change, address update |
| Contacts | New chief pilot, contact info update |
| Events | Maintenance event, inspection |
| Flight activity | New flight records |

This is graph-level change detection. A contact phone number change on the owner company will cause the aircraft to appear in the delta, even though nothing about the aircraft itself changed.

---

## actiondate / enddate as Date-Range Filters

When using delta mode, `aircraftchanges=true` determines the change window (since last call). The `actiondate` and `enddate` fields act as **additional date-range filters** on the result set, not as the change cursor itself:

- **`actiondate`** -- lower bound of the date filter window
- **`enddate`** -- upper bound of the date filter window
- **Empty values** -- no date-range restriction (returns all qualifying changes since last call)

The JETNET backend automatically tracks your last call, so you do not need to manage a watermark yourself. Simply call with `aircraftchanges=true` on a regular schedule:

```python
body = {
    "modlist": [278, 288],
    "aircraftchanges": True,
    "actiondate": "",
    "enddate": "",
    "aclist": [],
    "maketype": "None",
    "airframetype": "None",
    "forsale": ""
}

results = get_all_pages(bearer, token, path, body)
```

Use `actiondate` / `enddate` when you need to narrow the date range further (e.g., hourly polling windows with `MM/DD/YYYY HH:MM:SS` format).

---

## Entity Scaling

Each aircraft record expands into related entities. A query returning 100 aircraft does not mean 100 flat records -- it means 100 aircraft plus their full relationship graphs:

```
Aircraft
 ├── Owner company + contacts + phones
 ├── Operator company + contacts + phones
 ├── Chief pilot contact
 ├── Exclusive brokers (up to 2) + contacts
 ├── Additional relationships (up to 3)
 ├── Events
 └── Flight summary
```

A fleet of 100 aircraft could produce thousands of related entity records. Always use `modlist` or `aclist` to bound your scope.

---

## Correct Integration Pattern

### Step 1: Initial Snapshot

Run a full snapshot export to populate your local store.

```python
body = {
    "modlist": TARGET_MODELS,
    "maketype": "None",
    "airframetype": "None",
    "forsale": "",
    "actiondate": "",
    "enddate": "",
    "aclist": []
}
all_aircraft = get_all_pages(bearer, token, bulk_path, body)
upsert_all(all_aircraft)
```

### Step 2: Periodic Delta Pulls

Run delta pulls on a schedule (hourly, daily) using `aircraftchanges=true`. The backend tracks your last call automatically -- you don't need to manage a watermark. Optionally use `actiondate` / `enddate` to narrow the date range.

### Step 3: Upsert Entire Records

Delta mode returns complete records, not patches. Always **upsert the entire aircraft record** rather than trying to diff individual fields:

```python
for aircraft in delta_results:
    db.upsert(
        table="aircraft",
        key={"aircraft_id": aircraft["aircraftid"]},
        data=normalize(aircraft)
    )
```

---

## Common Pitfalls

| Pitfall | Why It Fails | Fix |
|---------|-------------|-----|
| Using bulk export for UI search | Exports are synchronous and built inline -- too slow for live dashboards | Use `getRegNumber` or `getAircraftList` for interactive queries |
| No scope filters | Unbounded `modlist: []` + `aclist: []` creates massive payloads | Always filter by `modlist`, `aclist`, or `maketype` |
| Mixing test/production tokens | Authentication failures with no clear error | Use separate environment variables for each environment |
| Patching individual fields from delta | Delta returns full records, not diffs | Upsert the entire record |
| Expecting field-level change info | Delta tells you *which aircraft changed*, not *what changed* | Compare against your stored copy if you need change details |

---

## Response Format

The bulk export uses a **flat prefixed schema** for relationships. See [Response Handling](response-handling.md) for the full schema comparison.

| Prefix | Role |
|--------|------|
| `owr*` | Owner |
| `opr*` | Operator |
| `chp*` | Chief Pilot |
| `excbrk1*` / `excbrk2*` | Exclusive Brokers |
| `addl1*` / `addl2*` / `addl3*` | Additional relationships |

Other bulk export quirks:
- `forsale` is `"Y"` / `"N"` (not `"true"` / `"false"`)
- `datepurchased` is `YYYYMMDD` format (not `MM/DD/YYYY`)
- `maxpages: 0` means single page -- use `max(maxpages, 1)` in your loop
- `actiondate` accepts `MM/DD/YYYY HH:MM:SS` for hourly polling windows

See [Common Mistakes](common-mistakes.md) and [Pagination](pagination.md) for details on these quirks.

---
# SOURCE: docs/history.md
---

# JETNET Aircraft History Endpoints

## Conceptual Model

History endpoints return **transaction events**, not aircraft state. Each record represents a discrete ownership or leasing event -- a sale, lease, transfer, or relationship change.

```
Aircraft Timeline = Ordered Set of Transactions

2019-03  Full Sale — Company A → Company B
2021-07  Lease — Company B → Company C
2024-01  Full Sale — Company C → Company D
```

This is fundamentally different from other endpoint types:

| Endpoint Type | What It Returns | Use Case |
|---------------|----------------|----------|
| Aircraft / Bulk Export | Current state | "Who owns this now?" |
| Snapshot | State at a historical date | "Who owned this in 2016?" |
| History | Change events over time | "When was this sold? To whom?" |
| Flight Data | Operational activity | "How many hours did it fly?" |

---

## Endpoints

### Aircraft History

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pagesize}/{page}
```

Returns transaction records filtered by aircraft attributes, model, company, and transaction type.

### Company History

```
POST /api/Company/getCompanyHistoryPaged/{apiToken}/{pagesize}/{page}
```

Returns transaction history for a specific company. Use when the question is "What aircraft has this company bought/sold?" rather than "What happened to this aircraft?"

---

## Request Structure

```json
{
  "aircraftid": 0,
  "airframetype": "None",
  "maketype": "None",
  "make": "",
  "modelid": 0,
  "modlist": [1194],
  "aclist": [],
  "companyid": 0,
  "isnewaircraft": "No",
  "isinternaltrans": "No",
  "allrelationships": true,
  "transtype": ["FullSale", "Lease"],
  "startdate": "08/22/2025",
  "enddate": "02/18/2026"
}
```

### Filter Parameters

**Aircraft identification:**

| Field | Purpose |
|-------|---------|
| `aircraftid` | Single aircraft lookup (0 = no filter) |
| `make` | Manufacturer filter (case-insensitive) |
| `modelid` | Single model ID |
| `modlist` | Array of model IDs for multi-model queries |
| `aclist` | Array of aircraft IDs |
| `airframetype` | `"FixedWing"`, `"Rotorcraft"`, `"None"` |
| `maketype` | `"BusinessJet"`, `"Turboprop"`, `"None"` |

**Transaction filters:**

| Field | Purpose | Values |
|-------|---------|--------|
| `transtype` | Transaction categories | `["None"]` (all), `["FullSale"]`, `["Lease"]`, `["InternalSale"]`, `["Management"]`, `["Insurance"]`, `["Repossession"]`, `["Registration"]` |
| `isnewaircraft` | Include factory-new deliveries | `"Yes"`, `"No"`, `"Ignore"` |
| `isinternaltrans` | Include intra-company transfers | `"Yes"`, `"No"`, `"Ignore"` |
| `allrelationships` | Return all parties (Seller, Purchaser, Brokers) | `true` / `false` |

**Company / relationship:**

| Field | Purpose |
|-------|---------|
| `companyid` | History tied to a specific company (0 = no filter) |
| `allrelationships` | Include all ownership/operator relationships |

**Date range:**

| Field | Purpose |
|-------|---------|
| `startdate` | Beginning of history window (`MM/DD/YYYY`) |
| `enddate` | End of history window (`MM/DD/YYYY`) |

Date filtering is critical for performance. Always provide a bounded date range.

---

## Response Structure

Response key: **`history`** (array)

```json
{
  "responseid": "556111434",
  "responsestatus": "SUCCESS: PAGE [ 1 of 428 ]",
  "count": 38,
  "currentpage": 1,
  "maxpages": 428,
  "history": [
    {
      "aircraftid": 246204,
      "transid": 31305852,
      "modelid": 1194,
      "make": "CITATION",
      "model": "CJ3+",
      "sernbr": "525B-0739",
      "regnbr": "F-HVLE",
      "yearmfr": 2024,
      "yeardlv": 2025,
      "maketype": "BusinessJet",
      "weightclass": "Light",
      "categorysize": "Light Jet",
      "transtype": "Full Sale - Retail to Unidentified",
      "transdate": "2025-08-25T00:00:00",
      "actiondate": "2025-09-04T15:09:33",
      "translastactiondate": "2025-09-04T15:09:33",
      "description": "Sold from AMW Aero to Awaiting Documentation",
      "internaltrans": false,
      "newac": "preowned",
      "transretail": true,
      "soldprice": null,
      "askingprice": null,
      "listdate": "2025-04-10T00:00:00",
      "purchasedate": "2025-01-16T00:00:00",
      "usage": "Charter",
      "forsale": true,
      "marketstatus": "For Sale",
      "lifecycle": "InOperation",
      "basecountry": "France",
      "basecontinent": "Europe",
      "estaftt": 76,
      "estcycles": 17,
      "companyrelationships": [...]
    }
  ]
}
```

### Key Response Fields

| Field | Meaning |
|-------|---------|
| `transid` | Unique transaction identifier |
| `transtype` | Descriptive transaction string (not the request category) |
| `transdate` | Actual transaction date (ISO) |
| `actiondate` | When JETNET last updated this record (ISO) |
| `translastactiondate` | Last action timestamp on this transaction |
| `description` | Human-readable transaction summary |
| `soldprice` / `askingprice` | Often `null` -- many deals are confidential |
| `transretail` | `true` = arm's length retail transaction (use for comparable sales) |
| `internaltrans` | `false` = not an intra-company transfer |
| `newac` | `"preowned"` or `"new"` |
| `listdate` | When aircraft was listed for sale |
| `purchasedate` | When it entered current owner's fleet |
| `pageurl` | Deep link to JETNET Evolution web detail page |

**Important:** `transtype` values in the **request** are categories (`"FullSale"`), but values in the **response** are descriptive strings (`"Full Sale - Retail to Retail"`, `"Full Sale - Retail to Leasing Company"`, etc.). See [Enum Reference](enum-reference.md) for known values.

### Company Relationships (Nested Schema)

History uses the **nested relationship schema** -- same as `getRelationships`. Each entry contains `company: {}` and `contact: {}` sub-objects with a `relationtype` field.

```json
{
  "companyid": 422540,
  "name": "AMW Aero",
  "relationtype": "Seller",
  "company": {
    "companyid": 422540,
    "name": "AMW Aero",
    "address1": "11 Route d Archigny",
    "city": "Sainte-Radegonde",
    "country": "France",
    "email": "Sales02@acimetechnology.fr"
  },
  "contact": {
    "contactid": 606048,
    "firstname": "Herve",
    "lastname": "Mouly",
    "title": "Manager",
    "email": "herve@amwaero.com"
  }
}
```

History-specific `relationtype` values: `"Seller"`, `"Purchaser"`, `"Operator"`, `"Seller's Broker"`, `"Purchaser's Broker"`.

See [Response Handling](response-handling.md) for the full nested vs flat schema comparison.

---

## History Records Are Event Pointers

History records include aircraft summary fields (make, model, tail, serial) but they are primarily **transaction records**. For full current aircraft state, enrich with other endpoints:

| Need | Endpoint |
|------|----------|
| Current ownership / operator details | `getRelationships` |
| Full aircraft detail | `getAircraftList` or `getRegNumber` |
| Company detail | `getCompany` |
| Flight activity | `getFlightDataPaged` |

### Enrichment Pattern

```python
history = get_all_pages(bearer, token, history_path, history_body)

for record in sorted(history, key=lambda r: r["transdate"]):
    aircraft_id = record["aircraftid"]
    
    relationships = api_post(
        f"/api/Aircraft/getRelationships/{token}",
        {"aclist": [aircraft_id], "modlist": []}
    )
```

---

## Use Cases

### Ownership Timeline

Query a single aircraft's full transaction history to build a chronological ownership chain:

```json
{
  "aircraftid": 125375,
  "transtype": ["None"],
  "startdate": "01/01/2010",
  "enddate": "02/28/2026",
  "allrelationships": true,
  "isinternaltrans": "Ignore",
  "isnewaircraft": "Ignore"
}
```

Sort results by `transdate ASC` to produce a timeline.

### Comparable Sales Analysis

Find all retail pre-owned sales for a model in a date window:

```json
{
  "modlist": [1194],
  "transtype": ["FullSale"],
  "isnewaircraft": "No",
  "isinternaltrans": "No",
  "allrelationships": true,
  "startdate": "01/01/2025",
  "enddate": "02/28/2026"
}
```

Filter results where `transretail: true` for arm's length transactions.

### Leasing Intelligence

Track lease activity for a model segment:

```json
{
  "modlist": [278, 288, 663],
  "transtype": ["Lease"],
  "startdate": "01/01/2025",
  "enddate": "02/28/2026",
  "allrelationships": true
}
```

### Change Detection Alerts

Poll periodically with a narrow date window to detect new transactions:

```json
{
  "modlist": [278],
  "transtype": ["None"],
  "startdate": "02/27/2026",
  "enddate": "02/28/2026",
  "allrelationships": true
}
```

---

## Performance Notes

- Always provide `startdate` / `enddate` to bound the query
- Use `modelid`, `modlist`, or `companyid` to limit scope
- High-activity models (e.g., King Air, Citation CJ series) produce dense result sets
- `maxpages: 0` / `currentpage: 0` means all results fit in one response -- not an error. See [Pagination](pagination.md) for the `max(maxpages, 1)` pattern.

---

## See Also

- [Response Handling](response-handling.md) -- nested relationship schema details
- [Enum Reference](enum-reference.md) -- `transtype` request categories and response values
- [Pagination](pagination.md) -- paged loop patterns and `maxpages: 0` quirk
- [Snapshots](snapshots.md) -- historical fleet state at a specific date
- [Flight Data](flight-data.md) -- operational activity (complementary to transaction history)
- [Common Mistakes](common-mistakes.md) -- known gotchas

---
# SOURCE: docs/snapshots.md
---

# JETNET Aircraft Snapshot Endpoint

## Conceptual Model

The snapshot endpoint provides a **frozen view of aircraft ownership and operator state at a specific historical date**. Unlike history endpoints (which return transaction events) or live queries (which return current state), snapshots answer:

> "Who owned or operated this aircraft on May 1, 2016?"

Think of it as a database time machine for fleet composition.

```
Aircraft Timeline
------------------------------
2014  Owner A
2016  Owner B
2019  Owner C

Snapshot(2016) → Owner B
History        → [A→B→C transitions]
Current        → Owner C
```

| Endpoint Type | Returns | Analogy |
|---------------|---------|---------|
| Aircraft / Bulk Export | Current state | "NOW" |
| Snapshot | State at a historical date | "THEN" |
| History | Change events over time | "WHAT CHANGED" |
| Flight Data | Operational activity | "WHAT HAPPENED" |

---

## Endpoint

```
POST /api/Aircraft/getCondensedSnapshot/{apiToken}
```

Returns condensed aircraft ownership/operator records as they existed on the requested `snapshotdate`.

**Important:** This endpoint is **non-paged**. It returns the full dataset in a single response, which can be multi-MB for broad queries.

---

## Request Structure

```json
{
  "airframetype": "None",
  "maketype": "None",
  "sernbr": "",
  "regnbr": "",
  "modelid": 0,
  "make": "",
  "lifecycle": "None",
  "basecountry": "Mexico",
  "snapshotdate": "05/01/2016",
  "yearmfr": 0,
  "yeardlv": 0,
  "aclist": [],
  "modlist": [],
  "exactMatchReg": false
}
```

### Parameters

**Temporal control (required):**

| Field | Purpose | Format |
|-------|---------|--------|
| `snapshotdate` | Historical reference date | `MM/DD/YYYY` |

This is the defining parameter. Everything returned reflects the fleet as it existed on this date.

**Aircraft filters:**

| Field | Purpose |
|-------|---------|
| `make` | Manufacturer filter (case-insensitive) |
| `modelid` | Single model ID (0 = no filter) |
| `modlist` | Array of model IDs |
| `aclist` | Array of aircraft IDs |
| `sernbr` | Serial number filter |
| `regnbr` | Registration / tail number filter |
| `exactMatchReg` | `true` for exact match, `false` for partial |
| `airframetype` | `"FixedWing"`, `"Rotorcraft"`, `"None"` |
| `maketype` | `"BusinessJet"`, `"Turboprop"`, `"Piston"`, `"None"` |

**Operational filters:**

| Field | Purpose |
|-------|---------|
| `lifecycle` | Aircraft operational state (`"InOperation"`, `"None"`) |
| `basecountry` | Country where aircraft was based |
| `basestate` | State/region filter (array) |
| `yearmfr` | Manufacturing year (0 = no filter) |
| `yeardlv` | Delivery year (0 = no filter) |

---

## Response Structure

Response key: **`snapshotowneroperators`** (array)

```json
{
  "responseid": "...",
  "responsestatus": "SUCCESS",
  "count": 2651,
  "snapshotowneroperators": [
    {
      "snapshotdate": "5/2016",
      "acid": 610,
      "airframetype": "FixedWing",
      "maketype": "Piston",
      "make": "BARON",
      "model": "58"
    }
  ]
}
```

Each record represents an aircraft + ownership/operator relationship as it existed at the snapshot date.

---

## Performance and Payload Size

Snapshot responses can be large:
- A country-level query (e.g., all aircraft based in Mexico) can return thousands of records and multi-MB payloads
- There is **no pagination** -- the full dataset comes in one response

**Always filter** to keep payloads manageable:

| Filter | Effect |
|--------|--------|
| `modlist` | Scope to specific models -- most effective |
| `basecountry` | Limit to a single country |
| `maketype` | Limit to a category (BusinessJet, Turboprop) |
| `lifecycle` | Exclude scrapped/stored aircraft |
| `aclist` | Query specific aircraft only |

Avoid unrestricted global snapshot pulls. A query with no filters against a broad `snapshotdate` produces very large payloads.

---

## Use Cases

### Historical Fleet Composition

"How many G550s were based in the US in 2018?"

```json
{
  "modlist": [278],
  "basecountry": "United States",
  "snapshotdate": "12/31/2018",
  "lifecycle": "InOperation"
}
```

Count the results to get fleet size at that date.

### "Who Owned This in Year X?"

```json
{
  "aclist": [125375],
  "snapshotdate": "06/15/2020"
}
```

### Market Comparison Across Years

Run the same filtered query with different `snapshotdate` values to compare fleet composition over time:

```python
years = ["12/31/2018", "12/31/2020", "12/31/2022", "12/31/2024"]
fleet_sizes = {}

for date in years:
    body = {
        "modlist": [278],
        "basecountry": "United States",
        "snapshotdate": date,
        "lifecycle": "InOperation",
        "airframetype": "None",
        "maketype": "None",
        "make": "",
        "modelid": 0,
        "sernbr": "",
        "regnbr": "",
        "yearmfr": 0,
        "yeardlv": 0,
        "aclist": [],
        "exactMatchReg": False
    }
    result = api_post(f"/api/Aircraft/getCondensedSnapshot/{token}", body)
    fleet_sizes[date] = result["count"]
```

### Country Fleet Growth Analysis

Compare aircraft counts by country across snapshot dates to identify growing or shrinking markets.

---

## Engineering Recommendations

**Caching:** Snapshot data is historical and immutable -- cache aggressively. A snapshot for `05/01/2016` will always return the same data.

**Pre-aggregation:** For dashboards or recurring analytics, pre-aggregate common snapshot dates into summary tables rather than calling the API repeatedly.

**Backend summarization:** Avoid feeding raw multi-MB snapshot payloads directly into conversational AI or LLM prompts. Summarize or aggregate on your backend first.

```
Application
  ↓
Backend Service
  ↓
JETNET Snapshot API
  ↓
Normalize → Cache → Summarize
  ↓
Dashboard / LLM Response
```

---

## See Also

- [History](history.md) -- transaction change events (complementary to snapshots)
- [Flight Data](flight-data.md) -- operational activity
- [Bulk Export](bulk-export.md) -- current state with full relationship graphs
- [Enum Reference](enum-reference.md) -- valid values for `airframetype`, `maketype`, `lifecycle`
- [Response Handling](response-handling.md) -- schema differences across endpoints

---
# SOURCE: docs/trends.md
---

# Market Trends & Time-Series Analytics

The JETNET API exposes multiple endpoints that, when combined, form a complete longitudinal dataset for aviation market intelligence. This guide explains how to layer them into time-series analytics.

---

## Data Layers

| Layer | Endpoint | What It Provides |
|-------|----------|-----------------|
| **Market** | `getModelMarketTrends` | Monthly pricing, inventory, days-on-market per model |
| **State** | `getCondensedSnapshot` | Fleet ownership/operator state at a historical date |
| **Causal** | `getEventListPaged` | Discrete lifecycle changes explaining why state changed |
| **Activity** | `getFlightData` / `getFlights` | Flight hours, routes, utilization |
| **Transaction** | `getHistoryListPaged` | Sales, leases, ownership transfers |
| **Current** | `getCondensedOwnerOperators` | Current ownership/operator relationships |

Unified by: **model ID**, **aircraft ID**, and **date**.

---

## 1. Model Market Trends (Core Time Series)

`POST /api/Model/getModelMarketTrends/{apiToken}`

The strongest native time-series endpoint. Returns monthly snapshots at model-level granularity with historical depth spanning multiple years.

### Request

```json
{
  "modlist": [278, 288, 663],
  "displayRange": 12,
  "startdate": "01/01/2024",
  "airframetype": "None",
  "maketype": "None",
  "productcode": ["None"],
  "modelid": 0,
  "make": ""
}
```

- `modlist` -- array of model IDs to track
- `displayRange` -- number of months of data to return
- `startdate` -- beginning of the trend window (`MM/DD/YYYY`)

### Response Key: `modelMarketTrends`

One record per model per month:

```json
{
  "modelid": 278,
  "make": "GULFSTREAM",
  "model": "G550",
  "trend_year": 2024,
  "trend_month": 6,
  "trend_snapshot_date": "2024-06-30T00:00:00",
  "aircraft_for_sale_count": 28,
  "in_operation_count": 553,
  "end_user_count": 15,
  "dealer_owned_count": 5,
  "domestic_count": 18,
  "international_count": 10,
  "avg_asking_price": 18500000,
  "high_asking_price": 24900000,
  "low_asking_price": 12500000,
  "make_offer_count": 8,
  "avg_daysonmarket": 185,
  "avg_year": 2012,
  "avg_airframe_time": 6200,
  "avg_engine_time": 5800,
  "avail_new_onmarket_count": 0
}
```

### Derived Metrics

| Metric | Formula |
|--------|---------|
| **Supply Pressure** | `aircraft_for_sale_count / in_operation_count` |
| **Liquidity Score** | Inverse of `avg_daysonmarket` trend slope |
| **Price Trend Index** | MoM change in `avg_asking_price` |
| **Market Heat** | Supply Pressure inverted -- low supply + high utilization = hot market |
| **Inventory Velocity** | Rate of change in `aircraft_for_sale_count` |

---

## 2. Fleet Snapshot Trends (Historical State)

`POST /api/Aircraft/getCondensedSnapshot/{apiToken}`

Query the same filters across multiple `snapshotdate` values to build fleet composition curves over time. See [Snapshots](snapshots.md) for full endpoint documentation.

### Time-Series Construction

```python
dates = ["12/31/2018", "12/31/2019", "12/31/2020", "12/31/2021",
         "12/31/2022", "12/31/2023", "12/31/2024"]

for date in dates:
    body["snapshotdate"] = date
    result = api_post(f"/api/Aircraft/getCondensedSnapshot/{token}", body)
    store_snapshot(date, result["count"], result["snapshotowneroperators"])
```

### Derived Metrics

| Metric | What It Shows |
|--------|--------------|
| Net fleet change by region | Geographic migration trends |
| Ownership turnover rate | Market liquidity signal |
| Manufacturer market penetration | Competitive landscape |
| Active vs inactive fleet ratio | Lifecycle health |

Snapshots are the **baseline state layer** that contextualizes market trend movements.

---

## 3. Flight Activity Trends

`POST /api/Aircraft/getFlightDataPaged/{apiToken}/{pagesize}/{page}` (per-flight)
`GET /api/Aircraft/getFlights/{aircraftId}/{apiToken}` (monthly summary)

See [Flight Data](flight-data.md) for full endpoint documentation.

### Trend Metrics

| Metric | Source |
|--------|--------|
| Flight hours trend | Monthly `flighthours` from `getFlights` |
| Utilization per model | Aggregate `flighthours / fleet_count` |
| Route patterns | Origin/destination from `getFlightData` |
| Fuel/emissions trends | `estfuelburn` / `estCO2emissions` from `getFlightData` |

### Correlation Signals

| Pattern | Signal |
|---------|--------|
| Rising utilization + declining inventory | Tightening market |
| Falling utilization + growing inventory | Market softening |
| Stable utilization + rising prices | Demand-driven pricing |

---

## 4. Transaction Trends

`POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pagesize}/{page}`

See [History](history.md) for full endpoint documentation.

### Trend Metrics

| Metric | How To Compute |
|--------|---------------|
| Transaction volume | Count of history records per month |
| Buyer vs seller cycles | Ratio of `FullSale` vs `Lease` transactions over time |
| Turnover velocity | Time between `purchasedate` and next `transdate` for same aircraft |
| Regional acquisition waves | Group by `basecountry` / `basecontinent` over time |

Filter with `transretail: true` for arm's length transactions when building comparable sales trends.

---

## 5. Owner/Operator Movement Trends

`POST /api/Aircraft/getCondensedOwnerOperators/{apiToken}`

Returns current ownership/operator relationships. When captured periodically, enables:

| Metric | What It Shows |
|--------|--------------|
| Operator fleet expansion/contraction | Growth signals |
| Corporate fleet migration | Market movement |
| Charter vs private ownership shifts | Segment trends |
| New entrant detection | Companies appearing for the first time |

Response key: `aircraftowneroperators`

---

## Composite Indicators

By combining data across layers, build higher-value analytics:

### Market Momentum Index

```
(Monthly Transaction Volume + Flight Utilization Change) / Inventory Growth
```

High momentum = active, tightening market. Low or negative = cooling.

### Supply Pressure Index

```
Aircraft For Sale / In Operation Fleet
```

From `getModelMarketTrends`. Track monthly for supply curve direction.

### Utilization vs Pricing Correlation

Plot `avg_airframe_time` trends against `avg_asking_price` from market trends. Divergence signals mispricing.

---

## Architecture

```
┌─────────────────────────────────────────┐
│            Unified Trend Store          │
│  (Model ID + Aircraft ID + Date)        │
├──────────┬──────────┬──────────┬────────┤
│  Market  │  State   │ Activity │ Deals  │
│  Trends  │ Snapshot │  Flight  │ History│
├──────────┼──────────┼──────────┼────────┤
│ Monthly  │ Point-in │  Daily / │ Event  │
│ pricing  │ time     │  Monthly │ based  │
│ & supply │ fleet    │  hours   │ sales  │
└──────┬───┴────┬─────┴────┬─────┴───┬────┘
       │        │          │         │
   getModel  getCond   getFlight  getHistory
   Market    ensed     Data/      ListPaged
   Trends    Snapshot  Flights
```

### Data Collection Schedule

| Layer | Endpoint | Frequency |
|-------|----------|-----------|
| Market | `getModelMarketTrends` | Monthly (data updates monthly) |
| State | `getCondensedSnapshot` | Quarterly or on-demand |
| Causal | `getEventListPaged` | Daily or hourly for alerts |
| Activity | `getFlights` | Monthly per aircraft |
| Transactions | `getHistoryListPaged` | Weekly or daily for alerts |
| Current | `getCondensedOwnerOperators` | Daily or weekly for CRM sync |

---

## See Also

- [Events](events.md) -- discrete lifecycle changes (the causal layer)
- [Snapshots](snapshots.md) -- historical fleet state endpoint details
- [History](history.md) -- transaction history endpoint details
- [Flight Data](flight-data.md) -- flight activity endpoint details
- [Bulk Export](bulk-export.md) -- full aircraft data replication
- [Response Handling](response-handling.md) -- schema differences across endpoints

---
# SOURCE: docs/events.md
---

# JETNET Aircraft Events

## Conceptual Model

Events are **discrete, timestamped records of real-world changes** to aircraft -- ownership transfers, for-sale listings, accidents, maintenance milestones, and lifecycle transitions. They represent the **atomic causal layer** of the JETNET dataset.

Where other endpoints describe *what* the market looks like (snapshots), *how* it's trending (market trends), or *what activity occurred* (flights), events explain **why things changed**.

```
EVENTS  →  SNAPSHOTS  →  TRENDS
(raw)      (state)       (analytics)
```

| Layer | Endpoint | Time Meaning |
|-------|----------|-------------|
| Atomic Events | `getEventListPaged` | Individual real-world changes |
| Snapshot | `getCondensedSnapshot` | Market state at a point in time |
| Aggregated Trends | `getModelMarketTrends` | Derived market metrics over time |
| Transaction History | `getHistoryListPaged` | Ownership/leasing transactions |
| Flight Activity | `getFlightDataPaged` | Operational movements |

Events are the **ground truth** that snapshots and trends are built from.

---

## Endpoint

```
POST /api/Aircraft/getEventListPaged/{apiToken}/{pagesize}/{page}
```

Returns aircraft event records filtered by event category, event type, date range, model, and aircraft list.

---

## Request Structure

```json
{
  "evcategory": ["transaction"],
  "evtype": ["Off Market Due To Sale"],
  "startdate": "01/25/2026",
  "enddate": "02/02/2026",
  "aclist": [],
  "modlist": [],
  "aircraftid": 0,
  "modelid": 0,
  "make": ""
}
```

### Parameters

| Field | Purpose | Notes |
|-------|---------|-------|
| `evcategory` | Event category filter | Array of strings. Use `[]` for all categories. |
| `evtype` | Event type filter | Array of strings. Use `[]` for all types. |
| `startdate` | Start of event window | `MM/DD/YYYY` with leading zeros |
| `enddate` | End of event window | `MM/DD/YYYY` with leading zeros |
| `aclist` | Aircraft ID filter | Array of aircraft IDs. `[]` = no filter. |
| `modlist` | Model ID filter | Array of model IDs. `[]` = no filter. |
| `aircraftid` | Single aircraft lookup | `0` = no filter |
| `modelid` | Single model filter | `0` = no filter |
| `make` | Manufacturer filter | Case-insensitive. `""` = no filter. |

### Event Categories and Event Types

Events are classified into **categories** (domain groupings) and **types** (specific change signals). These turn events from a raw stream into typed, actionable intelligence.

**Known event categories:**

| Category | Covers |
|----------|--------|
| Aircraft Information | Base changes, airframe hours, registration, specs |
| Company / Contact | Ownership, operator, contact updates |
| Financial Documents | Financial record changes |
| Market Status | For-sale listings, off-market, status transitions |
| Transaction | Sales, leases, ownership transfers |

**Example event types** (within categories):

- Change in Aircraft Base
- Change in Airframe Total Time
- Ownership Transfer
- For Sale / Off Market
- Operator Change
- Registration Change

To discover all valid values, call the utility endpoints:

```
GET  /api/Utility/getEventCategories/{apiToken}
POST /api/Utility/getEventTypes/{apiToken}  body: { "eventcategory": "Transaction" }
```

`getEventTypes` accepts a single `eventcategory` string and returns the valid types within that category.

### Enum Values Are Strict

`evcategory` and `evtype` values must match exactly. Sending unrecognized values returns an error inside `responsestatus` even when HTTP status is 200.

**Safe default:** Use `[]` for both `evcategory` and `evtype` to return all event types without guessing enum strings. Always call the utility endpoints above to discover valid values before filtering.

---

## Response Structure

Response key: **`events`** (array)

```json
{
  "responseid": "340652808",
  "responsestatus": "SUCCESS",
  "count": 961,
  "currentpage": 0,
  "maxpages": 0,
  "events": [
    {
      "aircraftid": 232064,
      "make": "ROBINSON",
      "model": "R44 RAVEN II",
      "sernbr": "14343",
      "regnbr": "VH-NSX",
      "yearmfr": 2019,
      "yeardlv": 2019,
      "date": "2025-04-14T05:48:33",
      "subject": "New Owner",
      "description": "AirX, Inc."
    }
  ]
}
```

### Response Fields

| Field | Meaning |
|-------|---------|
| `aircraftid` | Aircraft reference ID |
| `make` / `model` | Manufacturer and model |
| `sernbr` | Serial number |
| `regnbr` | Registration / tail number |
| `yearmfr` / `yeardlv` | Year manufactured / delivered |
| `date` | Event timestamp (ISO format) |
| `subject` | Event subject / headline |
| `description` | Event detail |

---

## Events as the Causal Layer

Events explain the **why** behind changes visible in other datasets:

| Observation in Trends/Snapshots | Events Explanation |
|---------------------------------|-------------------|
| Inventory spike for a model | Cluster of for-sale listing events |
| Price drop in market trends | Dealer acquisition events increasing supply |
| Operator count change in snapshots | Ownership transfer events |
| Fleet size decline | Retirement or export events |

---

## Use Cases

### Lifecycle Timeline per Aircraft

Query all events for a single aircraft to reconstruct its full lifecycle:

```json
{
  "aircraftid": 232064,
  "evcategory": [],
  "evtype": [],
  "startdate": "01/01/2010",
  "enddate": "02/28/2026"
}
```

Sort by `date ASC` to produce a timeline:

```
Delivery → Operator Change → Lease → For Sale → Sale → New Owner → Export
```

### Market Velocity Measurement

Count events per model per month to measure transaction frequency:

```json
{
  "modlist": [278, 288, 663],
  "evcategory": ["transaction"],
  "evtype": [],
  "startdate": "01/01/2025",
  "enddate": "02/28/2026"
}
```

High event density = active trading. Low density = sticky ownership.

### Pre-Listing Detection

Look for patterns that predict aircraft entering the market:

```
Operator change → Maintenance event → For-sale listing
```

Query broad event categories and filter for sequences that precede listings.

### Ownership Churn Index

```
Owner change events per model / in-operation fleet count = churn rate
```

Combine with `getModelMarketTrends` (for fleet count) to compute. High churn indicates an unstable or liquidating market segment.

### Event-Driven Alerts

Poll events on a schedule (hourly or daily) with a narrow date window to detect new activity:

```json
{
  "modlist": [278],
  "evcategory": [],
  "evtype": [],
  "startdate": "02/27/2026",
  "enddate": "02/28/2026"
}
```

---

## Event Importance and Signal Priority

Not all events carry equal weight. Classify events by category to drive notifications, dashboards, and scoring:

| Priority | Categories | Signal Value |
|----------|-----------|--------------|
| **High** | Transaction, Market Status | Ownership transfers, for-sale/off-market transitions -- immediate market intelligence |
| **Medium** | Aircraft Information | Base changes, hours updates, registration changes -- operational context |
| **Low** | Financial Documents, Company / Contact | Record-keeping updates -- background enrichment |

Use this classification to:
- Filter alert subscriptions (only notify on high-priority events)
- Build "What Changed Today" dashboards sorted by importance
- Drive scoring models (high-priority events weighted more heavily)
- Generate automated market intelligence summaries

### Events as a Signal Engine

Events are most valuable when treated as **actionable signals**, not a historical log:

```
CJ3+ changed base to KTEB    → notify regional broker
G550 listed for sale          → trigger opportunity alert
Ownership transfer on G200    → update company intelligence
Airframe hours milestone      → flag upcoming maintenance
```

---

## Derived Metrics

| Metric | How To Compute |
|--------|---------------|
| **Events per Aircraft (90-day rolling)** | Count events per `aircraftid` in trailing 90-day window |
| **Transfer-to-Listing Conversion Rate** | Ownership transfer events followed by for-sale listing / total transfers |
| **Operator Change Frequency** | Operator change events per model per year |
| **Average Time Between Events** | Mean gap between consecutive events per aircraft |
| **Regional Movement Index** | Registration change events grouped by country |

---

## Events in the Analytics Stack

Events complete the four-layer analytics architecture:

```
┌──────────────────────────────────────┐
│          Analytics Output            │
│  Dashboards, Alerts, Predictions     │
├──────────┬──────────┬───────┬────────┤
│  Market  │  State   │ Causal│Activity│
│  Trends  │ Snapshot │ Events│ Flight │
├──────────┼──────────┼───────┼────────┤
│ Monthly  │ Point-in │Atomic │ Daily/ │
│ pricing  │ time     │changes│ Monthly│
│ & supply │ fleet    │       │ hours  │
└──────┬───┴────┬─────┴───┬───┴───┬────┘
       │        │         │       │
   getModel  getCond   getEvent getFlight
   Market    ensed     ListPaged Data/
   Trends    Snapshot           Flights
```

---

## Performance Notes

- Always provide `startdate` / `enddate` to bound the query
- Use `modlist` or `aclist` to limit scope -- broad event queries can return thousands of records
- Use `[]` for `evcategory` and `evtype` when unsure of valid enum values
- `maxpages: 0` / `currentpage: 0` means results fit in one response -- same quirk as other paged endpoints

---

## See Also

- [Trends](trends.md) -- market analytics that events help explain
- [Snapshots](snapshots.md) -- fleet state that events help contextualize
- [History](history.md) -- transaction records (complementary to events)
- [Flight Data](flight-data.md) -- operational activity
- [Pagination](pagination.md) -- paged loop patterns
- [Common Mistakes](common-mistakes.md) -- known gotchas including enum strictness

---
# SOURCE: docs/contacts.md
---

# Contacts

Contacts represent **people** in the JETNET ecosystem — chief pilots, directors of aviation, CEOs, dispatchers, and other decision-makers tied to aircraft and companies. A contact is a **relationship hub** connecting companies, aircraft, and listings, not just a person record.

## Endpoints

| Endpoint | Method | URL Pattern | Purpose |
|----------|--------|-------------|---------|
| getContact | GET | `/api/Contact/getContact/{id}/{apiToken}` | Full contact record |
| getContactList | POST | `/api/Contact/getContactList/{apiToken}` | Search contacts |
| getContactListPaged | POST | `/api/Contact/getContactListPaged/{apiToken}/{pagesize}/{page}` | Paginated contact search |
| getIdentification | GET | `/api/Contact/getIdentification/{id}/{apiToken}` | Identification-only record |
| getPhonenumbers | GET | `/api/Contact/getPhonenumbers/{id}/{apiToken}` | Phone numbers for a contact |
| getOtherlistings | GET | `/api/Contact/getOtherlistings/{id}/{apiToken}` | Alternate company/contact associations |
| getContAircraftRelationships | GET | `/api/Contact/getContAircraftRelationships/{id}/{apiToken}` | Aircraft relationships for a contact |

## Recommended Workflow

```
1. getContactList / getContactListPaged  →  search by name, company, aircraft
2. getIdentification                     →  lightweight verify before hydrating
3. getContact                            →  full profile (includes nested sub-records)
4. getContAircraftRelationships          →  aircraft linkage
5. getPhonenumbers                       →  communication data
6. getOtherlistings                      →  extended cross-company relationships
```

## Endpoint Details

### getContact

Returns a complete contact object including identification, phone numbers, and aircraft relationships when available.

```
GET /api/Contact/getContact/{contactId}/{apiToken}
```

**Response:**

```json
{
  "responsestatus": "SUCCESS",
  "contact": {
    "identification": {
      "contactid": 343,
      "companyid": 215,
      "firstname": "William",
      "lastname": "Butler",
      "title": "President",
      "email": null
    },
    "phonenumbers": null,
    "aircraftrelationships": []
  }
}
```

**Response key:** `contact` (object with nested `identification`, `phonenumbers`, `aircraftrelationships`)

### getContactList

Search contacts by name, company, aircraft, or other criteria. Returns a non-paginated result set.

```
POST /api/Contact/getContactList/{apiToken}
```

**Request body** (`ContListOptions`):

| Field | Type | Description |
|-------|------|-------------|
| `aircraftid` | array | Filter by aircraft IDs |
| `companyid` | integer | Filter by company ID |
| `companyname` | string | Filter by company name |
| `firstname` | string | Filter by first name |
| `lastname` | string | Filter by last name |
| `title` | string | Filter by title |
| `email` | string | Filter by email |
| `actiondate` | string | Changed-since date (MM/DD/YYYY) |
| `enddate` | string | Changed-before date (MM/DD/YYYY) |
| `phonenumber` | string | Filter by phone number |
| `contactchanges` | string | Filter by change type |
| `contlist` | array | Specific contact IDs |
| `complist` | array | Specific company IDs |

**Example request:**

```json
{
  "aircraftid": [23453, 241265, 2521],
  "companyname": "",
  "firstname": "",
  "lastname": ""
}
```

**Response key:** `contacts` (array)

### getContactListPaged

Same search logic as `getContactList` but with pagination for large result sets.

```
POST /api/Contact/getContactListPaged/{apiToken}/{pagesize}/{page}
```

**Path params:** `pagesize` (integer), `page` (integer, 1-based)

**Request body:** Same `ContListOptions` as `getContactList`.

**Response key:** `contactlist` (array) — note this differs from the non-paged variant which uses `contacts`.

**Response includes:** `currentpage`, `maxpages`, `count`, `contactlist[]`

Use this endpoint for data warehouse ingestion, CRM synchronization, and batch exports. See [pagination](pagination.md) for the standard paging pattern.

### getIdentification

Lightweight endpoint returning only identification metadata — useful when you need to verify a contact without pulling the full record.

```
GET /api/Contact/getIdentification/{contactId}/{apiToken}
```

**Response key:** `contactIdentification` (object)

```json
{
  "responsestatus": "SUCCESS",
  "contactIdentification": {
    "contactid": 343,
    "companyid": 215,
    "actiondate": "2011-01-05T16:08:20",
    "sirname": "Mr.",
    "firstname": "William",
    "middleinitial": "P",
    "lastname": "Butler",
    "suffix": null,
    "title": "President",
    "email": null
  }
}
```

**Key fields:** contactid, companyid, firstname, lastname, title, email, actiondate.

### getPhonenumbers

Retrieves phone numbers associated with a contact.

```
GET /api/Contact/getPhonenumbers/{contactId}/{apiToken}
```

**Response:**

```json
{
  "responsestatus": "SUCCESS: NO RESULTS FOUND [PHONE NUMBERS]",
  "count": 0,
  "phonenumbers": null
}
```

**Response key:** `phonenumbers` (array or `null`)

> `"SUCCESS: NO RESULTS FOUND"` is **not an error** — it means the contact has no phone numbers on file. The `phonenumbers` field will be `null`, not `[]`. Always guard before iterating. See [Key Behaviors](#key-behaviors) below.

### getOtherlistings

Returns alternate company/contact associations — discover cross-company affiliations for a contact.

```
GET /api/Contact/getOtherlistings/{contactId}/{apiToken}
```

**Response:**

```json
{
  "responsestatus": "SUCCESS",
  "count": 2,
  "otherlistings": [
    { "companyid": 214, "contactid": 342 }
  ]
}
```

**Response key:** `otherlistings` (array or `null`)

Use this to build relationship expansion graphs and discover contacts that span multiple organizations.

### getContAircraftRelationships

Returns aircraft relationships tied to a contact — which aircraft they are associated with and in what role.

```
GET /api/Contact/getContAircraftRelationships/{contactId}/{apiToken}
```

**Response:**

```json
{
  "responsestatus": "SUCCESS",
  "aircraftrelationships": [
    {
      "aircraftid": 197551,
      "relationtype": "Additional Company/Contact",
      "isoperator": "N",
      "businesstype": "End User"
    }
  ]
}
```

**Response key:** `aircraftrelationships` (array or `null`)

Use `aircraftid` from these results to call aircraft sub-record endpoints (`getAircraft`, `getRelationships`, etc.).

## Key Behaviors

### "SUCCESS: NO RESULTS FOUND" Is Normal

Many contact sub-endpoints return `"SUCCESS: NO RESULTS FOUND [PHONE NUMBERS]"` or similar when the contact exists but has no data for that sub-record. This is **not an error**. Use a prefix/startsWith check:

```python
status = data.get("responsestatus", "")
if status.upper().startswith("SUCCESS"):
    pass  # OK, even if "NO RESULTS FOUND"
elif "ERROR" in status.upper():
    raise ValueError(f"JETNET error: {status}")
```

```javascript
const status = data.responsestatus || "";
if (status.toUpperCase().startsWith("SUCCESS")) {
  // OK, even if "NO RESULTS FOUND"
} else if (status.toUpperCase().includes("ERROR")) {
  throw new Error(`JETNET error: ${status}`);
}
```

### Null Arrays, Not Empty Arrays

Fields like `phonenumbers`, `aircraftrelationships`, and `otherlistings` return `null` when there are no results — **not** an empty array `[]`. Always guard before calling `.map()`, `.forEach()`, or iterating:

```python
phones = data.get("phonenumbers") or []
for phone in phones:
    print(phone)
```

```javascript
const phones = data.phonenumbers ?? [];
phones.forEach((p) => console.log(p));
```

### contactid Is the Join Key

`contactid` is the primary key for all contact sub-record endpoints and the field you use to de-duplicate contacts across multiple aircraft or company records. Store `contactid` (not names) as your foreign key. See [ID System](id-system.md).

## Contact as a Relationship Hub

Contacts connect outward to three entity types:

```
                    ┌─────────────┐
                    │  Companies  │
                    │ (companyid) │
                    └──────▲──────┘
                           │
              ┌────────────┼────────────┐
              │         Contact         │
              │       (contactid)       │
              └────────────┼────────────┘
              │                         │
       ┌──────▼──────┐          ┌───────▼───────┐
       │   Aircraft   │          │   Listings    │
       │ (aircraftid) │          │ (otherlistings│
       └──────────────┘          └───────────────┘
```

- **Companies:** Every contact belongs to a company via `companyid`. Use `getIdentification` to see the primary company, or `getOtherlistings` to find additional affiliations.
- **Aircraft:** Use `getContAircraftRelationships` to find all aircraft linked to a contact. Each relationship includes `relationtype`, `isoperator`, and `businesstype`.
- **Listings:** `getOtherlistings` reveals alternate company/contact associations — the same person may appear under different companies with different `contactid` values.

## Common Use Cases

### CRM Enrichment

```
getContactListPaged (lastname="Smith", title="Chief Pilot")
  → for each contact:
      getContact/{contactid}        → full profile
      getPhonenumbers/{contactid}   → phone data
      getContAircraftRelationships/{contactid} → linked aircraft
```

### Ownership Intelligence

Starting from an aircraft, find decision-makers:

```
getRegNumber/{tailNumber}
  → extract contactid from companyrelationships
  → getContact/{contactid}         → full contact record
  → getOtherlistings/{contactid}   → cross-company links
```

### Incremental Sync

Use `actiondate` in `getContactListPaged` to pull only contacts that changed since your last sync:

```json
{
  "actiondate": "01/15/2025",
  "enddate": ""
}
```

## See Also

- [ID System](id-system.md) — `contactid`, `companyid`, and `aircraftid` explained
- [Response Handling](response-handling.md) — `responsestatus` patterns and schema differences
- [Common Mistakes](common-mistakes.md) — null arrays, "SUCCESS: NO RESULTS FOUND", and other gotchas
- [Pagination](pagination.md) — standard paging pattern for `getContactListPaged`
- [Companies](companies.md) — company endpoints that connect to contacts via `companyid`

---
# SOURCE: docs/companies.md
---

# JETNET Company Endpoints

## Conceptual Model

Company endpoints let you search, retrieve, and expand company profiles. A "company" in JETNET is any legal entity with a relationship to aircraft: owners, operators, manufacturers, lessors, brokers, FBOs, and fractional providers all share the same `companyid` namespace.

Companies sit at the center of a relationship graph:

```
                    ┌─────────────┐
                    │  Contacts   │
                    │ (contactid) │
                    └──────┬──────┘
                           │
┌──────────────┐    ┌──────┴──────┐    ┌──────────────┐
│   Aircraft   │────│   Company   │────│   Related    │
│ (aircraftid) │    │ (companyid) │    │  Companies   │
└──────────────┘    └──────┬──────┘    └──────────────┘
                           │
                    ┌──────┴──────┐
                    │   History   │
                    │  (transid)  │
                    └─────────────┘
```

---

## Endpoints

| # | Endpoint | Method | Path | Returns |
|---|----------|--------|------|---------|
| 1 | getCompany | GET | `/api/Company/getCompany/{id}/{apiToken}` | Full company record (nested objects) |
| 2 | getIdentification | GET | `/api/Company/getIdentification/{id}/{apiToken}` | Lightweight identification record |
| 3 | getContacts | GET | `/api/Company/getContacts/{id}/{apiToken}` | Contact ID array (not full objects) |
| 4 | getPhonenumbers | GET | `/api/Company/getPhonenumbers/{id}/{apiToken}` | Phone number list |
| 5 | getRelatedcompanies | GET | `/api/Company/getRelatedcompanies/{id}/{apiToken}` | Affiliated / parent / child companies |
| 6 | getAircraftrelationships | GET | `/api/Company/getAircraftrelationships/{id}/{apiToken}` | Aircraft tied to this company |
| 7 | getCompanyCertifications | GET | `/api/Company/getCompanyCertifications/{id}/{apiToken}` | Regulatory certifications |
| 8 | getCompanyHistory | POST | `/api/Company/getCompanyHistory/{apiToken}` | Transaction history (bulk) |
| 9 | getCompanyList / Paged | POST | `/api/Company/getCompanyListPaged/{apiToken}/{pagesize}/{page}` | Company search with pagination |

---

## 1. getCompany (Full Record)

```
GET /api/Company/getCompany/{id}/{apiToken}
```

Returns the complete company object with nested sub-structures: identification, phone numbers, contacts, aircraft relationships, certifications, and related companies.

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "company": {
    "identification": {
      "companyid": 4425,
      "parentcompanyid": 0,
      "name": "Acme Aviation LLC",
      "altname": "",
      "address1": "123 Main St",
      "city": "Dallas",
      "state": "Texas",
      "postcode": "75201",
      "country": "United States",
      "email": "info@acmeaviation.com",
      "website": "www.acmeaviation.com",
      "actiondate": "2025-01-15T00:00:00"
    },
    "phonenumbers": [...],
    "contacts": [...],
    "aircraftrelationships": [...],
    "relatedcompanies": null,
    "companycertifications": null
  }
}
```

### When to Use

Use this when you need the full company profile in a single call. For lightweight validation or display previews, prefer `getIdentification`.

---

## 2. getIdentification (Lightweight)

```
GET /api/Company/getIdentification/{id}/{apiToken}
```

Returns identification fields only. Useful for quick validation, UI previews, and confirming a `companyid` exists before making heavier calls.

### Response Key

`companyIdentification`

### Key Fields

| Field | Type | Description |
|-------|------|-------------|
| `companyid` | integer | Primary key |
| `parentcompanyid` | integer | Parent company (0 = standalone) |
| `name` | string | Legal company name |
| `altname` | string | Alternate / DBA name |
| `address1` | string | Street address |
| `city` | string | City |
| `state` | string | State / province |
| `postcode` | string | Postal code |
| `country` | string | Country |
| `email` | string | Primary email |
| `website` | string | Company website |
| `actiondate` | string (ISO) | Last update timestamp |

---

## 3. getContacts (Contact IDs Only)

```
GET /api/Company/getContacts/{id}/{apiToken}
```

Returns an array of `contactid` integers associated with this company.

### Critical Behavior

This endpoint returns **ID arrays, not full contact objects**. You must call `Contact/getContact/{contactid}/{apiToken}` or `Contact/getIdentification/{contactid}/{apiToken}` for each ID to hydrate full contact records.

### Fan-Out Warning

A company with 20 contacts requires 20 follow-up calls. Limit concurrency and consider whether you truly need all contacts or just the primary ones from `getAircraftrelationships`.

```python
contact_ids = resp.get("contacts") or []
for cid in contact_ids[:10]:
    contact = session.get(f"/api/Contact/getIdentification/{cid}/{token}")
```

```javascript
const contactIds = data.contacts ?? [];
const results = [];
for (const cid of contactIds.slice(0, 10)) {
  results.push(await fetch(`${BASE}/api/Contact/getIdentification/${cid}/${TOKEN}`));
}
```

---

## 4. getPhonenumbers

```
GET /api/Company/getPhonenumbers/{id}/{apiToken}
```

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "count": 2,
  "phonenumbers": [
    { "type": "Office", "number": "214-555-0100" },
    { "type": "Fax", "number": "214-555-0101" }
  ]
}
```

### Null Array Warning

When no phone numbers exist, the response is:

```json
{
  "responsestatus": "SUCCESS: NO RESULTS FOUND [PHONE NUMBERS]",
  "count": 0,
  "phonenumbers": null
}
```

Always guard before iterating:

```python
phones = resp.get("phonenumbers") or []
```

```javascript
const phones = data.phonenumbers ?? [];
```

---

## 5. getRelatedcompanies

```
GET /api/Company/getRelatedcompanies/{id}/{apiToken}
```

Returns affiliated, parent, and subsidiary companies.

### Response Key

`relatedcompanies` (array or `null`)

### Typical Empty Response

```json
{
  "responsestatus": "SUCCESS: NO RESULTS FOUND [RELATED COMPANIES]",
  "count": 0,
  "relatedcompanies": null
}
```

### When to Use

- Corporate family / hierarchy mapping
- Affiliate graph expansion
- Due diligence and relationship intelligence
- Understanding if an "operator" is a subsidiary of the named owner

---

## 6. getAircraftrelationships

```
GET /api/Company/getAircraftrelationships/{id}/{apiToken}
```

Returns all aircraft tied to this company and the nature of each relationship.

### Response Key

`aircraftrelationships` (array)

### Response Structure

```json
{
  "responsestatus": "SUCCESS",
  "count": 3,
  "aircraftrelationships": [
    {
      "aircraftid": 211461,
      "relationtype": "Owner",
      "relationseqno": 1,
      "contactid": 524808,
      "ownerpercent": null,
      "fractionexpiresdate": null,
      "isoperator": "N",
      "businesstype": "End User"
    }
  ]
}
```

### Key Fields

| Field | Type | Notes |
|-------|------|-------|
| `aircraftid` | integer | Join key to Aircraft endpoints |
| `relationtype` | string | `"Owner"`, `"Operator"`, `"Additional Company/Contact"` |
| `relationseqno` | integer | Sequence number within this relation type |
| `contactid` | integer | Bridge to Contact endpoints |
| `ownerpercent` | number or null | Fractional ownership percentage (can be null) |
| `fractionexpiresdate` | string or null | Fractional share expiration |
| `isoperator` | string | `"Y"` or `"N"` (string, not boolean) |
| `businesstype` | string | `"End User"`, `"Dealer Broker"`, `"Charter Company"`, etc. |

### Gotchas

- `isoperator` is a `"Y"`/`"N"` **string**, not a boolean. Do not cast directly to boolean.
- `ownerpercent` and `fractionexpiresdate` can be `null` even when a relationship exists.
- `contactid` provides a direct bridge to Contact endpoints without needing `getContacts`.

---

## 7. getCompanyCertifications

```
GET /api/Company/getCompanyCertifications/{id}/{apiToken}
```

### Response Key

`companycertifications` (array or `null`)

### Typical Empty Response

```json
{
  "responsestatus": "SUCCESS: NO RESULTS FOUND [CERTIFICATIONS]",
  "count": 0,
  "companycertifications": null
}
```

This endpoint frequently returns empty results. Use for compliance, audits, or operator qualification workflows.

---

## 8. getCompanyHistory

```
POST /api/Company/getCompanyHistory/{apiToken}
POST /api/Company/getCompanyHistoryPaged/{apiToken}/{pagesize}/{page}
```

Returns transaction history for one or more companies. Use when the question is "What aircraft has this company bought or sold?" rather than "What happened to this specific aircraft?"

### Request Body (`CompHistoryOptions`)

```json
{
  "companyid": 0,
  "complist": [2346, 12389],
  "aircraftid": 0,
  "aclist": [],
  "transtype": ["FullSale"],
  "relationship": [],
  "startdate": "01/01/2024",
  "enddate": "12/31/2025",
  "lastactionstartdate": "",
  "lastactionenddate": "",
  "isinternaltrans": "No",
  "isoperator": "Ignore"
}
```

| Field | Type | Purpose |
|-------|------|---------|
| `companyid` | integer | Single company filter (0 = no filter) |
| `complist` | array | Multiple company IDs for bulk queries |
| `aircraftid` | integer | Single aircraft filter (0 = no filter) |
| `aclist` | array | Multiple aircraft IDs |
| `transtype` | array | `["None"]` (all), `["FullSale"]`, `["Lease"]`, etc. |
| `relationship` | array | Filter by relationship type |
| `startdate` / `enddate` | string | Date range (`MM/DD/YYYY`) |
| `lastactionstartdate` / `lastactionenddate` | string | Filter by JETNET record update date |
| `isinternaltrans` | string | `"Yes"`, `"No"`, `"Ignore"` |
| `isoperator` | string | `"Yes"`, `"No"`, `"Ignore"` |

### Response Key

`history` (array) — same structure as Aircraft history. See [History](history.md) for full field reference.

---

## 9. getCompanyList / getCompanyListPaged (Search)

```
POST /api/Company/getCompanyList/{apiToken}
POST /api/Company/getCompanyListPaged/{apiToken}/{pagesize}/{page}
```

Search for companies by name, location, business type, aircraft association, and more.

### Request Body (`CompListOptions`)

```json
{
  "name": "NetJets",
  "country": "United States",
  "city": "",
  "state": ["NY", "NJ"],
  "statename": [],
  "bustype": ["Charter Company", "Fixed Base Operator"],
  "airframetype": "None",
  "maketype": "None",
  "modelid": [],
  "make": [],
  "relationship": [],
  "isoperator": "",
  "actiondate": "",
  "companychanges": "",
  "website": "",
  "complist": [],
  "aircraftid": []
}
```

| Field | Type | Purpose |
|-------|------|---------|
| `name` | string | Company name search (partial match) |
| `country` | string | Country filter |
| `city` | string | City filter |
| `state` | array | State/province codes |
| `statename` | array | Full state names |
| `bustype` | array | Business type filter (see values below) |
| `airframetype` | enum | `"FixedWing"`, `"Rotary"`, `"None"` |
| `maketype` | enum | `"BusinessJet"`, `"Turboprop"`, `"None"` |
| `modelid` | array | Filter by aircraft model IDs |
| `make` | array | Filter by manufacturer |
| `relationship` | array | Filter by relationship type |
| `isoperator` | string | `"Y"` = operators only, `"N"` = non-operators, `""` = all |
| `actiondate` | string | Records updated since this date (`MM/DD/YYYY`) |
| `companychanges` | string | Change detection filter |
| `website` | string | Website search |
| `complist` | array | Specific company IDs to retrieve |
| `aircraftid` | array | Companies associated with these aircraft |

### Common `bustype` Values

`"End User"`, `"Charter Company"`, `"Fixed Base Operator"`, `"Dealer Broker"`, `"Management Company"`, `"Fractional Company"`, `"Manufacturer"`, `"Maintenance Facility"`

### Response Structure

```json
{
  "responsestatus": "SUCCESS: PAGE [ 1 of 5 ]",
  "count": 47,
  "currentpage": 1,
  "maxpages": 5,
  "companylist": [
    {
      "companyid": 4425,
      "name": "Acme Aviation LLC",
      "city": "Dallas",
      "state": "Texas",
      "country": "United States",
      "bustype": "Charter Company",
      "pageurl": "https://www.jetnetevolution.com/..."
    }
  ]
}
```

### Response Key

Non-paged (`getCompanyList`): `companies` (array)
Paged (`getCompanyListPaged`): `companylist` (array)

The response key **changes** between paged and non-paged variants. Non-paged also returns `currentpage: 0, maxpages: 0` — do not interpret these as paging metadata.

Always use the paged variant (`getCompanyListPaged`) for automated pipelines and production workflows.

---

## Recommended Workflow

```
Search → Validate → Expand → Link to Aircraft/Contacts
```

1. **`getCompanyListPaged`** — find companies matching your criteria, get `companyid` values
2. **`getIdentification`** — lightweight confirm + display fields
3. **`getCompany`** — full profile when needed
4. **`getPhonenumbers`** — communications enrichment
5. **`getRelatedcompanies`** — expand corporate family graph
6. **`getAircraftrelationships`** — link aircraft and roles (includes `contactid` for bridging)
7. **`getContacts`** — get all contact IDs, then hydrate individually
8. **`getCompanyHistory`** — pull transaction change log

### Workflow Example (Python)

```python
companies = get_all_pages(bearer, token,
    f"/api/Company/getCompanyListPaged/{token}",
    {"bustype": ["Charter Company"], "state": ["TX"]},
    response_key="companies"
)

for comp in companies:
    cid = comp["companyid"]

    rels = session.get(
        f"{BASE}/api/Company/getAircraftrelationships/{cid}/{token}",
        headers={"Authorization": f"Bearer {bearer}"}
    ).json()

    aircraft_links = rels.get("aircraftrelationships") or []
    for link in aircraft_links:
        print(f"  Aircraft {link['aircraftid']} — {link['relationtype']}")
```

---

## Key Behaviors and Gotchas

### "SUCCESS: NO RESULTS FOUND" Is Normal

Several Company sub-endpoints return this status when no data exists. It is a valid business state, not an error. Use a prefix check:

```python
status = resp.get("responsestatus", "")
if status.upper().startswith("SUCCESS"):
    pass
elif "ERROR" in status.upper():
    raise ValueError(f"JETNET error: {status}")
```

```javascript
const status = data.responsestatus || "";
if (status.toUpperCase().startsWith("SUCCESS")) {
  // ok — may or may not contain data
} else if (status.toUpperCase().includes("ERROR")) {
  throw new Error(`JETNET error: ${status}`);
}
```

### Null Arrays

`phonenumbers`, `relatedcompanies`, `companycertifications`, and `contacts` can be `null` instead of `[]`. Always guard before calling `.map()`, `.forEach()`, or iterating:

```javascript
const phones = data.phonenumbers ?? [];
const related = data.relatedcompanies ?? [];
```

### `isoperator` Is a String

The `isoperator` field in aircraft relationships is `"Y"` or `"N"` (string), not a boolean. Direct boolean casting will treat both as truthy.

### `ownerpercent` Can Be Null

Even when a valid ownership relationship exists, `ownerpercent` may be `null`. Do not assume it is always populated for Owner relationships.

### Fan-Out / N+1 Risk

`getContacts` returns only an array of `contactid` integers. Hydrating each contact requires a separate API call. Batch your requests, limit concurrency, and consider whether `getAircraftrelationships` (which includes `contactid`) already provides the contacts you need.

---

## See Also

- [Contacts](contacts.md) — Contact endpoint details and hydration patterns
- [History](history.md) — Transaction history (Aircraft and Company)
- [Response Handling](response-handling.md) — Nested vs flat relationship schemas
- [ID System](id-system.md) — `companyid`, `contactid`, `aircraftid` join keys
- [Pagination](pagination.md) — Paged loop patterns and `maxpages: 0` quirk
- [Common Mistakes](common-mistakes.md) — Known gotchas including null arrays and string booleans

---
# SOURCE: docs/model-data.md
---

# Model Data Endpoints

The JETNET API provides four Model endpoints that return manufacturer-level reference data for aircraft types. These endpoints are keyed by `modelid` (the numeric AMODID) and cover market trends, operating costs, performance specifications, and intelligence summaries.

`getModelMarketTrends` is documented separately in [Market Trends](trends.md). This guide covers the remaining three endpoints.

---

## Endpoints Overview

| Endpoint | Response Key | What It Returns |
|----------|-------------|-----------------|
| `getModelOperationCosts` | `modeloperationcosts` | Annual operating cost breakdown per model |
| `getModelPerformanceSpecs` | `modelperformancespecs` | Physical dimensions, range, speed, cabin specs |
| `getModelIntelligence` | *(see below)* | Aggregated model intelligence summary |
| `getModelMarketTrends` | `modelMarketTrends` | Monthly pricing, inventory, days-on-market ([docs](trends.md)) |

All Model endpoints are `POST` requests with the token in the URL path.

---

## 1. getModelOperationCosts

`POST /api/Model/getModelOperationCosts/{apiToken}`

Returns annual operating cost estimates broken down by cost category for one or more models.

### Request Body (`ModelPerformanceOptions`)

```json
{
  "modlist": [278, 288],
  "airframetype": "None",
  "maketype": "None",
  "make": "",
  "annualhours": 400,
  "fuelprice": 6
}
```

| Field | Type | Description |
|-------|------|-------------|
| `modlist` | array | Model IDs to query (required for useful results) |
| `airframetype` | string | Airframe filter (`"None"` for all) |
| `maketype` | string | Make type filter (`"None"` for all) |
| `make` | string | Manufacturer name filter (empty string for all) |
| `annualhours` | integer | Assumed annual flight hours for cost projection (0 for defaults) |
| `fuelprice` | integer | Fuel price per gallon for cost projection (0 for defaults) |

### Response

```json
{
  "responseid": "123456789",
  "responsestatus": "SUCCESS",
  "count": 2,
  "modeloperationcosts": [
    {
      "modelid": 278,
      "airframetype": "FixedWing",
      "maketype": "BusinessJet",
      "make": "GULFSTREAM",
      "model": "G550",
      "fuel_gal_cost": 6.00,
      "fuel_additive_cost": 0.05,
      "fuel_burn_rate": 280,
      ...
    }
  ]
}
```

**Response key**: `modeloperationcosts` (all lowercase).

### Key Fields

| Field | Description |
|-------|-------------|
| `modelid` | Numeric model identifier |
| `make` / `model` | Manufacturer and model name |
| `fuel_gal_cost` | Fuel cost per gallon used in calculation |
| `fuel_additive_cost` | Fuel additive cost per gallon |
| `fuel_burn_rate` | Gallons per hour burn rate |

Additional cost fields cover crew, maintenance, insurance, hangar, and other variable and fixed operating expenses. The exact fields returned depend on the model and data availability.

---

## 2. getModelPerformanceSpecs

`POST /api/Model/getModelPerformanceSpecs/{apiToken}`

Returns physical dimensions, range, speed, payload, and cabin specifications for one or more models.

### Request Body (`ModelPerformanceOptions`)

```json
{
  "modlist": [145, 634],
  "airframetype": "None",
  "maketype": "None",
  "make": "",
  "annualhours": 0,
  "fuelprice": 0
}
```

Uses the same `ModelPerformanceOptions` schema as `getModelOperationCosts`. Set `annualhours` and `fuelprice` to `0` when only performance data is needed.

### Response

```json
{
  "responseid": "123456789",
  "responsestatus": "SUCCESS",
  "count": 2,
  "modelperformancespecs": [
    {
      "modelid": 145,
      "airframetype": "FixedWing",
      "maketype": "BusinessJet",
      "make": "CESSNA",
      "model": "CITATION X",
      "fuselage_length": 73.3,
      "fuselage_height": 5.7,
      "fuselage_wing_span": 63.6,
      ...
    }
  ]
}
```

**Response key**: `modelperformancespecs` (all lowercase).

### Key Fields

| Field | Description |
|-------|-------------|
| `modelid` | Numeric model identifier |
| `make` / `model` | Manufacturer and model name |
| `fuselage_length` | Overall fuselage length |
| `fuselage_height` | Fuselage height |
| `fuselage_wing_span` | Wingspan |

Additional fields cover cabin dimensions (length, width, height), range, max speed, cruise speed, max altitude, max passengers, baggage volume, and engine specifications. Field availability varies by model.

---

## 3. getModelIntelligence

`POST /api/Model/getModelIntelligence/{apiToken}`

Returns an aggregated intelligence summary for the requested models. This endpoint combines fleet population, market positioning, and classification metadata.

### Request Body

```json
{
  "modlist": [278],
  "airframetype": "None",
  "maketype": "None",
  "make": ""
}
```

### Notes

- The request body must be valid JSON. Malformed bodies (e.g., unmatched brackets) return a `400` validation error.
- Consult the API documentation or test in Postman for the exact response structure, as field availability depends on the model and subscription tier.

---

## Common Patterns

### Shared Request Schema

`getModelOperationCosts` and `getModelPerformanceSpecs` share the same `ModelPerformanceOptions` request body. You can query both endpoints with the same payload to get a complete cost-plus-performance picture for a set of models.

### Response Key Casing

| Endpoint | Response Key |
|----------|-------------|
| `getModelOperationCosts` | `modeloperationcosts` (lowercase) |
| `getModelPerformanceSpecs` | `modelperformancespecs` (lowercase) |
| `getModelMarketTrends` | `modelMarketTrends` (camelCase with capital M) |

The inconsistent casing between `modelMarketTrends` and the other two endpoints is a known API quirk. Always use the exact key shown above when extracting data from responses.

### Model ID Lookup

All Model endpoints require `modlist` (an array of numeric model IDs). To find the right IDs:

- Use the [Model ID Reference](../references/model-ids.md) table
- Run `python scripts/model_search.py "G550"` to search by name
- Call `POST /api/Utility/getAircraftModelList/{apiToken}` at runtime

An empty `modlist: []` returns all models (potentially very large result sets).

---

## Use Cases

### Operating Cost Benchmarks

Compare annual operating costs across competing models to support fleet planning or acquisition decisions.

```python
body = {
    "modlist": [278, 288, 663],
    "airframetype": "None",
    "maketype": "None",
    "make": "",
    "annualhours": 400,
    "fuelprice": 6
}
costs = api_post(f"/api/Model/getModelOperationCosts/{token}", body)
for item in costs["modeloperationcosts"]:
    print(f"{item['make']} {item['model']}: fuel burn {item['fuel_burn_rate']} gal/hr")
```

### Performance Comparisons

Evaluate range, speed, and cabin size across models for mission-fit analysis.

```python
body = {
    "modlist": [145, 634],
    "airframetype": "None",
    "maketype": "None",
    "make": "",
    "annualhours": 0,
    "fuelprice": 0
}
specs = api_post(f"/api/Model/getModelPerformanceSpecs/{token}", body)
for item in specs["modelperformancespecs"]:
    print(f"{item['make']} {item['model']}: length {item['fuselage_length']}")
```

### Valuation Support

Combine `getModelOperationCosts` with `getModelMarketTrends` ([docs](trends.md)) to contextualize asking prices against operating economics. High operating costs relative to market value can signal depreciation pressure; low costs relative to peers can indicate value opportunities.

### Full Model Profile

Query all three endpoints with the same `modlist` to build a complete model profile:

1. **Performance** (`getModelPerformanceSpecs`) -- what the aircraft can do
2. **Costs** (`getModelOperationCosts`) -- what it costs to operate
3. **Market** (`getModelMarketTrends`) -- what the market is doing

---

## See Also

- [Market Trends](trends.md) -- `getModelMarketTrends` time-series documentation
- [Model ID Reference](../references/model-ids.md) -- complete model ID lookup table
- [Enum Reference](enum-reference.md) -- `eAirFrameTypes`, `eMakeTypes` values
- [Response Handling](response-handling.md) -- general response structure guidance
- [Utility Endpoints](utility-endpoints.md) -- `getAircraftModelList` for runtime model lookup

---
# SOURCE: docs/airports.md
---

# Airports

The Airports endpoint provides standardized airport reference data used across flight operations, basing analysis, and geographic market intelligence. Unlike transactional datasets (flights, events, history), airports represent **static infrastructure entities** that enable consistent geographic normalization and spatial aggregation.

This dataset functions as a **dimension table** within analytics pipelines -- the spatial index that ties together flights, events, snapshots, and market trends.

---

## Endpoint

### `POST /api/Utility/getAirportList/{apiToken}`

Returns airport records matching the provided filters. All parameters are optional and can be combined.

### Request Body

```json
{
  "name": "",
  "city": "",
  "state": [],
  "statename": [],
  "country": "",
  "iata": "",
  "icao": "",
  "faaid": ""
}
```

### Request Parameters

| Field | Type | Description |
|-------|------|-------------|
| `name` | string | Airport name filter |
| `city` | string | City filter |
| `state` | array[string] | State/province abbreviations |
| `statename` | array[string] | Full state names |
| `country` | string | Country filter |
| `iata` | string | IATA airport code (e.g., `"SLK"`) |
| `icao` | string | ICAO airport identifier (e.g., `"KSLK"`) |
| `faaid` | string | FAA identifier (U.S. airports) |

### Response Fields

| Field | Description |
|-------|-------------|
| `airportid` | Unique JETNET airport identifier |
| `name` | Airport name |
| `city` | Associated city |
| `state` | State or region |
| `country` | Country |
| `iata` | IATA code |
| `icao` | ICAO code |
| `faaid` | FAA identifier (where applicable) |

### Example: Lookup by ICAO

```python
resp = session.post(
    f"{BASE}/api/Utility/getAirportList/{token}",
    json={"icao": "KTEB"}
)
airports = resp.json()  # array of matching airport records
```

### Example: Filter by State

```python
resp = session.post(
    f"{BASE}/api/Utility/getAirportList/{token}",
    json={"state": ["NY", "NJ"]}
)
airports = resp.json()
```

---

## Role as a Dimension Table

Airports serve as the geographic backbone for nearly every other dataset in the JETNET API. The relationship model:

```
Airports (Dimension)
    ↓
Flights (Fact)      -- origin / destination fields join to ICAO/IATA
Events (Fact)       -- location context for lifecycle changes
Snapshots (Fact)    -- base airport for ownership state
Market Trends (Fact) -- regional aggregation layer
```

Key join fields across datasets:

| Dataset | Join Field | Airport Key |
|---------|-----------|-------------|
| Flight Data (`getFlightData`) | `origin` / `destination` | ICAO code |
| Aircraft base location | `basecode` | Airport identifier |
| Condensed Snapshots | Base fields | Airport identifier |

---

## Analytical Applications

### 1. Traffic Analysis

Join airport data with `getFlightData` to produce:

- Traffic volume by airport
- Origin/destination heatmaps
- Route density analysis
- Regional utilization trends

### 2. Basing Distribution

Combined with snapshots (`getCondensedSnapshot`) and ownership data:

- Aircraft basing distribution by airport/region
- Fleet geographic migration over time
- Operator regional concentration

### 3. Geographic Migration

Track how fleet basing shifts across time windows by comparing snapshot data against the airport dimension:

- Quarter-over-quarter base changes
- Country-level fleet growth
- Emerging operational hubs

### 4. Event Correlation

Paired with aircraft events (`getEventListPaged`):

- Base change tracking
- Operational relocations
- Market entry/exit signals by region

### 5. Market & Trend Modeling

Supports aggregation for:

- Activity by metropolitan region
- Country-level fleet growth
- Airport ecosystem analysis

---

## Time-Series Opportunities

Although airports themselves are static, they enable derived time-series when joined with temporal datasets:

| Derived Series | Source |
|---------------|--------|
| Monthly operations per airport | `getFlightData` grouped by origin/destination |
| Aircraft counts by airport over time | `getCondensedSnapshot` with base fields |
| Event density by region | `getEventListPaged` grouped by location |
| Fleet migration timelines | Sequential snapshots compared against airport dimension |

Airports function as the **spatial index** for all temporal datasets.

---

## Caching Recommendation

Airport data changes very infrequently. Recommended approach:

- **Cache locally** after initial fetch
- **Refresh schedule**: weekly or monthly is sufficient
- **Normalization**: use ICAO codes as the canonical join key across datasets (most consistent identifier)
- Maintain a local airport dimension table for analytics joins

---

## Best Practices

1. **Normalize geographic references** against ICAO codes when possible -- they are the most globally consistent identifier.
2. **Maintain airport dimension keys** in your data warehouse for consistent analytics joins.
3. **Use airports to avoid free-text geographic fragmentation** -- raw city/state strings in other datasets can be inconsistent.
4. **Cache aggressively** -- this is a low-volatility reference dataset.
5. **Filter narrowly** when querying -- use specific `icao`, `iata`, or `state` parameters rather than pulling the entire list repeatedly.

---

## See Also

- [Flight Data](flight-data.md) -- per-flight records with origin/destination airport codes
- [Snapshots](snapshots.md) -- historical fleet state with base location fields
- [Events](events.md) -- lifecycle changes that may include location context
- [Trends](trends.md) -- market analytics that can be aggregated by region
- [Utility Endpoints](utility-endpoints.md) -- other reference/dimension endpoints

---
# SOURCE: docs/utility-endpoints.md
---

# Utility & Reference Endpoints

## Conceptual Model

The Utility endpoints provide **foundational reference data** -- the controlled vocabularies, classification taxonomies, and enumeration values that every other JETNET endpoint depends on. They are the metadata backbone of the API.

Think of them as **dimension tables** in a data warehouse: they define the valid values for `lifecycle`, `airframetype`, `maketype`, `modelid`, `categorysize`, event categories, and more. Without them, you cannot reliably filter, join, or interpret data from Aircraft, Company, Contact, Model, or Flight endpoints.

```
Utility Layer (Cached Reference Data)
│
├── Lifecycle Status    ← lifecycle filter values
├── Airframe Types      ← FixedWing / Rotary
├── Make List           ← manufacturer taxonomy
├── Model List          ← modelid foreign key + classification
├── JNIQ Sizes          ← category size taxonomy
├── Event Categories    ← event domain groupings
├── Event Types         ← specific event signals per category
├── Weight Classes      ← aircraft weight classification
├── Make Types          ← propulsion/category classification
├── Business Types      ← company business type taxonomy
├── Relationship Types  ← aircraft-company relationship taxonomy
├── History Trans Types ← transaction type enumeration
├── Country List        ← country reference
├── State List          ← state/province reference per country
└── Product Codes       ← account entitlement codes
        ↓
  Used by every operational endpoint
        ↓
  Snapshots / Trends / Events / Flights / Aircraft / Companies / Contacts
```

---

## Aircraft Lifecycle Status

```
GET /api/Utility/getAircraftLifecycleStatus/{apiToken}
```

Returns the authoritative list of aircraft lifecycle states used as filter values across the API.

### Response

Response key: **`lifecyclestatus`** (array of strings)

```json
{
  "lifecyclestatus": [
    "InProduction",
    "NewWithManufacturer",
    "InOperation",
    "Retired",
    "InStorage"
  ]
}
```

### Usage

- Populate `lifecycle` filter in `getAircraftList`, `getCondensedSnapshot`, `getBulkAircraftExport`
- Partition fleets into active vs inactive populations
- Drive UI dropdown filters

---

## Aircraft Make List

```
POST /api/Utility/getAircraftMakeList/{apiToken}
```

Returns all aircraft manufacturers (OEM makes) recognized by JETNET.

### Request Body

```json
{
  "airframetype": "None",
  "maketype": "None"
}
```

| Field | Purpose | Notes |
|-------|---------|-------|
| `airframetype` | Filter by airframe | `"None"` = all |
| `maketype` | Filter by propulsion | `"None"` = all |

### Response

Each record includes:

| Field | Description |
|-------|-------------|
| `make` | Canonical make name (ALL CAPS) |
| `manufacturer` | Display manufacturer name |

```json
{
  "make": "GULFSTREAM",
  "manufacturer": "Gulfstream Aerospace"
}
```

### Usage

- Top-level taxonomy for aircraft classification
- Validate `make` parameter before passing to search endpoints
- Build cascading selectors: Make → Model
- Map to internal canonical manufacturer IDs

---

## Aircraft Model List

```
POST /api/Utility/getAircraftModelList/{apiToken}
```

Returns the complete aircraft model catalog. This is one of the **most critical reference datasets** -- `modelid` is the canonical foreign key used by Trends, Snapshots, Events, and search endpoints.

### Request Body

```json
{
  "airframetype": "None",
  "maketype": "None",
  "make": ""
}
```

| Field | Purpose | Notes |
|-------|---------|-------|
| `airframetype` | Filter by airframe | `"None"` = all |
| `maketype` | Filter by propulsion | `"None"` = all |
| `make` | Filter by manufacturer | `""` = all |

### Response

Key fields per record:

| Field | Description |
|-------|-------------|
| `modelid` | Canonical model ID (integer) -- the primary foreign key |
| `airframetype` | `FixedWing` or `Rotary` |
| `maketype` | Propulsion category (`BusinessJet`, `Turboprop`, etc.) |
| `make` | Manufacturer name (ALL CAPS) |
| `model` | Model designation |
| `manufacturer` | Display manufacturer name |
| `weightclass` | Weight classification |
| `categorysize` | JNIQ category size code |

### Usage

- Resolve `modelid` for use in `getModelMarketTrends`, `getCondensedSnapshot`, `getAircraftList`, `getEventListPaged`
- Fleet segmentation by `weightclass` or `categorysize`
- Model-level dashboards and comparisons
- Cross-reference with `references/model-id-table.json` for quick lookups

---

## Airframe JNIQ Sizes

```
GET /api/Utility/getAirframeJniqSizes/{apiToken}
```

Returns JETNET's standardized aircraft category sizing taxonomy.

### Response

```json
{
  "catcode": "ABJ",
  "description": "Airline Business Jet",
  "trbdescription": "Class X Jets"
}
```

| Field | Description |
|-------|-------------|
| `catcode` | Category code (matches `categorysize` in model records) |
| `description` | Human-readable category name |
| `trbdescription` | Alternative classification label |

### Usage

- Market segmentation and trend rollups
- Fleet class comparisons (Light Jet vs Mid vs Heavy)
- Visualization grouping
- Maps to `categorysize` field in Model List and Trends responses

---

## Airframe Types

```
GET /api/Utility/getAirframeTypes/{apiToken}
```

Returns the highest-level aircraft structural classification.

### Response

Response key: **`airframetypes`** (array of strings)

```json
{
  "airframetypes": ["FixedWing", "Rotary"]
}
```

### Usage

- Primary partition dimension for helicopter vs fixed-wing filtering
- Feeds `airframetype` parameter across all search and filter endpoints
- Treat as a static enum -- these values never change

---

## Make Type List

```
POST /api/Utility/getMakeTypeList/{apiToken}
```

Returns aircraft propulsion/category classifications.

### Request Body

```json
{
  "airframetype": "None"
}
```

### Response

Returns make type values: `BusinessJet`, `Turboprop`, `Piston`, `JetAirliner`, `Turbine`

### Usage

- Feeds `maketype` parameter across search endpoints
- Segments fleet by propulsion type

---

## Weight Class Types

```
GET /api/Utility/getWeightClassTypes/{apiToken}
```

Returns aircraft weight classifications used for regulatory and market segmentation.

### Usage

- Maps to `weightclass` field in model records
- Weight-based fleet analytics

---

## Event Categories

```
GET /api/Utility/getEventCategories/{apiToken}
```

Returns all valid event category strings for use with `getEventListPaged`.

### Known Categories

| Category | Covers |
|----------|--------|
| Aircraft Information | Base changes, airframe hours, registration, specs |
| Company / Contact | Ownership, operator, contact updates |
| Financial Documents | Financial record changes |
| Market Status | For-sale listings, off-market, status transitions |
| Transaction | Sales, leases, ownership transfers |

### Usage

- Populate `evcategory` filter array in event queries
- Values must match exactly -- use this endpoint to discover valid strings rather than guessing

See [Events](events.md) for full event query documentation.

---

## Event Types

```
POST /api/Utility/getEventTypes/{apiToken}
```

Returns valid event type strings within a specific event category.

### Request Body

```json
{
  "eventcategory": "Transaction"
}
```

### Usage

- Populate `evtype` filter array in event queries
- Must call once per category to discover all valid type strings
- Values are strict -- unrecognized values cause errors inside `responsestatus`

See [Events](events.md) for full event query documentation.

---

## Company Business Types

```
GET /api/Utility/getCompanyBusinessTypes/{apiToken}
```

Returns valid business type classifications for companies.

### Usage

- Feeds `bustype` filter in `getCompanyList` and `getCompanyListPaged`
- Classify companies by industry role (FBO, MRO, Broker, Charter, etc.)

---

## Aircraft Company Relationship Types

```
GET /api/Utility/getAircraftCompanyRelationships/{apiToken}
```

Returns valid relationship type values between aircraft and companies.

### Usage

- Feeds `relationship` filter in company and aircraft search endpoints
- Understand the nature of aircraft-company links (Owner, Operator, Manager, etc.)

---

## Aircraft History Transaction Types

```
GET /api/Utility/getAircraftHistoryTransTypes/{apiToken}
```

Returns valid transaction type values for history queries.

### Usage

- Feeds `transtype` filter in `getHistoryList` / `getHistoryListPaged`
- See [Enum Reference](../docs/enum-reference.md) for request vs response `transtype` differences

---

## Country List

```
GET /api/Utility/getCountryList/{apiToken}
```

Returns all countries in the JETNET database.

### Usage

- Feeds `basecountry` / `basecountrylist` / `country` filters
- Geographic segmentation and reporting

---

## State List

```
POST /api/Utility/getStateList/{apiToken}
```

Returns states/provinces for a given country.

### Request Body

```json
{
  "country": "United States"
}
```

### Usage

- Feeds `basestate` / `state` / `statename` filters
- Regional fleet analysis

---

## Product Codes

```
GET /api/Utility/getProductCodes/{apiToken}
```

Returns product codes available to your account.

### Usage

- Check entitlements before calling endpoints that require specific product codes
- Feeds `productcode` filter in `getModelMarketTrends`

---

## Account Info

```
GET /api/Utility/getAccountInfo/{apiToken}
```

Returns information about your API account.

### Usage

- Verify authentication and account status
- Check subscription tier and access level

---

## Caching Strategy

Utility endpoints return slowly-changing reference data. Cache aggressively to reduce API calls and improve performance.

| Endpoint | Cache Duration | Reason |
|----------|---------------|--------|
| Airframe Types | Static | Enum-level data (`FixedWing`, `Rotary`) -- never changes |
| Lifecycle Status | Long-lived (weekly+) | Rarely changes |
| Make List | Long-lived (weekly+) | OEM list is stable |
| JNIQ Sizes | Long-lived (weekly+) | Classification taxonomy, rarely modified |
| Weight Classes | Long-lived (weekly+) | Regulatory categories, stable |
| Event Categories | Long-lived (weekly+) | Domain groupings, rarely modified |
| Event Types | Long-lived (weekly+) | Specific signals per category, stable |
| Business Types | Long-lived (weekly+) | Company classification, stable |
| Relationship Types | Long-lived (weekly+) | Relationship vocabulary, stable |
| History Trans Types | Long-lived (weekly+) | Transaction categories, stable |
| Country List | Long-lived (weekly+) | Countries rarely added |
| State List | Long-lived (weekly+) | States/provinces rarely change |
| Model List | Daily refresh | Occasionally expanded with new models |
| Make Type List | Long-lived (weekly+) | Propulsion categories, stable |
| Product Codes | Session-level | Account-specific, check at startup |

### Recommended Pattern

```python
import json, os, time

CACHE_DIR = ".cache/jetnet"
CACHE_TTL = 86400

def get_cached_or_fetch(name, fetch_fn):
    path = f"{CACHE_DIR}/{name}.json"
    if os.path.exists(path):
        age = time.time() - os.path.getmtime(path)
        if age < CACHE_TTL:
            with open(path) as f:
                return json.load(f)
    data = fetch_fn()
    os.makedirs(CACHE_DIR, exist_ok=True)
    with open(path, "w") as f:
        json.dump(data, f)
    return data
```

---

## Data Architecture Role

These utility endpoints form the **metadata backbone** that all other JETNET APIs depend on:

```
┌─────────────────────────────────────────────┐
│           Operational Endpoints             │
│  Aircraft · Companies · Contacts · Flights  │
│  Events · History · Snapshots · Trends      │
├─────────────────────────────────────────────┤
│           Reference Layer (Utility)         │
│  Models · Makes · Lifecycle · Airframe      │
│  JNIQ Sizes · Event Cats · Business Types   │
│  Countries · States · Relationships         │
└─────────────────────────────────────────────┘
```

Without the utility layer:
- You cannot resolve `modelid` values for trend queries
- You cannot validate enum filter values before sending requests
- You risk sending invalid filter strings that return errors inside `responsestatus`
- You cannot build reliable cascading filters (Airframe → Make → Model)

---

## Integration Priority

**Tier 1 -- Required immediately:**
- Aircraft Model List (`modelid` is used everywhere)
- Lifecycle Status (core filter for fleet analytics)

**Tier 2 -- Strongly recommended:**
- Make List (manufacturer taxonomy)
- JNIQ Sizes (category segmentation)
- Event Categories / Event Types (if using events)

**Tier 3 -- Supportive metadata:**
- Airframe Types (static enum, can hardcode)
- Weight Classes
- Business Types, Relationship Types, History Trans Types
- Country / State Lists
- Product Codes, Account Info

---

## See Also

- [Enum Reference](../docs/enum-reference.md) -- enum values and their meanings
- [Events](events.md) -- event queries that depend on event category/type utilities
- [Trends](trends.md) -- market trends that depend on `modelid` from Model List
- [Snapshots](snapshots.md) -- snapshots using lifecycle and model filters
- [ID System](id-system.md) -- how `modelid` and other IDs connect entities
- [Common Mistakes](common-mistakes.md) -- gotchas including enum strictness
- [Airports](airports.md) -- `getAirportList` (also in Utility namespace)

---
# SOURCE: mcp/README.md
---

# JETNET MCP Server — AI Agent Integration

> **The first aviation data API with native AI agent support.**
> Let Claude, Cursor, Copilot, and any MCP-compatible agent query JETNET data
> with natural language. No code required on the user's side.

---

## What is MCP?

The **Model Context Protocol** (MCP) is an open standard created by Anthropic that lets
AI agents call external tools directly. Instead of a developer writing API integration
code, the AI agent reads the tool definitions, understands the parameters, and makes
the calls itself.

**Before MCP:** Developer reads docs → writes code → tests → deploys → user gets data.
**With MCP:** User asks Claude "What G650s are for sale?" → Claude calls JETNET → user gets data.

This makes JETNET accessible to:
- **Vibe coders** who build by talking to AI instead of writing code
- **Business users** who ask questions in natural language through Claude Desktop
- **AI agents** in Cursor, Copilot, Windsurf, and any MCP client
- **Automation pipelines** where LLMs orchestrate multi-step data workflows

---

## Quick Start

### Option A: Claude Desktop (Local — stdio)

1. **Install dependencies:**
   ```bash
   pip install mcp httpx pydantic
   ```

2. **Configure Claude Desktop** — add to your `claude_desktop_config.json`:
   ```json
   {
     "mcpServers": {
       "jetnet": {
         "command": "python",
         "args": ["/path/to/jetnet_mcp.py"],
         "env": {
           "JETNET_EMAIL": "your_email@example.com",
           "JETNET_PASSWORD": "your_password"
         }
       }
     }
   }
   ```

3. **Restart Claude Desktop.** You'll see the JETNET tools available in the tool picker.

4. **Try it:** Ask Claude *"Look up tail number N650GD and show me who owns it."*

### Option B: Cursor / Copilot (Local — stdio)

1. **Install:** `pip install mcp httpx pydantic`

2. **Add to your project's `.cursor/mcp.json`:**
   ```json
   {
     "mcpServers": {
       "jetnet": {
         "command": "python",
         "args": ["./jetnet_mcp.py"],
         "env": {
           "JETNET_EMAIL": "your_email@example.com",
           "JETNET_PASSWORD": "your_password"
         }
       }
     }
   }
   ```

3. **In Cursor**, ask: *"Find all Challenger 350s for sale and show me market trends for the last 2 years."*

### Option C: Remote Server (Streamable HTTP — multi-client)

For shared deployments, CI/CD pipelines, or multi-user environments:

```bash
TRANSPORT=http \
PORT=8000 \
JETNET_EMAIL=your_email@example.com \
JETNET_PASSWORD=your_password \
python jetnet_mcp.py
```

Then point any MCP client at `http://your-server:8000/mcp`.

---

## Available Tools

The MCP server exposes **11 tools** that cover the most common JETNET workflows.
Each tool handles authentication, token refresh, pagination, and error handling
automatically -- the AI agent just calls the tool with the right parameters.

### Core Tools

| Tool | What It Does | Key Parameters |
|------|-------------|----------------|
| `jetnet_golden_path` | **Complete aircraft profile** -- tail lookup + owner/operator + pictures in one call. The recommended starting point. | `registration` |
| `jetnet_lookup_aircraft` | Look up a single aircraft by tail/registration number. Returns `aircraftid` needed by all other tools. | `registration` |
| `jetnet_get_relationships` | Get owner, operator, manager, trustee relationships for an aircraft. | `aircraftid` |
| `jetnet_get_flight_data` | Flight activity within a date range: departure/arrival airports, dates, utilization. | `aircraftid`, `start_date`, `end_date` |

### Search & Analysis Tools

| Tool | What It Does | Key Parameters |
|------|-------------|----------------|
| `jetnet_search_fleet` | Search the fleet database by model, make, for-sale status, country. Find inventory and listings. | `modlist`, `for_sale`, `country` |
| `jetnet_get_history` | Transaction history: sales, deliveries, registrations within a date range. | `modlist` or `aclist`, date range |
| `jetnet_get_market_trends` | Market analytics: for-sale count, avg asking price, days on market over time. | `modelid`, date range |
| `jetnet_get_snapshot` | Fleet snapshot at a historical point in time: fleet size, for-sale count, composition. | `modlist`, `snapshot_date`, `country` |
| `jetnet_get_model_specs` | Performance specifications: range, speed, cabin dimensions, payload, engines. | `modelid` |

### Utility Tools

| Tool | What It Does | Key Parameters |
|------|-------------|----------------|
| `jetnet_search_models` | Find JETNET model IDs (AMODID) by name, make, or ICAO code. Use these IDs in `modlist`. | `query` (e.g., "G550") |
| `jetnet_health_check` | Verify JETNET connection and credentials are valid. Call first if other tools return errors. | *(none)* |

---

## The Golden Path via MCP

The **Golden Path** is the most common JETNET workflow: start with a tail number,
get a complete aircraft profile. The `jetnet_golden_path` tool executes this entire
workflow in a single call:

```
User: "Tell me everything about N650GD"

Claude calls: jetnet_golden_path(registration="N650GD")

Claude responds with:
  - Aircraft specs (make, model, serial, year, lifecycle status)
  - Owner/Operator (company name, location, relationship type)
  - Pictures (URLs to aircraft photos)
```

For more granular control, agents can call the individual tools:

```
1. jetnet_lookup_aircraft(registration="N650GD")     → aircraftid = 211461
2. jetnet_get_relationships(aircraftid=211461)        → owner, operator details
3. jetnet_get_flight_data(aircraftid=211461, ...)     → flight history
4. jetnet_get_history(aclist=[211461], ...)            → transaction history
```

---

## Example Conversations

### Aircraft Research
> **User:** "Look up VP-BDJ and tell me who owns it, when it was manufactured,
> and if it's for sale."
>
> **Claude:** *calls `jetnet_golden_path(registration="VP-BDJ")`*

### Market Analysis
> **User:** "How many G650s are for sale right now? What's the average asking price
> trend over the last 3 years?"
>
> **Claude:** *calls `jetnet_search_models(query="G650")` → gets AMODID=278*
> *then calls `jetnet_search_fleet(modlist=[278], for_sale="true")`*
> *then calls `jetnet_get_market_trends(modelid=278, start_date="01/01/2023", end_date="02/27/2026")`*

### Fleet Intelligence
> **User:** "Find all Challenger 350s based in Canada."
>
> **Claude:** *calls `jetnet_search_models(query="Challenger 350")` → AMODID=634*
> *then calls `jetnet_search_fleet(modlist=[634], country="Canada")`*

### Transaction Diligence
> **User:** "Show me all G550 transactions in 2024."
>
> **Claude:** *calls `jetnet_get_history(modlist=[145], start_date="01/01/2024", end_date="12/31/2024")`*

### Flight Activity
> **User:** "Where has N1KE been flying in the last 6 months?"
>
> **Claude:** *calls `jetnet_lookup_aircraft(registration="N1KE")` → aircraftid*
> *then calls `jetnet_get_flight_data(aircraftid=..., start_date="08/27/2025", end_date="02/27/2026")`*

---

## Architecture

```
+---------------------+     MCP Protocol      +------------------+
|                     |    (stdio or HTTP)     |                  |
|  Claude Desktop     |<---------------------->|  jetnet_mcp.py   |
|  Cursor / Copilot   |    Tool calls &        |                  |
|  Any MCP Client     |    Responses           |  - Auth/refresh  |
|                     |                        |  - Pagination    |
+---------------------+                        |  - Error handling|
                                               |  - Formatting    |
                                               +--------+---------+
                                                        | HTTPS
                                                        v
                                               +------------------+
                                               | JETNET API       |
                                               | customer.        |
                                               | jetnetconnect.com|
                                               +------------------+
```

### What the MCP server handles for you:
- **Authentication**: Logs in with `emailAddress` (capital A — the #1 gotcha)
- **Token lifecycle**: Proactive refresh at 50 minutes, auto re-login on `INVALID SECURITY TOKEN`
- **apiToken placement**: Always in the URL path, never in headers or body
- **Pagination**: Automatically fetches all pages for paged endpoints
- **Response status checks**: HTTP 200 doesn't mean success — always checks `responsestatus`
- **Date formatting**: Validates `MM/DD/YYYY` with leading zeros
- **Error messages**: Actionable guidance when things go wrong

---

## Configuration

### Environment Variables

| Variable | Required | Default | Description |
|----------|----------|---------|-------------|
| `JETNET_EMAIL` | Yes | — | Your JETNET login email |
| `JETNET_PASSWORD` | Yes | — | Your JETNET password |
| `JETNET_BASE_URL` | No | `https://customer.jetnetconnect.com` | API base URL |
| `TRANSPORT` | No | `stdio` | Transport: `stdio` (local) or `http` (remote) |
| `PORT` | No | `8000` | HTTP port (only used when TRANSPORT=http) |

### Security Best Practices

- **Never commit credentials** to source control. Use environment variables or a secrets manager.
- **Use stdio transport** for single-user, local setups (Claude Desktop, Cursor). Credentials stay on your machine.
- **Use HTTP transport** only behind a VPN or with additional authentication for shared/remote deployments.
- **Token rotation**: JETNET tokens expire at 60 minutes. The MCP server refreshes proactively at 50 minutes. No action needed from the user.

---

## Extending the Server

### Adding New Tools

To add a tool, follow this pattern:

```python
from pydantic import BaseModel, Field

class MyNewInput(BaseModel):
    """Input description."""
    param: str = Field(..., description="What this param does")

@mcp.tool(
    name="jetnet_my_new_tool",
    annotations={
        "title": "Human-Readable Title",
        "readOnlyHint": True,
        "destructiveHint": False,
        "idempotentHint": True,
        "openWorldHint": True,
    },
)
async def jetnet_my_new_tool(params: MyNewInput, ctx=None) -> str:
    """Comprehensive description. Include what it does, what it returns,
    and when to use it vs other tools."""
    session = _get_session(ctx)
    data = await session.request("GET", "/api/...")
    return json.dumps(data, indent=2)
```

### Common JETNET Endpoints Not Yet Exposed

These endpoints could be added as tools following the same pattern:

| Endpoint | Use Case | Priority |
|----------|----------|----------|
| `getCompanyList` | Search companies by name/type | Medium |
| `getContactList` | Search contacts | Medium |
| `getModelOperationCosts` | Annual operating costs | Medium |
| `getAirportList` | Airport reference data | Low |
| `getBulkAircraftExportPaged` | Bulk data sync (Tier B — not for interactive) | Low |

---

## Troubleshooting

| Issue | Cause | Fix |
|-------|-------|-----|
| `Missing JETNET credentials` | Env vars not set | Set `JETNET_EMAIL` and `JETNET_PASSWORD` |
| `JETNET API error: ERROR: INVALID SECURITY TOKEN` | Token expired + auto-retry failed | Check credentials are correct. Server auto-retries once. |
| `No aircraft found` | Bad tail number or trailing whitespace | Verify the registration. The tool auto-strips whitespace and uppercases. |
| `No models found` | Search too specific | Try broader terms: "Gulfstream" instead of "G-550" |
| `Response truncated` | Result exceeds 50K chars | Use filters to narrow results, or request `json` format and process programmatically |
| Tool not appearing in Claude | Config file error | Verify `claude_desktop_config.json` path and restart Claude Desktop |
| `Connection refused` on HTTP | Wrong port or not running | Verify `TRANSPORT=http` and check the port |

---

## Common Model IDs (Quick Reference)

| Aircraft | AMODID | ICAO |
|----------|--------|------|
| Gulfstream G550 | 145 | GLF5 |
| Gulfstream G650/ER | 278 | GLF6 |
| Bombardier Challenger 350 | 634 | CL35 |
| Bombardier Global 7500 | 753 | GL7T |
| Dassault Falcon 8X | 704 | FA8X |
| Dassault Falcon 900LX | 318 | F900 |
| Cessna Citation XLS+ | 326 | C56X |
| Cessna Citation Latitude | 680 | C68A |
| Beechcraft King Air 350 | 255 | B350 |
| Embraer Praetor 600 | 780 | E545 |

Use `jetnet_search_models(query="...")` for the complete list of 872+ models.

---

## File Placement in the Repo

```
jetnet-api-docs/
├── mcp/
│   ├── README.md              ← This file
│   ├── jetnet_mcp.py          ← Python MCP server (stdio + HTTP)
│   ├── requirements.txt       ← mcp, httpx, pydantic
│   └── claude_desktop_config.example.json
├── ...existing files...
```

---

## What This Unlocks

With the MCP server in place, JETNET becomes **the first aviation data API that
AI agents can use natively**. Here's what that means in practice:

1. **Zero-code access**: Business users ask questions in natural language. No integration needed.
2. **AI-assisted development**: Developers in Cursor say "build me a fleet dashboard for G650s" and the AI writes the code AND queries the data to test it.
3. **Multi-step workflows**: An AI agent can chain tools — look up a tail → check ownership → pull flight data → get market comps — in a single conversation.
4. **Competitive moat**: No other aviation data provider offers this. FlightAware, Cirium, and Amstat require traditional API integrations.

---

## License

MIT — same as the parent repository.

---
# SOURCE: references/vertical-playbooks.md
---

# JETNET Vertical Playbooks

One page per industry vertical. Each playbook follows the same format:
the business question, the endpoint(s) that answer it, a minimal payload,
and what to do with the response.

---

## 1. Aircraft Sales and Brokerage

**The business question:** Who owns this aircraft, is it for sale, what is the
asking price, what is its flight activity, and who are the decision makers?

**Primary use case:** A broker wants to research a specific tail or a segment of
the market before approaching a seller or buyer.

### Tail research workflow

```
getRegNumber → get aircraftid
getPictures  → show the aircraft
getRelationships → confirm current owner and operator, get contacts
getFlightData → understand utilization (active vs parked)
getHistoryList → see prior transaction prices and ownership chain
```

### Market scan workflow (find for-sale inventory by model)

```
POST /api/Aircraft/getAircraftList/{apiToken}
{
  "maketype": "BusinessJet",
  "modlist": [145, 634],       // G550, G600
  "forsale": "true",
  "lifecycle": "InOperation",
  "aclist": []
}
```

Response key is `aircraft`. Filter on `asking`/`askingprice` for price ranges.

### Market trend context (how long do they sit, what do they sell for)

```
POST /api/Model/getModelMarketTrends/{apiToken}
{
  "modlist": [145, 634],
  "displayRange": 24,
  "startdate": "COMPUTE_24_MONTHS_AGO",
  "productcode": ["None"]
}
```

Key fields: `avg_asking_price`, `avg_daysonmarket`, `aircraft_for_sale_count`.

### Who to call (decision makers)

Once you have `companyid` from a relationship record:
```
POST /api/Company/getContacts/{companyid}/{apiToken}
```

Returns contacts with title, email, phone. Filter on title for CEO, VP, Director.

---

## 2. OEM Competitive Intelligence

**The business question:** How is our model performing in the market vs competitors?
Who is operating our aircraft and where? What is the delivery and transaction pace?

### Market share by model

```
POST /api/Model/getModelMarketTrends/{apiToken}
{
  "modlist": [YOUR_MODELS + COMPETITOR_MODELS],
  "displayRange": 36,
  "startdate": "COMPUTE_36_MONTHS_AGO",
  "productcode": ["None"]
}
```

Compare `in_operation_count`, `aircraft_for_sale_count`, `avg_asking_price`,
`avg_daysonmarket` across models over time. A rising `avg_daysonmarket` is a
demand signal.

### Delivery and transaction pace (new aircraft entering the fleet)

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/100/1
{
  "modlist": [YOUR_MODEL_IDS],
  "transtype": ["Full Sale - Manufacturer to New"],
  "startdate": "01/01/2024",
  "enddate": "COMPUTE_TODAY",
  "isnewaircraft": "Yes",
  "allrelationships": true,
  "aclist": []
}
```

`Purchaser` in `companyrelationships` is the first buyer. Use this to map which
operators are taking delivery and at what pace.

### Fleet in operation by geography

```
POST /api/Aircraft/getAircraftList/{apiToken}
{
  "modlist": [YOUR_MODEL_IDS],
  "lifecycle": "InOperation",
  "aclist": []
}
```

Group by `basecountry` and `basestate` for territory coverage maps.

### Performance specs (for competitive comparison)

```
POST /api/Model/getModelPerformanceSpecs/{apiToken}
{
  "modlist": [YOUR_MODEL_ID, COMPETITOR_MODEL_ID],
  "airframetype": "None",
  "maketype": "None",
  "make": "",
  "annualhours": 0,
  "fuelprice": 0
}
```

---

## 3. FBO Territory and Traffic Analysis

**The business question:** What aircraft are based near us, who are the operators
flying in and out, and which routes are most active?

### Aircraft based in your territory

```
POST /api/Aircraft/getAircraftList/{apiToken}
{
  "airframetype": "FixedWing",
  "maketype": "BusinessJet",
  "lifecycle": "InOperation",
  "basestate": ["TX", "OK", "LA"],
  "basecountry": "US",
  "aclist": [],
  "modlist": []
}
```

This gives you the local fleet. Cross with `getRelationships` using bulk `aclist`
to get owner/operator contact info for the entire list in one call.

### Traffic into your airport (origin/destination filtering)

```
POST /api/Aircraft/getFlightDataPaged/{apiToken}/100/1
{
  "origin": "KDAL",
  "destination": "",
  "startdate": "COMPUTE_90_DAYS_AGO",
  "enddate": "COMPUTE_TODAY",
  "aclist": [],
  "modlist": []
}
```

Swap `origin` for `destination` to see inbound traffic. Use `aircraftid` from
results with `getRelationships` to identify which operators are most active.

### Operator targeting (companies most active in your market)

Aggregate flight records by `aircraftid`, count legs, then bulk-call `getRelationships`
with the top-N aircraft IDs as `aclist`. This gives you the operators flying the
most in your territory with their contact info.

---

## 4. MRO Targeting and Fleet Monitoring

**The business question:** Which aircraft in our target segment are due for
maintenance, who operates them, and who are the decision makers?

### Fleet snapshot for a model segment

```
POST /api/Aircraft/getBulkAircraftExportPaged/{apiToken}/100/1
{
  "maketype": "BusinessJet",
  "modlist": [TARGET_MODEL_IDS],
  "lifecycle": "InOperation",
  "actiondate": "",
  "forsale": "",
  "aclist": []
}
```

Full aircraft records including `aftt` (airframe total time), `estaftt`,
engine serial numbers, and maintenance tracking fields. Page through all results.

### High-airframe-time aircraft (maintenance trigger)

From the bulk export, filter on `estaftt` above your threshold. These are the
aircraft most likely to need heavy maintenance. Take their `aircraftid` list and
call `getRelationships` in bulk to get the MRO decision maker contacts.

### Change tracking (new operators, recent transactions)

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/100/1
{
  "modlist": [TARGET_MODEL_IDS],
  "startdate": "COMPUTE_90_DAYS_AGO",
  "enddate": "COMPUTE_TODAY",
  "transtype": ["None"],
  "allrelationships": true,
  "aclist": []
}
```

New operator = new MRO relationship opportunity. Filter `transtype` for sale
events to catch aircraft changing hands.

### Contact lookup for decision makers

```
POST /api/Company/getContacts/{companyid}/{apiToken}
```

Filter by title for Director of Maintenance, VP of Operations, Chief Pilot.
These are the MRO buyers.

---

## 5. Finance and Investment Diligence

**The business question:** What is the asset worth, how has it traded historically,
what are comparable transactions, and is the fleet in the collateral pool in good
standing?

### Single asset valuation context

```
POST /api/Model/getModelMarketTrends/{apiToken}
{
  "modlist": [ASSET_MODEL_ID],
  "displayRange": 60,
  "startdate": "COMPUTE_60_MONTHS_AGO",
  "productcode": ["None"]
}
```

60 months of `avg_asking_price`, `low_asking_price`, `high_asking_price`, and
`avg_daysonmarket` gives you price trend and liquidity context for the model.

### Transaction history for the specific aircraft

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/100/1
{
  "aclist": [AIRCRAFT_ID],
  "transtype": ["None"],
  "allrelationships": true,
  "startdate": "01/01/2000",
  "enddate": "COMPUTE_TODAY",
  "aclist": [AIRCRAFT_ID],
  "modlist": []
}
```

Full chain of ownership for the asset. `soldprice` and `askingprice` fields on
transaction records show actual deal prices where available.

### Comparable sales (same model, recent transactions)

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/100/1
{
  "modlist": [ASSET_MODEL_ID],
  "transtype": ["Full Sale - Preowned"],
  "startdate": "COMPUTE_24_MONTHS_AGO",
  "enddate": "COMPUTE_TODAY",
  "ispreownedtrans": "Yes",
  "allrelationships": true,
  "aclist": []
}
```

Filter for `isretailtrans: true` to isolate arm's length transactions. Use
`soldprice` for comps.

### Fleet-level collateral monitoring

Given a list of aircraft IDs in the collateral pool:
```
POST /api/Aircraft/getCondensedOwnerOperators/{apiToken}
{
  "aclist": [ID1, ID2, ID3, ...],
  "modlist": []
}
```

Response key is `aircraftowneroperators`. Each record has `comp1relation`,
`comp1name`, and `datepurchased`. Use `actiondate` parameter to pull only
records that changed since your last snapshot -- essential for incremental
monitoring without re-pulling the entire pool.

---

## 6. Charter Supplemental Lift -- Fractional Owner Targeting

**The business question:** Which fractional owners of large jets in my target
markets have had a recent record update? These are the prospects most likely to
need supplemental lift -- they own fractional shares but occasionally need more
capacity or a different aircraft category.

**Primary use case:** A charter company wants to identify business jet fractional
owners in the Northeast with recent activity and approach them with supplemental
lift offerings.

### Find fractional owners by geography and aircraft type

```
POST /api/Aircraft/getAcCompanyFractionalReportPaged/{apiToken}/{pagesize}/{page}
{
  "airframetype": "FixedWing",
  "maketype": "BusinessJet",
  "regnbr": "",
  "make": "",
  "actiondate": "COMPUTE_30_DAYS_AGO",
  "enddate": "COMPUTE_TODAY",
  "basestate": ["NY", "CT", "MA", "RI", "NJ"],
  "modlist": [],
  "relationship": ["Fractional Owner"]
}
```

Response key is `aircraftcompfractionalrefs`. Page through all results using
`maxpages`. Each page returns `count` records (typically 25-100 per page).

**Key fields for outreach:**

| Field | What it tells you |
|-------|-------------------|
| `company` | Fractional owner company or individual name |
| `contactFirstName` / `contactLastName` | Decision maker name |
| `contactEmailAddress` | Direct email |
| `contactMobile` | Mobile number |
| `fractionPercentOwned` | `"100.00"` = sole owner; partial% = true fractional share |
| `make` / `model` | Aircraft type they own (e.g., CHALLENGER 604) |
| `regnbr` | Tail number |
| `compCity` / `compState` | Billing address / home base |
| `programManager` | Fractional program operator (may be "UNKNOWN") |
| `programHolder` | Program holding entity (may be "UNKNOWN") |
| `lastFractionPurchaseDate` | When they last bought in -- recency signal |

**Filter for actual owners only:** `fractionPercentOwned != "0.00"` -- the
response includes operators and managers on the same aircraft with `"0.00"`.
Pass `"relationship": ["Fractional Owner"]` in the request to pre-filter, but
also post-filter in code to be safe.

### Targeting by specific aircraft model (e.g., heavy jets only)

```
POST /api/Aircraft/getAcCompanyFractionalReportPaged/{apiToken}/{pagesize}/{page}
{
  "airframetype": "FixedWing",
  "maketype": "BusinessJet",
  "regnbr": "",
  "make": "",
  "actiondate": "COMPUTE_90_DAYS_AGO",
  "enddate": "COMPUTE_TODAY",
  "basestate": [],
  "modlist": [33, 34, 35],
  "relationship": ["Fractional Owner"]
}
```

Pass model IDs in `modlist` to narrow to specific aircraft types. Use
`getAircraftModelList` or `references/id-glossary.md` to find model IDs.
Leave `basestate: []` for national scope.

### Enrichment workflow (from fractional record to full relationship picture)

```
1. getAcCompanyFractionalReportPaged  --> aircraftid + companyid + contact info
2. getRelationships (bulk aclist)      --> confirm current operator structure
3. getFlightDataPaged (per aircraftid) --> utilization (is the fraction being used?)
```

High utilization + fractional share = strong candidate for supplemental lift.
Low utilization may indicate a program exit or aircraft transition -- also a
sales signal for a new purchase.

### Common mistakes on this endpoint

- Response key is `aircraftcompfractionalrefs` -- not `aircraft`, not `fractionalowners`
- Each aircraft appears multiple times (one row per relation type) -- deduplicate on `aircraftid` + `companyid` before building a contact list
- `relationship` filter is an array: `["Fractional Owner"]` -- not a string
- `basestate` is an array of abbreviations: `["NY", "CT"]` -- not full state names
- `actiondate` / `enddate` use `MM/DD/YYYY` format with leading zeros
- `programManager` and `programHolder` are often `"UNKNOWN"` for self-managed programs -- do not filter on these fields expecting clean data

Known-good example: `examples/fractional-owner-report.json`

---

## 7. FBO Ramp Contact Targeting

**The business question:** Which companies and decision makers are flying into
my FBO? I want to reach chief pilots, directors of aviation, schedulers, and
dispatchers to win their fuel, handling, and services business over competitors.

**Primary use case:** An FBO collects tail numbers from ramp activity or ADS-B
data, then uses JETNET to identify the right contacts at each company for a
targeted outreach campaign.

### Single tail lookup (Tier A -- Golden Path start)

```
GET /api/Aircraft/getRegNumber/{regnbr}/{apiToken}
```

No request body. Returns `aircraftresult` with a `companyrelationships` array.

**CRITICAL -- getRegNumber uses a flat schema, not nested objects:**

| Field | What it contains |
|-------|-----------------|
| `companyrelation` | Relation type: `"Owner"`, `"Operator"`, `"Chief Pilot"`, etc. |
| `companyname` | Company name (prefixed, not nested) |
| `contactfirstname` / `contactlastname` | Contact name |
| `contacttitle` | Job title -- filter on this for outreach targeting |
| `contactemail` | Email address |
| `contactbestphone` | Best phone (office or mobile) |
| `contactofficephone` / `contactmobilephone` | Phone details |
| `baseicao` | Home airport ICAO code |

### Filter for the right contacts

```python
TARGET_TITLES = {"chief pilot", "director of aviation", "scheduler",
                 "dispatcher", "director of flight operations", "flight coordinator"}

contacts = [
    r for r in aircraft["companyrelationships"]
    if r.get("contacttitle", "").lower() in TARGET_TITLES
       or r.get("companyrelation") in ("Chief Pilot", "Operator")
]
```

Note: field is `companyrelation` (not `relationtype`) -- this is unique to
`getRegNumber`. See `references/id-glossary.md` for the full schema comparison.

### Bulk ramp list workflow (many tails at once)

For a ramp list of 10+ tails, use `getRelationships` with `aclist` in bulk
rather than looping `getRegNumber` per tail:

```
1. getRegNumber per tail           --> aircraftid for each tail
2. getRelationships (bulk aclist)  --> all relationships in one POST
3. getContacts per companyid       --> full contact list for each company
```

`getRelationships` bulk returns the nested schema (`relationtype`, `company {}`,
`contact {}` sub-objects) -- different from `getRegNumber` flat schema.

### Aircraft based at your airport (proactive prospecting)

```
POST /api/Aircraft/getAircraftList/{apiToken}
{
  "airframetype": "FixedWing",
  "maketype": "BusinessJet",
  "lifecycle": "InOperation",
  "baseicao": "KSDL",
  "aclist": [],
  "modlist": []
}
```

Returns all jets based at your airport. Take their `aircraftid` list into
`getRelationships` bulk to get all contacts in one call.

Known-good example: `examples/fbo-contact-lookup.json`

---

## 8. Dealer-Broker Hourly Market Intelligence Feed

**The business question:** What changed in the JETNET database in the last hour?
A dealer-broker runs this on the hour, 24/7/365, to recompute market dynamics
the moment JETNET data updates -- new listings, price changes, ownership
transfers, or status changes.

**Primary use case:** Automated pipeline that detects every aircraft record
change in a 1-hour window and feeds a live market dashboard or pricing model.

### Hourly change query (Tier B -- always paged)

```
POST /api/Aircraft/getBulkAircraftExportPaged/{apiToken}/{pagesize}/{page}
{
  "airframetype": "None",
  "maketype": "BusinessJet",
  "lifecycle": "InOperation",
  "actiondate": "MM/DD/YYYY HH:MM:SS",
  "enddate":    "MM/DD/YYYY HH:MM:SS",
  "exactMatchReg": false,
  "showHistoricalAcRefs": false,
  "showAwaitingDocsCompanies": false,
  "showMaintenance": false,
  "showAdditionalEquip": false,
  "showExterior": false,
  "showInterior": false
}
```

Set `actiondate` = last run time, `enddate` = current time. Store last run
time after each successful call and use it as the next `actiondate`.

**CRITICAL datetime format:** `actiondate` and `enddate` accept full datetime
with time component: `"02/26/2026 10:00:00"`. Date-only strings also work
but miss sub-day changes. Always include time for hourly polling.

### Paging quirk -- maxpages: 0 on small result sets

```python
# WRONG -- will miss single-page results
while page <= data["maxpages"]:  # maxpages=0 exits immediately!

# CORRECT -- treat maxpages <= 1 as a single page
total_pages = max(data.get("maxpages", 1), 1)
while page <= total_pages:
    ...
```

When all results fit in one call, JETNET returns `maxpages: 0` and
`currentpage: 0` -- this is not an error. The `aircraft` array still
contains all records.

### Decoding the responsestatus summary

```python
# "SUCCESS: Ac Count: 12 Comp Count: 28 Cont Count: 24 ..."
status = data["responsestatus"]
# Parse counts if needed:
import re
counts = dict(re.findall(r'(\w[\w ]+\w):\s*(\d+)', status))
# {"Ac Count": "12", "Comp Count": "28", ...}
```

### Flat prefixed relationship schema

`getBulkAircraftExport` uses a unique flat prefixed schema -- every relationship
is embedded directly in the aircraft record with role-based prefixes:

| Prefix | Role |
|--------|------|
| `owr*` | Owner (`owrcompanyname`, `owrfname`, `owrtitle`, `owremail`, `owrphone1`) |
| `opr*` | Operator |
| `chp*` | Chief Pilot |
| `excbrk1*` / `excbrk2*` | Exclusive Brokers |
| `addl1*` / `addl2*` / `addl3*` | Additional relationships |

`forsale` in this endpoint is `"Y"` / `"N"` / `""` -- NOT `"true"`/`"false"`
as in `getAircraftList`.

`datepurchased` is `YYYYMMDD` format -- convert before comparing to other dates.

### Embedded sub-arrays (avoid extra API calls)

Each aircraft record contains embedded arrays controlled by the `show*` flags:

| Flag | Array | Use when |
|------|-------|----------|
| `showMaintenance: true` | `acmaintenance[]` | MRO targeting |
| `showAdditionalEquip: true` | `acaddequipment[]` | Equipment research |
| `showExterior: true` | `acexteriors[]` | Refurb/paint targeting |
| `showInterior: true` | `acinteriors[]` | Interior upgrade targeting |
| Always included | `acevents[]` | Ownership/status change history |
| Always included | `flightdata[]` | Monthly flight hour summary |

Keep all `show*` flags false for hourly polling -- reduces payload size
significantly. Enable only the sub-arrays your pipeline actually processes.

### Hourly polling scheduler (Python skeleton)

```python
import time, datetime

def poll_hourly(bearer, token, maketype="BusinessJet"):
    last_run = datetime.datetime.now() - datetime.timedelta(hours=1)
    while True:
        now = datetime.datetime.now()
        body = {
            "airframetype": "None",
            "maketype": maketype,
            "lifecycle": "InOperation",
            "actiondate": last_run.strftime("%m/%d/%Y %H:%M:%S"),
            "enddate":    now.strftime("%m/%d/%Y %H:%M:%S"),
            "exactMatchReg": False,
            "showHistoricalAcRefs": False,
            "showAwaitingDocsCompanies": False,
            "showMaintenance": False,
            "showAdditionalEquip": False,
            "showExterior": False,
            "showInterior": False,
        }
        changes = get_bulk_export(bearer, token, body, pagesize=100)
        process_changes(changes)    # your pipeline here
        last_run = now
        time.sleep(3600)            # sleep until next hour
```

Known-good example: `examples/bulk-export-hourly.json`

---

## 9. Transaction and Sale History Search

**The business question:** What aircraft in this model segment sold or leased
in a given time window? Who were the buyers, sellers, and brokers? What were
the asking prices and deal terms?

**Primary use cases:** Brokers researching comparable sales ("comps") for a
listing; analysts tracking market velocity; dealers sourcing aircraft that
recently changed hands; CRM teams identifying new owners to approach.

### Find all sales and leases for a model in a date range

```
POST /api/Aircraft/getHistoryListPaged/{apiToken}/{pagesize}/{page}
{
  "make": "",
  "modelid": 0,
  "modlist": [1194],
  "transtype": ["FullSale", "Lease"],
  "startdate": "MM/DD/YYYY",
  "enddate":   "MM/DD/YYYY",
  "isinternaltrans": "No",
  "isnewaircraft": "No",
  "allrelationships": true,
  "aclist": []
}
```

`modlist: [1194]` = Citation CJ3+. Use `getAircraftModelList` or the
`references/id-glossary.md` to find model IDs for other types.

**`transtype` request values are category prefixes, not full strings:**

| Request value | What it matches in response |
|---------------|-----------------------------|
| `"None"` | All transaction types |
| `"FullSale"` | Full Sale - Retail to Retail, Full Sale - Retail to Unidentified, Full Sale - Retail to Leasing Company, etc. |
| `"Lease"` | Lease - Leasing Company to Retail, Lease - Operator to Operator, etc. |
| `"InternalSale"` | Internal/intra-company transfers |
| `"Management"` | Management company changes |
| `"Insurance"` | Insurance claims/write-offs |

**Filter flags (all tristate: `"Yes"` / `"No"` / `"Ignore"`):**
- `isinternaltrans: "No"` -- exclude intra-company transfers for real market deals
- `isnewaircraft: "No"` -- exclude new deliveries (preowned only)
- `ispreownedtrans` -- explicit preowned filter (alternative to `isnewaircraft`)

### Key response fields per transaction record

| Field | What it means |
|-------|--------------|
| `transid` | JETNET transaction ID -- use as join key for deduplication |
| `transtype` | Full descriptive string (e.g., `"Full Sale - Retail to Retail"`) |
| `transdate` | Actual transaction date (ISO timestamp) |
| `actiondate` | When JETNET last updated this record (ISO timestamp) |
| `transretail` | `true` = arm's length transaction -- use for comp analysis |
| `internaltrans` | `false` = not an intra-company transfer |
| `newac` | `"preowned"` or `"new"` |
| `soldprice` | Actual sale price -- often `null` (confidential deals) |
| `askingprice` | Listed asking price -- more often populated than soldprice |
| `listdate` | Date aircraft was first listed for sale |
| `pageurl` | Link to JETNET Evolution web app detail page |
| `description` | Human-readable transaction summary, e.g., `"Sold from X to Y"` |

### companyrelationships in history records

History records use the **nested schema** (same as `getRelationships`):
`company: {}` and `contact: {}` sub-objects. The `relationtype` values
specific to transactions are:

`"Seller"`, `"Purchaser"`, `"Operator"`, `"Seller's Broker"`, `"Purchaser's Broker"`

Pass `allrelationships: true` to get all parties in one call.

### Comp analysis workflow (find comparable sales)

```
1. getHistoryListPaged           --> all transactions matching model + date range
2. Filter: transretail=true      --> arm's length deals only
3. Filter: internaltrans=false   --> exclude internal transfers
4. Extract: askingprice, soldprice, transdate, regnbr, estaftt
5. getRelationships (bulk aclist) --> current owner for each aircraft transacted
```

`soldprice` is null on most deals. For pricing intelligence, use
`askingprice` + `getModelMarketTrends` for published comps.

### maxpages: 0 quirk on small result sets

When results fit in a single response, `maxpages: 0` and `currentpage: 0`
are returned -- this is normal, not an error. `paginate.py` handles this
automatically. Raw callers should use `max(maxpages, 1)` in their loop.

Known-good example: `examples/history-transaction-search.json`
